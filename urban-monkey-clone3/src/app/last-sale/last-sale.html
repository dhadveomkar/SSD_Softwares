<div class="last-sale-page container">
  <!-- top bar -->
  <div class="top-bar">
    <button class="filter-toggle" (click)="toggleFilterPanel()">FILTER <small class="count">{{ displayedProducts.length }}</small></button>

    <div class="spacer"></div>

    <label class="sort">
      <select [(ngModel)]="sortBy" (change)="applyFilters()">
        <option value="availability">AVAILABILITY</option>
        <option value="best-selling">BEST SELLING</option>
        <option value="alpha-asc">ALPHABETICALLY, A-Z</option>
        <option value="alpha-desc">ALPHABETICALLY, Z-A</option>
        <option value="date-new">DATE, NEW TO OLD</option>
        <option value="date-old">DATE, OLD TO NEW</option>
        <option value="price-asc">PRICE, LOW TO HIGH</option>
        <option value="price-desc">PRICE, HIGH TO LOW</option>
        <option value="sale-off">% SALE OFF</option>
      </select>
    </label>
  </div>

  <div class="content">
    <!-- filter panel -->
    <aside class="filter-panel" [class.open]="filterOpen" aria-hidden="{{!filterOpen}}">
      <div class="filter-header">
        <h3>Filter</h3>
        <button (click)="clearFilters()">Clear</button>
      </div>

      <div class="filter-group">
        <label>Search</label>
        <input type="search" [(ngModel)]="query" (ngModelChange)="applyFilters()" placeholder="Search products..." />
      </div>

      <!-- Category -->
      <div class="filter-group">
        <label>Category</label>
        <div class="checkbox-list">
          <label *ngFor="let c of categories" class="checkbox-item">
            <input type="checkbox" [checked]="selectedCategories.includes(c)" (change)="toggleSelection(selectedCategories, c)" />
            {{ c }}
          </label>
        </div>
      </div>

      <!-- Color (multi-select) -->
      <div class="filter-group">
        <label>Color</label>
        <div class="checkbox-list">
          <label *ngFor="let c of colors" class="checkbox-item">
            <input type="checkbox" [checked]="selectedColors.includes(c)" (change)="toggleSelection(selectedColors, c)" />
            {{ c }}
          </label>
        </div>
      </div>

      <!-- Material -->
      <div class="filter-group">
        <label>Material</label>
        <div class="checkbox-list">
          <label *ngFor="let m of materials" class="checkbox-item">
            <input type="checkbox" [checked]="selectedMaterials.includes(m)" (change)="toggleSelection(selectedMaterials, m)" />
            {{ m }}
          </label>
        </div>
      </div>

      <!-- Size -->
      <div class="filter-group">
        <label>Size</label>
        <div class="checkbox-list">
          <label *ngFor="let s of sizes" class="checkbox-item">
            <input type="checkbox" [checked]="selectedSizes.includes(s)" (change)="toggleSelection(selectedSizes, s)" />
            {{ s }}
          </label>
        </div>
      </div>

      <!-- Rating -->
      <div class="filter-group">
        <label>Rating</label>
        <div class="checkbox-list">
          <label *ngFor="let r of ratings" class="checkbox-item">
            <input type="checkbox" [checked]="selectedRatings.includes(r)" (change)="toggleSelection(selectedRatings, r)" />
            ⭐ {{ r }} & Up
          </label>
        </div>
      </div>

      <!-- Best For -->
      <div class="filter-group">
        <label>Best For</label>
        <div class="checkbox-list">
          <label *ngFor="let b of bestFor" class="checkbox-item">
            <input type="checkbox" [checked]="selectedBestFor.includes(b)" (change)="toggleSelection(selectedBestFor, b)" />
            {{ b }}
          </label>
        </div>
      </div>

      <!-- Frame Size / Type / Style -->
      <div class="filter-group">
        <label>Frame Size</label>
        <div class="checkbox-list">
          <label *ngFor="let f of frameSizes" class="checkbox-item">
            <input type="checkbox" [checked]="selectedFrameSizes.includes(f)" (change)="toggleSelection(selectedFrameSizes, f)" />
            {{ f }}
          </label>
        </div>
      </div>

      <div class="filter-group">
        <label>Frame Type</label>
        <div class="checkbox-list">
          <label *ngFor="let t of frameTypes" class="checkbox-item">
            <input type="checkbox" [checked]="selectedFrameTypes.includes(t)" (change)="toggleSelection(selectedFrameTypes, t)" />
            {{ t }}
          </label>
        </div>
      </div>

      <div class="filter-group">
        <label>Frame Style</label>
        <div class="checkbox-list">
          <label *ngFor="let st of frameStyles" class="checkbox-item">
            <input type="checkbox" [checked]="selectedFrameStyles.includes(st)" (change)="toggleSelection(selectedFrameStyles, st)" />
            {{ st }}
          </label>
        </div>
      </div>

      <!-- Price / Availability -->
      <div class="filter-group">
        <label>Price (min)</label>
        <input type="number" [(ngModel)]="minPrice" (ngModelChange)="applyFilters()" />
        <label>Price (max)</label>
        <input type="number" [(ngModel)]="maxPrice" (ngModelChange)="applyFilters()" />
      </div>

      <div class="filter-group">
        <label>Availability</label>
        <div>
          <label><input type="radio" name="avail" [(ngModel)]="availability" value="all" (change)="applyFilters()" /> All</label>
          <label><input type="radio" name="avail" [(ngModel)]="availability" value="in" (change)="applyFilters()" /> In stock</label>
          <label><input type="radio" name="avail" [(ngModel)]="availability" value="out" (change)="applyFilters()" /> Out of stock</label>
        </div>
      </div>

      <div class="filter-footer">
        <button (click)="viewProducts()">VIEW {{ displayedProducts.length }} PRODUCTS</button>
      </div>
    </aside>

    <!-- product grid -->
    <main class="product-area">
      <div class="grid">
        <article class="card" *ngFor="let p of visibleProducts()" tabindex="0">
          <div class="img-wrap">
            <img [src]="p.img" [alt]="p.name" (error)="onImgError($event)" loading="lazy" />
            <button class="love" (click)="toggleFavorite(p.id)" [attr.aria-pressed]="isFavorite(p.id)">
              <span [class.active]="isFavorite(p.id)">❤</span>
            </button>
          </div>

          <div class="card-body">
            <h4 class="title">{{ p.name }}</h4>
            <div class="subtitle">{{ p.subtitle }}</div>
            <div class="price">
              ₹{{ p.price }}
              <small *ngIf="p.oldPrice" class="old">₹{{ p.oldPrice }}</small>
              <span *ngIf="p.oldPrice" class="off">{{ discountPercent(p) }}% OFF</span>
            </div>
          </div>
        </article>
      </div>

      

      <div class="load-more" *ngIf="visibleCount < displayedProducts.length">
        <button (click)="loadMore()">LOAD MORE</button>
      </div>

      <div class="no-results" *ngIf="displayedProducts.length === 0">
        No products found. Try clearing filters.
      </div>
    </main>
  </div>
</div>