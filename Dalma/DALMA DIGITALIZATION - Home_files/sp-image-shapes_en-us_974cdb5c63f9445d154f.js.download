define("11e47fa8-b458-44f3-a54c-d523d44ec5fc_0.1.0",["react","@microsoft/sp-core-library","@microsoft/sp-lodash-subset","@msinternal/sp-image-shapes-read","@msinternal/sp-rich-image","@msinternal/sp-component-utilities","@microsoft/sp-image-helper","@msinternal/sp-coachmark-utility","@msinternal/sp-fluentui-v9-react-teaching-popover-bundle","@microsoft/load-themed-styles","@microsoft/sp-diagnostics","@msinternal/sp-edit-customer-promise"],(e,t,n,a,i,r,o,s,c,d,l,u)=>(()=>{"use strict";var f={424:e=>{e.exports=d},676:e=>{e.exports=t},207:e=>{e.exports=l},949:e=>{e.exports=o},529:e=>{e.exports=n},318:e=>{e.exports=s},718:e=>{e.exports=r},863:e=>{e.exports=u},635:e=>{e.exports=c},957:e=>{e.exports=a},122:e=>{e.exports=i},959:t=>{t.exports=e}},p={};function m(e){var t=p[e];if(void 0!==t)return t.exports;var n=p[e]={exports:{}};return f[e](n,n.exports,m),n.exports}m.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return m.d(t,{a:t}),t},m.d=(e,t)=>{for(var n in t)m.o(t,n)&&!m.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},m.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),m.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var _={};return(()=>{m.r(_),m.d(_,{ImageShapesEditRef:()=>M});var e=m(959),t=m.n(e),n=m(676),a=m(529),i=m(957),r=m(122);const o={M:"M",L:"L",T:"T",H:"H",V:"V",C:"C",S:"S",Q:"Q",A:"A",Z:"Z"};function s(e,t,n,a,i){return new Promise((r,o)=>{e.toBlob(e=>{e?a(e,t,n).then(e=>{r(e)}).catch(e=>{o(e)}):o("Blob is null and not able to be saved")},d(i),.95)})}function c(e,t,n){let a=0,i=0;const r=e.rx,o=e.ry,s=e.angle*Math.PI/180,c=Math.cos(s),d=Math.sin(s),l=t,u=n;a=e.x,i=e.y;const f=(l-a)/2,p=(u-i)/2,m=c*f+d*p,_=-d*f+c*p,h=r*r,b=o*o,g=m*m,v=_*_,y=h*b-h*v-b*g,S=h*v+b*g;let D=Math.sqrt(Math.abs(y/S));return e.largeArcFlag!==e.sweepFlag&&(D=-D),a=(l+a)/2,i=(u+i)/2,{x:a,y:i,rx:r,ry:o,cx:D*r*_/o,cy:-D*o*m/r}}function d(e){return"png"===e?"image/png":"image/webp"}function l(e,t,n,a){const i=t.getImageData(0,0,n,a).data;let r=n,o=a,s=0,c=0;for(let e=0;e<i.length;e+=4)if(0!==i[e+3]){const t=e/4%n,a=Math.floor(e/(4*n));t<r&&(r=t),a<o&&(o=a),t>s&&(s=t),a>c&&(c=a)}const d=s-r+1,l=c-o+1,u=document.createElement("canvas");u.width=d,u.height=l;const f=u.getContext("2d");return f&&f?.drawImage(e,r,o,d,l,0,0,d,l),u}function u(e,t,n,a){let i=getComputedStyle(e).getPropertyValue("transform");""===i&&(i="matrix(1,0,0,1,0,0)");const r=function(e){const t=e.match(/matrix\((.+)\)/),n=null!==t?t[1].split(",").map(parseFloat):[];return{translateX:n[4],translateY:n[5],scaleX:Math.sqrt(n[0]*n[0]+n[1]*n[1]),scaleY:Math.sqrt(n[2]*n[2]+n[3]*n[3]),angle:Math.atan2(n[1],n[0])*(180/Math.PI)}}(i),o=t.naturalHeight*n/e.height,s=t.naturalWidth*n/e.width;!function(e,t){if(e){const{translateX:n,translateY:a,scaleX:i,scaleY:r,angle:o}={...e},s=i*Math.cos(o),c=i*Math.sin(o),d=-r*Math.sin(o),l=r*Math.cos(o),u=n,f=a;t.setTransform(s,c,d,l,u,f)}}({translateX:r.translateX*s,translateY:r.translateY*o,angle:r.angle,scaleX:r.scaleX,scaleY:r.scaleY},a)}function f(e,t){const n=function(e){let t=0,n=0,a=0,i=1,r=1;const o=/(\w+)\(([^\)]+)\)/g;let s=o.exec(e);for(;s;){const c=s[1],d=s[2];switch(c){case"translate":const e=d.split(",");t+=parseFloat(e[0])||0,n+=parseFloat(e[1])||0;break;case"rotate":a+=parseFloat(d)||0;break;case"scale":const o=d.split(",");i*=parseFloat(o[0])||1,r*=parseFloat(o[1])||1}s=o.exec(e)}return{translateX:t,translateY:n,angle:a,scaleX:i,scaleY:r}}(e);if(n){const{translateX:e,translateY:a,scaleX:i,scaleY:r,angle:o}={...n},s=i*Math.cos(o),c=i*Math.sin(o),d=-r*Math.sin(o),l=r*Math.cos(o),u=e,f=a;t.setTransform(s,c,d,l,u,f)}}var p=m(718),h=m(949);function b(){return n._SPKillSwitch.isActivated("dc5d80a8-1048-4f97-9fa1-e4f77ec4c3ed")}function g(){return n._SPKillSwitch.isActivated("0506fc87-f576-451c-8118-1736aacbea1c")}function v(){return n._SPKillSwitch.isActivated("5a79da60-74ad-4fdc-820d-7009ea501a38")}const y=JSON.parse('{"k_":"{0} in {1}","s9":"Image within {0}","iO":"Use Shift to move or zoom","ij":"Change which part of your image appears in the shape by pressing and holding Shift, and then:","kW":"Move the image by dragging it","xc":"Zoom the image in or out by scrolling","yt":"Got it"}');var S=m(635),D=m(318);const I="ImageShapeTeachingPopover",x=n=>{const{shapeRef:a,serviceScope:i,isShapePopoverVisible:r,setShapePopoverVisible:o}=n,s=()=>{o&&o(!1),(0,D.getCoachmarkUtility)(i).dismiss(I)},c=t().createElement(S.TeachingPopoverSurface,{style:{position:"absolute",width:"320px"}},t().createElement(S.TeachingPopoverHeader,{icon:null,onClick:s}),t().createElement(S.TeachingPopoverTitle,null,y.iO),t().createElement("div",null,y.ij,t().createElement("div",{style:{marginTop:"10px"}},t().createElement("li",null,y.kW),t().createElement("li",null,y.xc))),t().createElement(S.TeachingPopoverFooter,{primary:y.yt,onClick:s})),d={type:"TeachingPopover",content:void 0,targetElement:a.current?a.current:void 0,serviceScope:i,localStorageKey:I,popoverProps:{withArrow:!0,open:r,onOpenChange:o?(e,t)=>o(t.open):void 0,positioning:{target:a.current,position:"after"},children:c}},{open:l,close:u}=(0,D.useTeachingPopover)(d);return(0,e.useEffect)(()=>{if(!r)return()=>{u()};l().catch(e=>{if(e)return Promise.reject(e)})},[l,u,r]),t().createElement(t().Fragment,null)};function C(){return!n._SPKillSwitch.isActivated("7e601a75-79b6-4241-a3f1-1c00be6bace8")&&(n._SPFlight.isEnabled(62395)||1===n._SPExperiment.getVariantAndLogExposure(90359))}const O=e=>{const a=n.Guid.newGuid().toString(),{imgSrc:o,serviceScope:s,imageData:c,width:d,height:l,callerId:u,children:f,buttonOffset:m=0,setImageRef:_,setOverlayRef:b,transformData:S,thumbnailWidth:D,cacheBuster:I,autoSaveCallback:O,onImageLoad:w,onImageLoadFailure:E,getDefaultImage:A,isShapeCentered:L=!0,isShapePopoverVisible:k,setShapePopoverVisible:M}={...e},P=n._SPKillSwitch.isActivated("1675210f-385b-4e20-9be6-e45cd577c771")?(0,p.disabledImageContextMenuInlineStyles)(c.contentProvider):void 0,T=t().useMemo(()=>Math.min(d,l),[l,d]),U=t().useMemo(()=>S?.translateX?(0,i.getTranslatedValue)(S.translateX,S.imgWidth,d):0,[S.imgWidth,d]),F=t().useMemo(()=>S?.translateY?(0,i.getTranslatedValue)(S.translateY,S.imgHeight,l):0,[l,S.imgHeight]),H=m>0?20:0,[R,N]=t().useState(!1),[B,j]=t().useState(U),[V,z]=t().useState(F),[G,K]=t().useState(U),[W,q]=t().useState(F),[Q,Y]=t().useState(U),[J,X]=t().useState(F),[Z,$]=t().useState(S?.zoom||1),[ee,te]=t().useState(0),ne=t().createRef(),ae=t().createRef();t().useEffect(()=>{j(U),K(U),Y(U)},[U]),t().useEffect(()=>{z(F),q(F),X(F)},[F]);const ie=t().useCallback(()=>{ne&&_(ne)},[ne,_]),re=t().useCallback(()=>{ae&&(b(ae),te(1))},[ae,b]),oe=t().useCallback(e=>{!e.target||e.target instanceof HTMLButtonElement||!e.shiftKey||(e.preventDefault(),e.stopPropagation(),N(!0),K(e.clientX-Q),q(e.clientY-J))},[Q,J]),se=t().useCallback(e=>{let t=B,a=V,i=Z;const r=n._SPKillSwitch.isActivated("dfce0629-b926-4c19-b4e1-9d72b1199a88")?20:40;if(e.shiftKey){switch(e.key){case"ArrowUp":a-=r;break;case"ArrowDown":a+=r;break;case"ArrowLeft":t+=r;break;case"ArrowRight":t-=r;break;case"+":i=Z+.1;break;case"_":i>.4&&(i=Z-.1);break;default:return}e.preventDefault(),e.stopPropagation(),N(!0),j(t),z(a),$(i),O({zoom:i,translateX:t,translateY:a,imgWidth:d,imgHeight:l})}},[O,B,V,l,d,Z]),ce=t().useRef(null),de=t().useCallback(e=>{ce.current=e},[ce]);t().useEffect(()=>{if(!g()&&ce.current)return ce.current.addEventListener("keydown",se),()=>ce.current?.removeEventListener("keydown",se)},[se,ce]);const le=t().useCallback(e=>{e.target&&R&&e.target instanceof HTMLImageElement&&e.shiftKey&&(e.preventDefault(),e.stopPropagation(),j(e.clientX-G),z(e.clientY-W),Y(B),X(V))},[B,V,G,W,R]),ue=t().useCallback(e=>{e.target&&R&&(e.preventDefault(),e.stopPropagation(),N(!1),K(B),q(V),O({zoom:Z,translateX:B,translateY:V,imgWidth:d,imgHeight:l}))},[O,B,V,l,R,d,Z]),fe=t().useCallback(e=>{if(e.target&&e.shiftKey){e.preventDefault(),e.stopPropagation();let t=Z;e.deltaY>0&&Z>.4?(t=Z-.1*Math.sign(e.deltaY),$(t)):(t=Z+.1,$(t)),O({zoom:t,translateX:B,translateY:V,imgWidth:d,imgHeight:l})}},[O,B,V,l,d,Z]);return t().createElement(t().Fragment,null,t().createElement("div",{id:`container-${a}`,onWheel:fe,onMouseMove:le,onMouseUp:ue,onMouseDown:oe},t().createElement("div",{id:`image-preview-${a}`},t().createElement("div",{id:`img-wrapper-${a}`,style:{width:`${d}px`,height:`${l}px`,display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",position:"relative",margin:L?"0 auto":"0",padding:"0 auto"}},t().createElement("div",{id:`image-overlay-${a}`,style:{width:`calc(${T}px - ${m}px)`,height:`calc(${T}px - ${m}px)`,inset:`${H}px`,backgroundColor:"transparent",opacity:C()?ee:void 0},ref:ae,onLoad:re},n._SPKillSwitch.isActivated("27459c2c-82cc-4621-baa9-cb65c0861f59")?t().createElement("img",{id:`imagePreview-${a}`,src:o,style:{width:d*Z+"px",height:l*Z+"px",transform:`translate(${B}px, ${V}px)`,position:"absolute",top:0,left:0},ref:ne,onLoad:ie,onWheel:fe,alt:"Shape Demo"}):t().createElement(r.SPImg,{id:`imagePreview-${a}`,imgRef:v()||g()?void 0:de,tabIndex:g()?void 0:0,"data-sp-originalimgsrc":c.imageUrl,imageData:c,serviceScope:s,width:d,height:l,callerId:u,alt:c.isDecorative?"":c.altText?n.Text.format(y.k_,c.altText,(0,i.getImageShapeForAltText)(e.imageShape)):n.Text.format(y.s9,(0,i.getImageShapeForAltText)(e.imageShape)),onMouseDown:oe,getDefaultImage:A,onImageLoad:e=>{const t=e?.currentTarget;t&&(ne.current=t,_(ne),w?.())},onImageLoadFailure:E,thumbnailWidth:n._SPKillSwitch.isActivated("5cbbd14e-8869-4c13-b8b6-7a234db2a4a4")?D:Math.max(h._CACHE_BREAKPOINT_S,D||0),cacheBuster:I,style:{width:d*Z+"px",height:l*Z+"px",transform:`translate(${B}px, ${V}px)`,position:"absolute",top:0,left:0,opacity:C()?void 0:ee,outline:"none",...P}}),!v()&&t().createElement(x,{shapeRef:ce,serviceScope:s,isShapePopoverVisible:k,setShapePopoverVisible:M})),f)),t().createElement("svg",{id:`svgClips-${a}`,"aria-hidden":"true",style:{position:"absolute",width:0,height:0,overflow:"hidden",zIndex:-1},version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid slice"},t().createElement("clipPath",{id:"heart",clipPathUnits:"objectBoundingBox",transform:"scale(0.01, 0.01)"},t().createElement("path",{d:"M 10,30 A 20,20 0,0,1 50,30 A 20,20 0,0,1 90,30 Q 90,60 50,90 Q 10,60 10,30 z"})),t().createElement("clipPath",{id:"leave",clipPathUnits:"objectBoundingBox",transform:"scale(1, 1)"},t().createElement("path",{d:"M0.989,0.131 c-0.108,-0.082,-0.275,-0.131,-0.446,-0.131 c-0.211,0,-0.384,0.074,-0.473,0.202 c-0.042,0.06,-0.065,0.132,-0.069,0.212 c-0.003,0.072,0.009,0.151,0.036,0.237 c0.093,-0.278,0.352,-0.495,0.651,-0.495 c0,0,-0.28,0.074,-0.455,0.301 c0,0,-0.002,0.003,-0.006,0.009 c-0.035,0.047,-0.066,0.101,-0.089,0.162 c-0.039,0.093,-0.075,0.22,-0.075,0.373 h0.125 c0,0,-0.019,-0.119,0.014,-0.257 c0.055,0.007,0.104,0.011,0.148,0.011 c0.115,0,0.197,-0.025,0.258,-0.078 c0.054,-0.048,0.084,-0.112,0.116,-0.18 c0.048,-0.104,0.103,-0.222,0.263,-0.313 c0.009,-0.005,0.015,-0.015,0.016,-0.025 s-0.004,-0.021,-0.012,-0.027"})),t().createElement("clipPath",{id:"baloon",clipPathUnits:"objectBoundingBox",transform:"scale(1, 1)"},t().createElement("path",{d:"M0.417,0 v0 c0.23,0,0.417,0.17,0.417,0.379 s-0.187,0.379,-0.417,0.379 c-0.022,0,-0.044,-0.002,-0.065,-0.005 c-0.089,0.1,-0.193,0.118,-0.296,0.121 v-0.025 c0.056,-0.031,0.101,-0.086,0.101,-0.15 c0,-0.009,-0.001,-0.018,-0.002,-0.026 c-0.094,-0.07,-0.154,-0.176,-0.154,-0.295 c0,-0.209,0.187,-0.379,0.417,-0.379 M0.865,0.85 c0,0.055,0.032,0.102,0.08,0.129 v0.021 c-0.09,-0.002,-0.172,-0.018,-0.249,-0.104 c-0.018,0.003,-0.037,0.004,-0.056,0.004 c-0.083,0,-0.159,-0.025,-0.22,-0.067 c0.126,0,0.244,-0.046,0.334,-0.128 c0.045,-0.041,0.081,-0.09,0.106,-0.144 c0.027,-0.057,0.04,-0.119,0.04,-0.182 c0,-0.01,0,-0.02,-0.001,-0.03 c0.063,0.059,0.102,0.138,0.102,0.226 c0,0.102,-0.052,0.193,-0.134,0.253 c-0.001,0.007,-0.002,0.015,-0.002,0.022"})),t().createElement("clipPath",{id:"marker",clipPathUnits:"objectBoundingBox",transform:"scale(0.0625, 0.0625)"},t().createElement("path",{d:"M0,0.8v9c0,0.4,0.3,1,0.8,1.3l6.5,4.4c0.4,0.3,1.1,0.3,1.5,0l6.5-4.4c0.4-0.3,0.8-0.9,0.8-1.3v-9C16,0.3,15.5,0,14.9,0H1.1 C0.5,0,0,0.3,0,0.8L0,0.8z"})),t().createElement("clipPath",{id:"checkmark",clipPathUnits:"objectBoundingBox",transform:"scale(0.021739130434782608, 0.021739130434782608)"},t().createElement("path",{d:"M20.687,38.332c-2.072,2.072-5.434,2.072-7.505,0L1.554,26.704c-2.072-2.071-2.072-5.433,0-7.504 c2.071-2.072,5.433-2.072,7.505,0l6.928,6.927c0.523,0.522,1.372,0.522,1.896,0L36.642,7.368c2.071-2.072,5.433-2.072,7.505,0 c0.995,0.995,1.554,2.345,1.554,3.752c0,1.407-0.559,2.757-1.554,3.752L20.687,38.332z"})),t().createElement("clipPath",{id:"cog",clipPathUnits:"objectBoundingBox",transform:"scale(0.021739130434782608, 0.021739130434782608)"},t().createElement("path",{d:"M43.454,18.443h-2.437c-0.453-1.766-1.16-3.42-2.082-4.933l1.752-1.756c0.473-0.473,0.733-1.104,0.733-1.774 c0-0.669-0.262-1.301-0.733-1.773l-2.92-2.917c-0.947-0.948-2.602-0.947-3.545-0.001l-1.826,1.815 C30.9,6.232,29.296,5.56,27.529,5.128V2.52c0-1.383-1.105-2.52-2.488-2.52h-4.128c-1.383,0-2.471,1.137-2.471,2.52v2.607 c-1.766,0.431-3.38,1.104-4.878,1.977l-1.825-1.815c-0.946-0.948-2.602-0.947-3.551-0.001L5.27,8.205 C4.802,8.672,4.535,9.318,4.535,9.978c0,0.669,0.259,1.299,0.733,1.772l1.752,1.76c-0.921,1.513-1.629,3.167-2.081,4.933H2.501 C1.117,18.443,0,19.555,0,20.935v4.125c0,1.384,1.117,2.471,2.501,2.471h2.438c0.452,1.766,1.159,3.43,2.079,4.943l-1.752,1.763 c-0.474,0.473-0.734,1.106-0.734,1.776s0.261,1.303,0.734,1.776l2.92,2.919c0.474,0.473,1.103,0.733,1.772,0.733 s1.299-0.261,1.773-0.733l1.833-1.816c1.498,0.873,3.112,1.545,4.878,1.978v2.604c0,1.383,1.088,2.498,2.471,2.498h4.128 c1.383,0,2.488-1.115,2.488-2.498v-2.605c1.767-0.432,3.371-1.104,4.869-1.977l1.817,1.812c0.474,0.475,1.104,0.735,1.775,0.735 c0.67,0,1.301-0.261,1.774-0.733l2.92-2.917c0.473-0.472,0.732-1.103,0.734-1.772c0-0.67-0.262-1.299-0.734-1.773l-1.75-1.77 c0.92-1.514,1.627-3.179,2.08-4.943h2.438c1.383,0,2.52-1.087,2.52-2.471v-4.125C45.973,19.555,44.837,18.443,43.454,18.443z M22.976,30.85c-4.378,0-7.928-3.517-7.928-7.852c0-4.338,3.55-7.85,7.928-7.85c4.379,0,7.931,3.512,7.931,7.85 C30.906,27.334,27.355,30.85,22.976,30.85z"})),t().createElement("clipPath",{id:"user",clipPathUnits:"objectBoundingBox",transform:"scale(0.021739130434782608, 0.021739130434782608)"},t().createElement("path",{d:"M22.766,0.001C10.194,0.001,0,10.193,0,22.766s10.193,22.765,22.766,22.765c12.574,0,22.766-10.192,22.766-22.765 S35.34,0.001,22.766,0.001z M22.766,6.808c4.16,0,7.531,3.372,7.531,7.53c0,4.159-3.371,7.53-7.531,7.53 c-4.158,0-7.529-3.371-7.529-7.53C15.237,10.18,18.608,6.808,22.766,6.808z M22.761,39.579c-4.149,0-7.949-1.511-10.88-4.012 c-0.714-0.609-1.126-1.502-1.126-2.439c0-4.217,3.413-7.592,7.631-7.592h8.762c4.219,0,7.619,3.375,7.619,7.592 c0,0.938-0.41,1.829-1.125,2.438C30.712,38.068,26.911,39.579,22.761,39.579z"})),t().createElement("clipPath",{id:"pebble",clipPathUnits:"objectBoundingBox",transform:"scale(.0048, .0048)"},t().createElement("path",{d:"M118.711 204.152C90.4117 199.858 68.2038 170.531 45.5708 143.416C22.8514 116.434 -0.419418 91.5659 0.00574051 65.79C0.30468 39.9278 24.3859 13.0188 51.224 3.92098C78.1552 -5.30934 107.817 3.04633 133.094 15.6229C158.371 28.1994 179.403 45.0963 192.357 71.1174C205.404 97.0127 210.539 132.344 195.871 160.154C181.123 188.103 146.918 208.578 118.711 204.152Z"})),t().createElement("clipPath",{id:"triangle",clipPathUnits:"objectBoundingBox",transform:"scale(.0043, .00483)"},t().createElement("path",{d:"M114.371 1.45335C115.322 -0.213234 117.725 -0.213273 118.676 1.45331L232.717 201.251C233.66 202.903 232.467 204.958 230.565 204.958L2.48262 204.958C0.580001 204.958 -0.613222 202.903 0.329938 201.251L114.371 1.45335Z"})),t().createElement("clipPath",{id:"hexagon",clipPathUnits:"objectBoundingBox",transform:"scale(0.00397, 0.00452)"},t().createElement("path",{d:"M190.048 216.997C189.333 218.236 188.01 218.999 186.579 218.997L65.1978 218.858C63.7671 218.856 62.4462 218.091 61.7337 216.85L1.14698 111.359C0.436963 110.123 0.438588 108.602 1.15124 107.367L61.9652 2.00286C62.6804 0.763707 64.003 0.000919501 65.4337 0.00241143L186.802 0.12897C188.233 0.130462 189.554 0.896168 190.266 2.13701L250.853 107.641C251.563 108.877 251.562 110.398 250.849 111.632L190.048 216.997Z"})),t().createElement("clipPath",{id:"teardrop",clipPathUnits:"objectBoundingBox",transform:"scale(.00488, .00488)"},t().createElement("path",{d:"M0 102C0 45.667 45.667 0 102 0V0C158.333 0 204 45.667 204 102V188.308C204 196.974 196.974 204 188.308 204H102C45.667 204 0 158.333 0 102V102Z"})),t().createElement("clipPath",{id:"square",clipPathUnits:"objectBoundingBox",transform:"scale(0.00454, 0.00454)"},t().createElement("path",{d:"M 4 0 H 214.558 A 4 4 0 0 1 218.558 4 V 214.558 A 4 4 0 0 1 214.558 218.558 H 4 A 4 4 0 0 1 0 214.558 V 4 A 4 4 0 0 1 4 0 Z"})),t().createElement("clipPath",{id:"circle",clipPathUnits:"objectBoundingBox",transform:"scale(.00489, .00489)"},t().createElement("path",{d:"M 203.472 101.736 a 101.736 101.736 0 1 0 -203.472 0 a 101.736 101.736 0 1 0 203.472 0"})))))};m(424).loadStyles('.s_nl_E2_b5H7b{align-items:center;background-color:transparent;border:var(--app-inp-brd);border-radius:.25rem;display:inline-flex;flex:0 0 60px;flex-direction:column;font-size:xx-small;height:60px;margin:0 .25rem .25rem 0;overflow:hidden;position:relative}.s_nl_E2_b5H7b:before{border-radius:50%;content:"";display:inline-block;height:8px;left:2px;position:absolute;top:2px;width:8px}.s_nl_E2_b5H7b:focus,.s_nl_E2_b5H7b:hover{background-color:#ddd}.s_nl_E2_b5H7b div{background-color:#333;height:32px;margin:.25rem 0;pointer-events:none;width:32px}.p_anns6_b5H7b{background:hsla(0,0%,39%,.5);border:0;border-radius:50%;color:#fff;cursor:move;height:40px;outline:none;position:absolute;width:40px}.p_anns6_b5H7b:focus,.p_anns6_b5H7b:hover{background:rgba(90,90,90,.9)}.p_anns6_b5H7b:focus{box-shadow:inset 0 0 0 4px #333}',!0);const w=e=>{const{index:n,offsetLeft:a,offsetTop:i,offsetX:r,offsetY:o,overlayRect:s,presetType:c,updateCoordinates:d,addNewPoint:l,deletePoint:u}={...e},f=s?s.width/100:1,p=r*f+a,m=o*f+i,_=t().useCallback(e=>{if(e.target){const t=e.target;if(n>=0){let[s,c]=[r||0,o||0];switch(e.key){case"ArrowDown":e.preventDefault(),e.ctrlKey?c+=.1:c++;break;case"ArrowLeft":e.preventDefault(),e.ctrlKey?s-=.1:s--;break;case"ArrowRight":e.preventDefault(),e.ctrlKey?s+=.1:s++;break;case"ArrowUp":e.preventDefault(),e.ctrlKey?c-=.1:c--;break;case"Delete":case"-":return void u(n);case"+":return void l(n)}s=Math.min(Math.max(s,0),100),c=Math.min(Math.max(c,0),100),t.style.left=`${s*f+a}px`,t.style.top=`${c*f+i}px`,d(n,[s,c])}}},[n,r,o,f,a,i,d,u,l]);return t().createElement(t().Fragment,null,t().createElement("button",{className:"p_anns6_b5H7b","data-index":n,"data-presettype":c,type:"button",style:{left:`${p}px`,top:`${m}px`},onKeyDown:_},n))},E=e=>{const{coordinates:n,overlayRect:a,maskType:i,offsetTop:r,offsetLeft:o,updateClipPath:s,addNewPoint:c,deletePoint:d}={...e},[l,u]=t().useState(void 0),[f,p]=t().useState(!1),m=t().useRef(null),_=t().useCallback((e,t)=>{n.splice(e,1,t),s&&s(n)},[n,s]),h=t().useCallback(e=>{if(e.target&&l&&f&&a){e.stopPropagation(),e.preventDefault();const t=l?.dataset?.index?parseInt(l.dataset.index,10):-1,n=0;if(t>=0&&a){let s=e.clientX-a.left,c=e.clientY-a.top;const d=a.width/100,u=l?.dataset?.x?parseInt(l?.dataset?.x,10):-1,f=l?.dataset?.y?parseInt(l?.dataset?.y,10):-1;s<0&&(s=0),c<0&&(c=0),s+n>a.width&&(s=a.width-n),c+n>a.height&&(c=a.height-n),e.altKey&&u>0&&(s=u),e.shiftKey&&f>0&&(c=f+r),l.dataset.x=s.toString(),l.dataset.y=c.toString(),l.style.left="ellipse"===i&&1===t?l.style.left:`${s+o}px`,l.style.top="ellipse"===i&&2===t?l.style.top:`${c+r}px`,_(t,[Math.ceil(s/d),Math.ceil(c/d)])}}},[l,f,a,i,o,r,_]),b=t().useCallback(e=>{if(e.target&&e.target instanceof HTMLButtonElement){e.stopPropagation(),e.preventDefault();const t=e.target;(t?.dataset?.index?parseInt(t.dataset.index,10):-1)>=0&&(u(t),p(!0))}},[]),g=t().useCallback(e=>{window&&window.getSelection&&window.getSelection()?.removeAllRanges(),u(void 0)},[]),v=t().useCallback(e=>{e.target&&(e.stopPropagation(),e.preventDefault(),u(void 0),p(!1))},[]);return t().createElement("div",{ref:m,onPointerMove:h,onPointerDown:b,onPointerLeave:g,onPointerUp:v},n.map((e,n)=>i?t().createElement(w,{key:n,index:n,presetType:i,offsetX:e[0],offsetY:e[1],overlayRect:a,offsetTop:r,offsetLeft:o,updateCoordinates:_,width:40,addNewPoint:c,deletePoint:d}):t().createElement(t().Fragment,null)))};var A=m(207),L=m(863);const k=(t,p)=>{const{imageData:m,imageShape:_,width:h,height:g,callerId:y,serviceScope:S,thumbnailWidth:D,imageTransformData:I,previouslySavedShape:x,isShapeCentered:C,onRenderComplete:w,handleSave:k,getDefaultImage:M,onImageLoad:P,onImageLoadFailure:T,cacheBuster:U}=t,F=h||0,H=g||0,R=Math.max(F,H)/2,N=H>F?R-F/2:0,B=F>H?R-H/2:0,j=(0,r.useFallback)({imageData:m,callerId:y,thumbnailWidth:D,onImageLoad:P,onImageLoadFailure:T,getServices:()=>(0,r.getDefaultServices)({callerId:y,serviceScope:S,imageData:m,getDefaultImage:M,thumbnailWidth:D,disableBlobRevoke:!1,cacheBuster:m.cacheBuster})}).src,V=(0,r.useFallback)({imageData:m,callerId:y,thumbnailWidth:99999,onImageLoad:P,onImageLoadFailure:T,getServices:()=>(0,r.getDefaultServices)({callerId:y,serviceScope:S,imageData:m,getDefaultImage:M,thumbnailWidth:99999,disableBlobRevoke:!1,cacheBuster:n.Guid.newGuid().toString()})}).src,[z,G]=e.useState(null),[K,W]=e.useState(null),[q,Q]=e.useState(null),[Y,J]=e.useState(),[X,Z]=e.useState(!1),[$,ee]=e.useState(x),[te,ne]=e.useState(I||{zoom:1,translateX:0,translateY:0,imgWidth:F,imgHeight:H}),[ae,ie]=e.useState(!1),[re,oe]=e.useState({executeCropData:{image:K,fullImage:q,mask:Y},imageTransformData:te,handleSave:k}),se=e.useCallback(e=>{e&&e.current&&Y&&(e.current.style.clipPath=Y.clipPath,G(e.current))},[Y]),ce=e.useMemo(()=>z?.getBoundingClientRect(),[z]),de=e.useMemo(()=>(0,a.debounce)(async(e,t)=>{await(async(e,t)=>{if(e.executeCropData.image&&e.executeCropData.fullImage&&e.executeCropData.mask&&e.handleSave&&t){v()||ie(!0);const t=async(t,n,a)=>{if(t&&e.handleSave)return e.handleSave(t,n,a,e.imageTransformData,"png")},n={...e.executeCropData,image:e.executeCropData.image,fullImage:e.executeCropData.fullImage,mask:e.executeCropData.mask,zoom:e.imageTransformData.zoom,saveBlobCallback:t},a="SaveShape",r=function(e,t){return{errorModuleName:"ImageShapesEdit SaveShape Failure",logFailure:t.consume(L._EditModeCustomerPromiseHandler.serviceKey).logFailure}}(0,S),p=new A._QosMonitorShareFailureWithCP(`ImageShapesEdit.${a}`,!1,[r]);await async function(e){const t=e.fullImage.naturalWidth,n=e.fullImage.naturalHeight,a=Math.max(t,n)/2,r=n>t?a-t/2:0,p=t>n?a-n/2:0,m=Math.min(t,n);switch(e.mask.maskType){case"polygon":return await async function(e,t){const{image:n,fullImage:a,overlayWidth:i,zoom:r,overrideImgTransform:o,saveBlobCallback:c,offsetX:p=0,offsetY:m=0,imageType:_="webp"}=e,h=document.createElement("canvas");h.width=a.width,h.height=a.height;const b=i/100,g=h.getContext("2d");if(null===g)return;if(t.length<=0)throw new Error("coordinates missing or incorrect length");g.beginPath(),g.globalAlpha=0,g.moveTo(t[0][0]*b+p,t[0][1]*b+m);for(let e=1;e<t.length;e++)g.lineTo(t[e][0]*b+p,t[e][1]*b+m);g.closePath(),g.stroke(),g.clip(),o?f(o,g):u(n,a,r,g),g.globalAlpha=1,g.drawImage(a,0,0,a.width,a.height),g.restore();const v=l(h,g,h.width,h.height);let y;return c&&(y=await s(v,v.width,v.height,c,_)),{dataUrl:y||v.toDataURL(d(_),.95),width:v.width,height:v.height}}({...e,overlayWidth:m,offsetX:p,offsetY:r},e.mask.coordinates).catch(e=>{throw e});case"ellipse":return await async function(e,t){const{image:n,fullImage:a,overlayWidth:i,zoom:r,overrideImgTransform:o,saveBlobCallback:c,offsetX:p=0,offsetY:m=0,imageType:_="webp"}=e,h=document.createElement("canvas");h.width=a.width,h.height=a.height;const b=i/100,g=h.getContext("2d");if(null===g)return;if(4!==t.length)throw new Error("pathData missing or incorrect length");const v=b*t[2]+p,y=b*t[3]+m,S=b*t[0],D=b*t[1];g.beginPath(),g.globalAlpha=0,g.ellipse(v,y,S,D,0,0,2*Math.PI),g.closePath(),g.clip(),o?f(o,g):u(n,a,r,g),g.globalAlpha=1,g.drawImage(a,0,0,a.width,a.height),g.restore();const I=l(h,g,h.width,h.height);let x;return c&&(x=await s(I,I.width,I.height,c,_)),{dataUrl:x||I.toDataURL(d(_),.95),width:I.width,height:I.height}}({...e,overlayWidth:m,offsetX:p,offsetY:r},e.mask.clipData||(0,i.getEmptyNumberArray)()).catch(e=>{throw e});case"url":return await async function(e,t,n){const{image:a,fullImage:i,overlayWidth:r,zoom:p,overrideImgTransform:m,saveBlobCallback:_,offsetX:h=0,offsetY:b=0,imageType:g="webp"}=e,v=i.naturalWidth*p,y=i.naturalHeight*p,S=document.createElement("canvas");S.width=i.naturalWidth,S.height=i.naturalHeight;const D=S.getContext("2d");if(null===D)return;const I=function(e){const t=function(e){const t=e.match(/[a-df-z][^a-df-z]*/gi);if(null!==t)return t.map(e=>{const t=function(e){return o[e]}(e.charAt(0).toUpperCase()),n=e.slice(1).trim().split(/,|\s|(?=-)/).map(parseFloat),a={commandType:t,x:0,y:0,x2:0,y2:0,x3:0,y3:0,rx:0,ry:0,angle:0,largeArcFlag:0,sweepFlag:0};switch(t){case"M":case"L":case"T":a.x=n[0],a.y=n[1];break;case"H":a.x=n[0];break;case"V":a.y=n[0];break;case"C":a.x=n[4],a.y=n[5],a.x2=n[0],a.y2=n[1],a.x3=n[2],a.y3=n[3];break;case"S":case"Q":a.x=n[2],a.y=n[3],a.x2=n[0],a.y2=n[1];break;case"A":a.rx=n[0],a.ry=n[1],a.angle=n[2],a.largeArcFlag=n[3],a.sweepFlag=n[4],a.x=n[5],a.y=n[6];break;case"Z":break;default:throw new Error(`Command type is not valid ${t}`)}return{...a}})}(e);if(!t)return;let n=t[0].x,a=t[0].x,i=t[0].y,r=t[0].y,s=0,d=0,l=0,u=0,f=0,p=0;for(const e of t){if(e)switch(e.commandType){case"M":case"L":case"T":s=e.x,d=e.y;break;case"H":s=e.x;break;case"V":d=e.y;break;case"C":s=e.x3,d=e.y3;break;case"S":case"Q":s=e.x2,d=e.y2;break;case"A":({x:s,y:d,rx:l,ry:u,cx:f,cy:p}=c(e,s,d))}n=Math.min(n,s-l-f),a=Math.max(a,s+l+f),i=Math.min(i,d-u-p),r=Math.max(r,d+u+p)}return{x:n,y:i,width:a-n,height:r-i}}(t);if(I){const e=n&&n.x>0?n.x:1,o=n&&n.y>0?n.y:1,c=(r||i.width)/I.width*(I.width*e),x=(r||i.height)/I.height*(I.height*o),C=new DOMMatrix,O=new Path2D(t),w=new Path2D;w.addPath(O,C.scale(c,x)),D.translate(h,b),D.fill(w),D.restore(),D.globalCompositeOperation="source-in",m?f(m,D):u(a,i,p,D),D.drawImage(i,0,0,v,y),D.globalCompositeOperation="source-over";const E=D.getImageData(0,0,S.width,S.height);let A=S.width,L=S.height,k=0,M=0;for(let e=0;e<S.height;e++)for(let t=0;t<S.width;t++){const n=4*(e*S.width+t);E.data[n+3]>0&&(t<A&&(A=t),e<L&&(L=e),t>k&&(k=t),e>M&&(M=e))}const P=(A+k)/2,T=(L+M)/2,U=S.width/2-P,F=S.height/2-T,H=document.createElement("canvas");H.width=S.width,H.height=S.height;const R=H.getContext("2d");if(R){R.translate(U,F),R.drawImage(S,0,0,S.width,S.height);const e=l(H,R,H.width,H.height);let t;return _&&(t=await s(e,e.width,e.height,_,g)),{dataUrl:t||e.toDataURL(d(g),.95),width:e.width,height:e.height}}}}({...e,overlayWidth:m,offsetX:p,offsetY:r,imageType:"png"},e.mask.pathData||"",e.mask.svgScale).catch(e=>{throw e});default:return}}(n).then(e=>{b()||(e?p.writeSuccess():p.writeUnexpectedFailure(`ImageShapesEdit.${a}.ExecuteCropFailure`,new Error("No clip response from executeCrop")))}).catch(e=>{if(!b()){const t={imageShape:_,maskType:n.mask.maskType};throw p.writeUnexpectedFailure(`ImageShapesEdit.${a}.ExecuteCropFailure`,e,t),e}}),Z(!1)}})(e,t)},800),[]),le=()=>{X?de(re,X):Z(!0)},ue=()=>{ae||ie(!1)};e.useImperativeHandle(p,()=>({externalSaveShape:le,saveShapePopoverVisibility:ue})),e.useEffect(()=>{(async function(){const e=await async function(e,t,n){return new Promise((t,n)=>{const a=new Image;a.onload=()=>{t(a)},a.onerror=e=>{n(e)},a.crossOrigin="anonymous",a.src=e})}(V||j||"");Q(e)})().catch(e=>{})},[V,j]),e.useEffect(()=>{if(K&&q&&Y&&X&&k){const e={...re,executeCropData:{image:K,fullImage:q,mask:Y}};oe(e),de(re,X)}},[K,q,Y]);const fe=e.useCallback(e=>{e&&e.current&&W(e.current)},[]);e.useEffect(()=>{const e=_,t=i.Shapes.find(t=>t.name===e?.toLowerCase());if(t){const n={maskType:t.maskType,coordinates:(0,i.getCoordinates)(t.coordData[0]),clipPath:t.coordData[0].clipPath,pathData:"url"===t.coordData[0].coordType?t.coordData[0]?.pathData:void 0,clipData:"ellipse"===t.coordData[0].coordType?t.coordData[0]?.clipData:void 0,svgScale:"url"===t.coordData[0].coordType?t.coordData[0]?.svgScale:void 0};J(n);const a=n.clipPath;z&&a&&(z.style.clipPath=a,G(z)),X||$===e||(ee(e),Z(!0))}},[_,X,z,$]),e.useEffect(()=>{w&&w()},[]);const pe=e.useCallback(e=>{if(z&&Y)if("polygon"===Y.maskType){const t=`polygon(${e.map(([e,t])=>`${e}% ${t}%`).join(",")})`;z.style.clipPath=t,J({...Y,coordinates:e,clipPath:t}),G(z)}else if("ellipse"===Y.maskType){const[t,n,a]=e,i=n[0]-50,r=50-t[1],o=`ellipse(${i}% ${r}% at ${a.join("% ")}%)`;z.style.clipPath=o,J({...Y,coordinates:e,clipPath:o,clipData:[i,r,a[0],a[1]]}),G(z)}},[Y,z]),me=e.useCallback(e=>{if("polygon"!==Y?.maskType)return!1;const t=Y.coordinates,n=e+1<t.length?e+1:0,[a,i]=t[e],[r,o]=t[n];t.splice(n,0,[(a+r)/2,(i+o)/2]),pe(t)},[Y?.coordinates,Y?.maskType,pe]),_e=e.useCallback(e=>{if("polygon"!==Y?.maskType)return!1;const t=Y.coordinates;t.length>3&&(t.splice(e,1),pe(t))},[Y?.coordinates,Y?.maskType,pe]);return j?e.createElement(e.Fragment,null,e.createElement(O,{imgSrc:j,imageData:m,imageShape:_,serviceScope:S,callerId:y,getDefaultImage:M,onImageLoad:P,onImageLoadFailure:T,thumbnailWidth:D,cacheBuster:U,transformData:te,autoSaveCallback:e=>{K&&Y&&k&&(ne(e),oe({...re,imageTransformData:e}),X?de({...re,imageTransformData:e},X):Z(!0))},setOverlayRef:se,setImageRef:fe,width:h||0,height:g||0,isShapeCentered:C,isShapePopoverVisible:ae,setShapePopoverVisible:ie},Y?.maskType&&Y?.coordinates&&e.createElement(E,{maskType:Y.maskType,coordinates:Y.coordinates,overlayRect:ce,updateClipPath:pe,addNewPoint:me,deletePoint:_e,offsetTop:N,offsetLeft:B}))):e.createElement(e.Fragment,null)},M=e.forwardRef(k)})(),_})());