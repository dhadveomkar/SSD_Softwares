define("8b7ae98f-492d-4304-93df-8f8a9fbedf11_0.1.0",["@microsoft/sp-core-library","@microsoft/sp-diagnostics","@microsoft/sp-http","@microsoft/sp-lodash-subset","@microsoft/sp-page-context","@msinternal/sp-telemetry"],(e,t,n,a,i,r)=>(()=>{"use strict";var o={676:t=>{t.exports=e},207:e=>{e.exports=t},909:e=>{e.exports=n},529:e=>{e.exports=a},408:e=>{e.exports=i},519:e=>{e.exports=r}},s={};function c(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={exports:{}};return o[e](n,n.exports,c),n.exports}c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var d={};return(()=>{c.r(d),c.d(d,{PeopleDataProvider:()=>p});var e=c(676),t=c(207),n=c(909),a=c(529),i=c(408),r=c(519);class o{static _trimStart(e,t){return 0===e.indexOf(t)?e.substr(t.length):e}get(e){return new Promise((t,n)=>{this._requests||(this._requests=[]),this._requests.push({method:"GET",url:o._trimStart(e,"v1.0"),attemptCount:1,resolve:t,reject:n}),20===this._requests.length?this._flush():this._sendBatchRequestDebounce()})}cancel(){this._sendBatchRequestDebounce.cancel()}async _sendBatchRequest(){if(!this._requests)return;const e=this._requests;let t;this._requests=void 0;try{t=this._getMSGraphClientAsync().then(t=>t.api("$batch").headers({Accept:"application/json","Content-Type":"application/json","X-PeopleQuery-QuerySources":"Mailbox,Directory"}).post(JSON.stringify({requests:e.map((e,t)=>({id:t,method:e.method,url:e.url}))})))}catch(t){return void e.forEach(e=>e.reject(t))}try{(await t)?.responses.sort((e,t)=>Number(e.id)-Number(t.id)).forEach((t,n)=>{const a=e[n];429===t.status&&a.attemptCount<3?this._retry(a,t):this._resolve(a,t,void 0)})}catch(t){return void e.forEach(e=>e.reject(t))}}_flush(){this._sendBatchRequest().catch(()=>{})}_retry(e,t){const n=t.headers?Number(t.headers["Retry-After"]):1;setTimeout(()=>{this._requests||(this._requests=[]),this._requests.push({...e,attemptCount:e.attemptCount+1}),20===this._requests.length?this._flush():this._sendBatchRequestDebounce()},1e3*n)}_resolve(e,t,a){e.resolve(new n.HttpClientResponse(new Response(JSON.stringify(t.body),{...t,headers:{...t.headers,"request-id":(a||"").toString()}})))}_getMSGraphClientAsync(){return this._msGraphClientPromise||(this._msGraphClientPromise=this._graphFactory.getClientInternal("3")),this._msGraphClientPromise}constructor(e){e.whenFinished(()=>{this._graphFactory=e.consume(n.MSGraphClientFactory.serviceKey)}),this._sendBatchRequestDebounce=(0,a.debounce)(this._sendBatchRequest,1e3)}}o.serviceKey=e.ServiceKey.create("PeopleWebPart.GraphHttpClientBatch",o);const s="PeopleProfile";class l{getItem(e){return this._getStoreAsync("readonly","GetItem").then(n=>{const a=n.get(e);return new Promise((n,i)=>{a.onsuccess=()=>{const t=a.result;t?.expirationTimeStamp>Date.now()?n(t.peopleProfile):(t&&this._removeItemAsync(e),n(void 0))},a.onerror=e=>{t._TraceLogger.logError(l._logSource,new Error(`GetItem failed on transaction stage with error ${e}`)),n(void 0)}})})}setItem(e){this._itemsToBeCached.some(t=>t.id===e.id)||(this._itemsToBeCached.push(e),this._setCacheItemsDebounce())}setItems(e){return this._getStoreAsync("readwrite","SetItem").then(n=>{e.forEach(e=>{const a={expirationTimeStamp:Date.now()+864e5,peopleProfile:e};n.put(a,e.id).onerror=e=>{t._TraceLogger.logError(l._logSource,new Error(`Save item failed on transaction stage with error ${e}`))}})})}removeAllExpired(){return this._getStoreAsync("readwrite","RemoveAllExpired").then(e=>{const n=e.openCursor();n.onsuccess=()=>{if(n.result){const t=n.result.value;t?.expirationTimeStamp<=Date.now()&&e.delete(t.peopleProfile.id),n.result.continue()}},n.onerror=e=>{t._TraceLogger.logError(l._logSource,new Error(`RemoveAllExpired item failed on transaction stage with error ${e}`))}})}_removeItemAsync(e){return this._getStoreAsync("readwrite","RemoveItem").then(n=>{n.delete(e).onerror=e=>{t._TraceLogger.logError(l._logSource,new Error(`RemoveItem item failed on transaction stage with error ${e}`))}})}_openDBAsync(){if(!window.indexedDB)return Promise.reject("indexedDB not supported");const e=indexedDB.open("SPPeopleDataProvider");return new Promise((t,n)=>{e.onsuccess=()=>{this._db=e.result,t(this._db)},e.onupgradeneeded=()=>{this._db=e.result,this._db.objectStoreNames.contains(s)||this._db.createObjectStore(s,{autoIncrement:!1})},e.onerror=()=>{n(e.error)}})}async _getStoreAsync(e,n){if(!this._db)try{await this._openDBAsync()}catch(e){return t._TraceLogger.logError(l._logSource,new Error(`${n} failed on Open DB stage with error ${e}`)),Promise.reject()}return this._db.transaction(s,e).objectStore(s)}constructor(){this._itemsToBeCached=[],this._setCacheItemsDebounce=(0,a.debounce)(()=>{this.setItems(this._itemsToBeCached),this._itemsToBeCached=[]},1e3)}}l._logSource=t._LogSource.create("IndexedDBPeopleCacheProvider");const u=!!window.indexedDB,f="/_api/SP.UserProfiles.PeopleManager/GetPropertiesFor(AccountName=@v)";class p{async getPeopleInfo(e){if(!e){const e=new Error("Empty people id to query");throw t._TraceLogger.logError(t._LogSource.create(this._scenarioName),e,"getPeopleInfo"),e}return await p._peopleCacheProvider.getItem(e)||(this._startsWith(e,"i:0#.f|membership|")?this._getPeopleInfoByUserPrincipalName(e):this._endsWith(e,".onmicrosoft.com")?this._getPeopleInfoByUserPrincipalName(`i:0#.f|membership|${e}`):this._contains(e,"@")&&this._contains(e.substr(0,e.indexOf("@")),".")?this._getPeopleInfoBySearchPeople(e):this._contains(e,"@")?this._getPeopleInfoByAliasEmail(e):this._getPeopleInfoBySearchPeople(e))}async _getPeopleInfoByUserPrincipalName(e){const i=new r._QosMonitor(`${this._scenarioName}.PeopleDataProvider.GetPeopleInfoByUserPrincipalName`);let o,s="unknown";try{if(!p._spHttpClientBatchGet){const e=this._spHttpClient.beginBatch(),i=()=>{p._spHttpClientBatchGet=void 0,e.execute().catch(e=>t._TraceLogger.logError(t._LogSource.create(this._scenarioName),e,"GetPeopleInfoByUserPrincipalName"))},r=(0,a.debounce)(i,1e3);p._spHttpClientBatchGet=t=>{const a=e.get(t,n.SPHttpClientBatch.configurations.v1);return e.batchedSize()>=20?i():r(),a}}const r=await p._spHttpClientBatchGet(this._generateSPUserProfileUrl(e));if(s=r.correlationId?r.correlationId.toString():"Unknown",!r.ok)throw o=r.status,new Error(`The request is failed for endpoint ${f}.`);const c=await r.json();if(c["@odata.null"])throw new Error(`No person returned for request ${f}.`);const d=c.UserProfileProperties?c.UserProfileProperties.reduce((e,t)=>(0,a.extend)(e,{[t.Key]:t.Value}),{}):{},l={id:c.AccountName,name:c.DisplayName||"",email:c.Email||"",role:c.Title||"",firstName:d.FirstName||"",lastName:d.LastName||"",upn:d["SPS-UserPrincipalName"]||"",phone:d.WorkPhone||"",sip:d["SPS-SipAddress"]||"",department:d.Department||""};return i.writeSuccess(),p._peopleCacheProvider.setItem(l),l}catch(e){if("string"==typeof e||404===o){const t=new Error(e);throw i.writeExpectedFailure("ExpectedFailure",t,{correlationId:s,status:o}),t}throw i.writeUnexpectedFailure("UnexpectedFailure",e,{correlationId:s,status:o}),e}}async _getPeopleInfoBySearchPeople(t){const n=new r._QosMonitor(`${this._scenarioName}.PeopleDataProvider.GetPeopleInfoBySearchPeople`);let a,i="unknown";try{const r=await this._graphHttpClientBatch.get(this._generateGraphSearchUrl(t));if(i=e.Guid.tryParse(r.headers.get("request-id"))?e.Guid.tryParse(r.headers.get("request-id")).toString():"Unknown",!r.ok){a=r.status;const e=await this._getErrorMessage(r);throw new Error(`The request is failed for endpoint v1.0/me/people. Error message: ${e}`)}const o=await r.json();if(0===(o?.value||[]).length)throw new Error("No person returned for endpoint v1.0/me/people.");const s=o.value[0],c={id:s.userPrincipalName||s.scoredEmailAddresses[0]?.address||"",name:s.displayName||"",email:s.scoredEmailAddresses?.[0]?.address||"",role:s.jobTitle||"",firstName:s.givenName||"",lastName:s.surname||"",department:s.department||"",upn:s.userPrincipalName||"",phone:s.phones?.[0]?.number||""};return n.writeSuccess(),p._peopleCacheProvider.setItem(c),c}catch(e){if("string"==typeof e||404===a){const t=new Error(e);throw n.writeExpectedFailure("ExpectedFailure",t,{correlationId:i,status:a}),t}throw n.writeUnexpectedFailure("UnexpectedFailure",e,{correlationId:i,status:a}),e}}async _getPeopleInfoByAliasEmail(t){const n=new r._QosMonitor(`${this._scenarioName}.PeopleDataProvider.GetPeopleInfoByAliasEmail`);let a,i="unknown";try{const r=await this._graphHttpClientBatch.get(this._generateGraphUserUrl(t));if(i=e.Guid.tryParse(r.headers.get("request-id"))?e.Guid.tryParse(r.headers.get("request-id")).toString():"Unknown",!r.ok){a=r.status;const e=await this._getErrorMessage(r);throw new Error(`The request is failed for endpoint v1.0/users/. Error message: ${e}`)}const o=await r.json(),s={id:o.userPrincipalName,name:o.displayName||"",email:o.mail||"",role:o.jobTitle||"",firstName:o.givenName||"",lastName:o.surname||"",upn:o.userPrincipalName||"",department:o.department||"",phone:o.businessPhones?.[0]||""};return n.writeSuccess(),p._peopleCacheProvider.setItem(s),s}catch(e){throw 404===a?n.writeExpectedFailure("ExpectedFailure",e,{correlationId:i,status:a}):n.writeUnexpectedFailure("UnexpectedFailure",e,{correlationId:i,status:a}),e}}async _getErrorMessage(e){try{return(await e.json()).error.message.replace(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi,"PIIInfo")}catch{return"N/A"}}_startsWith(e,t){return 0===e.indexOf(t)}_endsWith(e,t){return e.indexOf(t)+t.length===e.length}_contains(e,t){return-1!==e.indexOf(t)}_generateSPUserProfileUrl(e){return`${this._pageContext.web.absoluteUrl}${f}?@v='${encodeURIComponent(e)}'&$select=AccountName,DisplayName,Email,Title,UserProfileProperties`}_generateGraphSearchUrl(e){return`v1.0/me/people?$search="${encodeURIComponent(e)}"&$top=1&$select=userPrincipalName,displayName,givenName,surname,jobTitle,department,scoredEmailAddresses,phones`}_generateGraphUserUrl(e){return`v1.0/users/${e}?$select=displayName,givenName,userPrincipalName,mail,jobTitle,surname,businessPhones,department`}constructor(e,t){this._pageContext=e.consume(i.PageContext.serviceKey),this._spHttpClient=e.consume(n.SPHttpClient.serviceKey),this._graphHttpClientBatch=e.consume(o.serviceKey),this._scenarioName=t}}p._peopleCacheProvider=u?function(){const e=new l;let t=!1;return window.requestIdleCallback?window.requestIdleCallback(function n(a){for(;a.timeRemaining()>0||!t;)e.removeAllExpired(),t=!0;!t&&window.requestIdleCallback&&window.requestIdleCallback(n)}):window.requestAnimationFrame(()=>e.removeAllExpired()),e}():new class{getItem(e){return Promise.resolve(this._peopleCache.get(e))}setItem(e){this._peopleCache.set(e.id,e)}constructor(){this._peopleCache=new Map}}})(),d})());