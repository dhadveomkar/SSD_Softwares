define("38dad27e-9ea8-479c-b7f0-c017f7834f88_0.1.0",["@msinternal/sp-ai-properties-tools-internal","@msinternal/sp-ai-properties-tools","@msinternal/sp-canvas-types","@msinternal/sp-pages-authoring"],(e,t,n,a)=>(()=>{"use strict";var i={286:e=>{e.exports=t},384:t=>{t.exports=e},560:e=>{e.exports=n},368:e=>{e.exports=a}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={exports:{}};return i[e](n,n.exports,o),n.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{o.r(s),o.d(s,{getAIPropertiesFromCanvasContent:()=>l,getCurrentAIPageDataAIProperties:()=>d,getCurrentAIPageDataRaw:()=>r,getPagesFluidContext:()=>i});var e=o(384),t=o(286),n=o(560),a=o(368);function i(e){const t=e.consume(a.SPAuthoringPageContext.serviceKey).getFluidContext();if(t)return t;throw new Error("Fluid context is not set")}function r(e){const n=i(e),{fluidOrchestrator:a}=n;return a.manageSharedTreeData(({sharedTreeDataManager:e})=>{const n=e.root.mainAuthoringContent.canvas;return{pageDescription:e.root.pageMetadata.pageDescription,canvas:{regularLayout:{sections:n.regularLayout.zones.filter(t=>!e.isNodeInstanceOfSchema(t,"ZonePlaceholder")).map(n=>{const{zoneBackground:a,zoneEmphasis:i,sections:r}=n;return{id:n.id,layout:(0,t.getSectionLayoutFromSectionFactors)(n.sections.map(e=>e.sectionFactor)),sectionBackground:(0,t.fromCanvasBackgroundStringToSectionBackgroundResult)(a),sectionEmphasis:(0,t.fromSPVariantThemeTypeToSectionEmphasisName)(i),columns:r.filter(e=>e.sectionVisibility).map(t=>{const{controls:n}=t;return{controls:n.map(t=>c(t,e))}})}})},verticalLayout:n.verticalLayout?{controls:n.verticalLayout.zone.section.controls.map(t=>c(t,e))}:void 0}}})}function c(e,a){const i=e.flexibleLayoutPosition;let r;if(i){const e=JSON.parse(i);r=(0,t.mapFlexibleLayoutPositionToRaw)(e)}if(a.isNodeInstanceOfSchema(e,"WebPartControl")){const t=JSON.parse(e.webPartData.payload);return{instanceId:e.id,control:{controlType:n.CanvasControlType.WebPartZone,webPartId:t.id,webPartData:t},flexibleLayoutPosition:r}}return{instanceId:e.id,control:{controlType:n.CanvasControlType.RTE,innerHTML:e.innerHTML.payload},flexibleLayoutPosition:r}}function d(t,n){const a=r(t);return(0,e.fromAIPageDataRawToAIPropertiesWithFallback)({rawPageData:a,webPartManifests:n})}function l(a,i){const r=function(e){const a=e.controls,i=t=>{if(t)return e.canvasExtraData?.webPartData?.properties?.zoneBackground?.[t]},r=e=>{if((0,n.isWebPart)(e)||(0,n.isRte)(e))return function(e){if((0,n.isWebPart)(e)){const a=(0,t.mapFlexibleLayoutPositionToRaw)(e.flexibleLayoutPosition);return{instanceId:e.id,control:{controlType:n.CanvasControlType.WebPartZone,webPartId:e.webPartId,webPartData:e.webPartData},flexibleLayoutPosition:a}}if((0,n.isRte)(e)){const a=(0,t.mapFlexibleLayoutPositionToRaw)(e.flexibleLayoutPosition);return{instanceId:e.id,control:{controlType:n.CanvasControlType.RTE,innerHTML:e.innerHTML},flexibleLayoutPosition:a}}}(e)},o=[],s=new Map;return a.forEach(e=>{const t=1===e.position?.layoutIndex;if(!(0,n.isWebPart)(e)&&!(0,n.isRte)(e))return;if(!t)return void o.push(e);const a=e.position?.zoneId||"",i=e.position?.zoneIndex||0,r=e.position?.sectionIndex||1,c=e.position?.sectionFactor||12;s.has(a)||s.set(a,{zoneIndex:i,columns:new Map});const d=s.get(a);if(!d)return;d.columns.has(r)||d.columns.set(r,{controls:[],sectionFactor:c});const l=d.columns.get(r);l&&l.controls.push(e)}),{pageDescription:"",canvas:{regularLayout:{sections:Array.from(s.entries()).map(([e,n])=>{const a=Array.from(n.columns.values()).map(e=>e.sectionFactor),o=Array.from(n.columns.entries()).sort(([e],[t])=>e-t).map(([,e])=>({controls:e.controls.map(r).filter(e=>void 0!==e)})),s=Array.from(n.columns.values())[0]?.controls[0];return{id:e,layout:(0,t.getSectionLayoutFromSectionFactors)(a),sectionBackground:(0,t.fromCanvasBackgroundDataToSectionBackgroundResult)(i(e)),sectionEmphasis:(0,t.fromSPVariantThemeTypeToSectionEmphasisName)(s?.emphasis?.zoneEmphasis),columns:o}})},verticalLayout:o.length>0?{controls:o.map(r).filter(e=>void 0!==e)}:void 0}}}(a);return(0,e.fromAIPageDataRawToAIPropertiesWithFallback)({rawPageData:r,webPartManifests:i})}})(),s})());