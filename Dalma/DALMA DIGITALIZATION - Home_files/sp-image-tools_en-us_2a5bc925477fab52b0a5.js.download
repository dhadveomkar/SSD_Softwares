define("1e49a922-5650-4595-926f-4d19966e0e67_1.0.0",["react","@ms/office-ui-fabric-react-bundle","@microsoft/sp-core-library","@microsoft/sp-lodash-subset","@microsoft/load-themed-styles","@msinternal/sp-component-utilities","@msinternal/sp-telemetry","@msinternal/sp-fluentui-migration-tooltip-bundle","@msinternal/sp-fluentui-migration-button-bundle","react-dom","@microsoft/sp-diagnostics","@microsoft/sp-http"],(e,t,n,a,i,r,o,s,c,d,l,u)=>(()=>{"use strict";var f={424:e=>{e.exports=i},676:e=>{e.exports=n},207:e=>{e.exports=l},909:e=>{e.exports=u},529:e=>{e.exports=a},141:e=>{e.exports=t},718:e=>{e.exports=r},575:e=>{e.exports=c},94:e=>{e.exports=s},519:e=>{e.exports=o},959:t=>{t.exports=e},398:e=>{e.exports=d}},p={};function m(e){var t=p[e];if(void 0!==t)return t.exports;var n=p[e]={exports:{}};return f[e](n,n.exports,m),n.exports}m.d=(e,t)=>{for(var n in t)m.o(t,n)&&!m.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},m.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),m.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var _={};return(()=>{m.r(_),m.d(_,{ActionBar:()=>D,CdnService:()=>H,DEFAULT_FOCAL_OFFSET:()=>x,FocalPoint:()=>A,LowQualityImagePlaceholder:()=>$,TenantCdnDataProvider:()=>U,createImageFromBlurHash:()=>Z,defaultToCenter:()=>C,generateBlurHash:()=>X,getAverageImageBrightness:()=>L,getBackgroundImageOverlay:()=>k});var e=m(959),t=m(141),n=m(94),a=m(575),i=m(676),r=m(529),o=m(424);(0,o.loadStyles)([{rawString:".ms-odsp-screenReaderAlert{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}"}]);class s extends e.PureComponent{static read(e,t){if(e){const n=document.createTextNode(e);s._getDedicatedDomNode(t||1).appendChild(n)}}static _getDedicatedDomNode(e){s._alertNode&&document.body.removeChild(s._alertNode);const t=document.createElement("div");switch(t.setAttribute("data-automation-id","screen-reader-alert-static"),t.classList.add("ms-odsp-screenReaderAlert"),e){case 1:t.setAttribute("aria-live","polite");break;case 2:t.setAttribute("role","alert"),t.setAttribute("aria-live","assertive")}return document.body.appendChild(t),s._alertNode=t,s._alertNode}componentDidMount(){s.read(this.props.message,this.props.readingMode)}componentDidUpdate(e){e.message===this.props.message&&e.indicator===this.props.indicator||s.read(this.props.message,this.props.readingMode)}render(){return!1}}var c=m(718),d=m(519);function l(){return i._SPFlight.isEnabled(60803)}o.loadStyles('.i_fFGvK_hlP5V{background-color:hsla(0,0%,100%,.8);bottom:0;display:flex;height:36px;justify-content:space-between;left:0;position:absolute;right:0;transition:opacity .167s cubic-bezier(.1,.9,.2,1);width:100%}.i_fFGvK_hlP5V.h_GdAF9_hlP5V,.i_fFGvK_hlP5V.i_ezErm_hlP5V{opacity:0}.i_fFGvK_hlP5V.r_f9sRw_hlP5V{flex-direction:row-reverse}.i_fFGvK_hlP5V.a_snJwS_hlP5V{background-color:"[theme:neutralQuaternaryAlt, default: #e1dfdd]";opacity:.8;transition:opacity .167s cubic-bezier(.1,.9,.2,1)}.i_fFGvK_hlP5V.a_snJwS_hlP5V.h_GdAF9_hlP5V,.i_fFGvK_hlP5V.a_snJwS_hlP5V.i_ezErm_hlP5V{opacity:0}.i_jT0Dn_hlP5V{align-items:center;color:"[theme:neutralDark, default: #201f1e]";display:flex}.i__p01U_hlP5V:focus,.i__p01U_hlP5V:hover{color:"[theme:themePrimary, default: #0078d4]"}.f_BQ8om_hlP5V{bottom:8px;width:auto}[dir=ltr] .f_BQ8om_hlP5V{left:unset}[dir=rtl] .f_BQ8om_hlP5V{right:unset}[dir=ltr] .f_BQ8om_hlP5V{right:8px}[dir=rtl] .f_BQ8om_hlP5V{left:8px}',!0);const u="i_jT0Dn_hlP5V",f=JSON.parse('{"lY":"Set focal point","qG":"Zoom in","Q4":"Zoom out","Y5":"Edit details","hr":"Press enter to change the title, link, image, or other options for this item.","T0":"Move item","V9":"Current zoom ratio is {0}."}');function p(){return i._SPKillSwitch.isActivated("f8ad6c4f-b42f-4943-a204-e6b6c2b93a8f")}const h={iconName:"FocalPoint"},b={iconName:"ZoomIn"},g={iconName:"ZoomOut"},v={iconName:"Edit"},y={iconName:"Options20Regular"},S={iconName:"Move"};class D extends e.PureComponent{componentDidUpdate(e){e.isSettingFocalPoint&&!this.props.isSettingFocalPoint&&this._focalPointButton.current&&this._focalPointButton.current.focus()}render(){const r=`grid-edit-button${this.props.itemId}`,o=void 0!==this.props.onSetFocalPoint&&e.createElement(n.TooltipHost,{content:f.lY},e.createElement(a.IconButton,{componentRef:this._focalPointButton,onClick:this.props.onSetFocalPoint,iconProps:h,title:f.lY,ariaLabel:f.lY,"data-automation-id":"focal-point-button",role:"menuitem"})),s=void 0!==this.props.onSetZoomFactor&&e.createElement(n.TooltipHost,{content:f.qG},e.createElement(a.IconButton,{onClick:this._handleZoomIn,iconProps:b,title:f.qG,ariaLabel:f.qG,"data-automation-id":"zoom-in-button",role:"menuitem"})),c=void 0!==this.props.onSetZoomFactor&&e.createElement(n.TooltipHost,{content:f.Q4},e.createElement(a.IconButton,{onClick:this._handleZoomOut,iconProps:g,title:f.Q4,ariaLabel:f.Q4,"data-automation-id":"zoom-out-button",role:"menuitem"})),d=e.createElement(n.TooltipHost,{content:f.Y5},e.createElement(a.IconButton,{onClick:this.props.onEdit,onFocus:this.props.onIconFocus,iconProps:i._SPKillSwitch.isActivated("4712fe5a-9c49-4267-a228-876aef2e8ce2")||i._SPKillSwitch.isActivated("a3f45048-0db5-4b7c-9a9a-e3183d216c4d")?v:y,title:f.Y5,ariaLabel:f.Y5,ariaDescription:f.hr,"data-automation-id":"edit-button",id:r,role:"menuitem"})),p=e.createElement("div",{className:u},d,o,s,c),m=this.props.hasMoveButton&&e.createElement(n.TooltipHost,{content:f.T0},e.createElement(a.IconButton,{onFocus:this.props.onIconFocus,iconProps:S,title:f.T0,ariaLabel:f.T0,"data-automation-id":"move-button",role:"menuitem"})),_=e.createElement("div",{className:u},m),D=(0,t.css)("i_fFGvK_hlP5V",this.props.hidden&&"h_GdAF9_hlP5V",this.props.isSettingFocalPoint&&"i_ezErm_hlP5V",this.props.reverseRow&&"r_f9sRw_hlP5V","a_snJwS_hlP5V",l()&&"f_BQ8om_hlP5V");let I;if(l()){const{effects:e}=(0,t.getTheme)();I={borderRadius:e?.roundedCorner4,overflow:"hidden",button:{width:34,height:34,borderRadius:e?.roundedCorner4,color:"inherit"}}}return e.createElement("div",{className:(0,t.mergeStyles)(D,I),role:"menubar","aria-activedescendant":r},_,p)}constructor(t){super(t),this._focalPointButton=e.createRef(),this._handleZoomIn=()=>{if(this.props.onSetZoomFactor&&void 0!==this.props.imageItem){const e=1.1*(this.props.imageItem.zoomRatio||1);this.props.onSetZoomFactor({...this.props.imageItem,zoomRatio:e}),this._alertZoomRatio(e),d._EngagementLogger.log({name:"ImageTools.ZoomIn",extraData:{ratio:e}})}},this._handleZoomOut=()=>{if(this.props.onSetZoomFactor&&void 0!==this.props.imageItem){const e=.9*(this.props.imageItem.zoomRatio||1);this.props.onSetZoomFactor({...this.props.imageItem,zoomRatio:e}),this._alertZoomRatio(e),d._EngagementLogger.log({name:"ImageTools.ZoomOut",extraData:{ratio:e}})}},this._alertZoomRatio=e=>{p()?c.ScreenReaderAlert.read(i.Text.format(f.V9,e.toFixed(2)),c.ReadingMode.ReadImmediately):s.read(i.Text.format(f.V9,e.toFixed(2)),2)},this._alertZoomRatio=(0,r.debounce)(this._alertZoomRatio,500)}}var I=m(398);const x=50;function C(e){return e||{x:x,y:x}}o.loadStyles('.f_8T44K_hlP5V{background-color:"[theme:blackTranslucent40, default: rgba(0,0,0,.4)]";height:100%;opacity:0;position:relative;transition:all .5s ease;width:100%}.h_N_L-5_hlP5V .f_8T44K_hlP5V{display:none}.f_8T44K_hlP5V .f_XQWGI_hlP5V{align-items:center;background-color:"[theme:whiteTranslucent40, default: rgba(255,255,255,.4)]";border:2px solid "[theme:yellowlight, default: #fff100]";border-radius:50%;display:flex;height:64px;justify-content:center;left:50%;pointer-events:none;position:absolute;top:50%;transform:translate(-50%,-50%);-webkit-user-select:none;-ms-user-select:none;user-select:none;width:64px}.f_8T44K_hlP5V .f_XQWGI_hlP5V .f_stT8B_hlP5V{color:#fff;font-size:32px;position:relative}.f_8T44K_hlP5V .f_FwNMP_hlP5V{color:#fff;font-size:14px;left:50%;margin-top:50px;position:absolute;top:50%;transform:translate(-50%,-50%)}.f_8T44K_hlP5V.i_8sbin_hlP5V{opacity:1;z-index:2}.f_8T44K_hlP5V.i_yYqi2_hlP5V{cursor:pointer}.f_3U2cK_hlP5V{position:absolute}',!0);const O="f_8T44K_hlP5V",w=JSON.parse('{"iU":"Focal point set at {0} percent from left and {1} percent from top.","dt":"Drag to set a focal point.","V":"Use up, down, right, and left arrow keys to set focal point of image. Use Enter key to leave focal point mode.","ht":"Focal point setting finished."}');function E(){return i._SPKillSwitch.isActivated("a44cd83e-3a5a-4ac6-99e4-402e13bde3d6")}class A extends t.BaseComponent{static focus(e){setTimeout(()=>{if(e){const t=I.findDOMNode(e);if(t instanceof Element){const e=t.classList.contains(O)?t:t.querySelector(".f_8T44K_hlP5V");e instanceof HTMLElement&&(p()?c.ScreenReaderAlert.read(w.V,c.ReadingMode.ReadImmediately):s.read(w.V,2),e.setAttribute("data-automation-id","focalFrameIsSetting"),e.focus())}}})}render(){const{x:n,y:a}=C(this.props.position),r=void 0===this.props.position&&e.createElement("div",{className:"f_FwNMP_hlP5V"},w.dt),o=(0,t.css)(O,!i._SPKillSwitch.isActivated("4537cf0c-7c62-4542-b3cc-132bdc628c51")&&"f_3U2cK_hlP5V","i_8sbin_hlP5V",this.state.isDragging&&"i_yYqi2_hlP5V"),s=(0,t.css)((0,t.getIconClassName)("SIPMove"),"f_stT8B_hlP5V");return e.createElement("div",{className:o,tabIndex:0,role:"region",onMouseDown:this._onDragStart,onMouseMove:this._onDragMove,onMouseUp:this._onDragEnd,onMouseLeave:this._handleMouseLeave,onKeyDown:this._handleKeyDown,ref:this._focalFrame,"data-automation-id":this.state.isDragging?"focalFrameIsDragging":"","data-sp-a11y-skipkeys":"all"},e.createElement("div",{className:"f_XQWGI_hlP5V","data-automation-id":"titleRegionFocalCircle",style:{left:`${n}%`,top:`${a}%`}},e.createElement("i",{className:s,"aria-hidden":!0})),r)}_isKey(e,t){return t.keyCode===e&&!t.altKey&&!t.ctrlKey&&!t.shiftKey}_onFocalPointEnd(e){p()?c.ScreenReaderAlert.read(w.ht,c.ReadingMode.ReadImmediately):s.read(w.ht,2),this.props.onFocalPointEnd(e)}_onFocalPointMove(e){this._debounceReadPosition(e),this.props.onFocalPointMove(e)}_readPosition(e){const t=i._SPKillSwitch.isActivated("978713f6-fc4a-470b-9c78-ff990ab772d1")?i.Text.format(w.iU,e.x,e.y):i.Text.format(w.iU,Math.round(e.x),Math.round(e.y));p()?c.ScreenReaderAlert.read(t,c.ReadingMode.ReadImmediately):s.read(t,2)}constructor(n){super(n),this._focalFrame=e.createRef(),this._onDragStart=e=>{e.stopPropagation(),e.preventDefault(),this.setState({isDragging:!0})},this._onDragMove=e=>{if(this._focalFrame.current&&this.state.isDragging){e.preventDefault(),e.stopPropagation();const t=this._focalFrame.current.clientWidth,n=this._focalFrame.current.clientHeight,a=Math.min(Math.max(e.nativeEvent.offsetX,0),t),i=Math.min(Math.max(e.nativeEvent.offsetY,0),n);this._onFocalPointMove({x:a/t*100,y:i/n*100})}},this._onDragEnd=e=>{e.stopPropagation(),e.preventDefault(),this.setState({isDragging:!1}),this._onFocalPointEnd("Mouse"),A.focus(this._focalFrame.current)},this._handleMouseLeave=e=>{this.state.isDragging&&(e.stopPropagation(),e.preventDefault(),this.setState({isDragging:!1}),this._onFocalPointEnd("Mouse"))},this._handleKeyDown=e=>{e.stopPropagation(),e.preventDefault();let{x:n,y:a}=C(this.props.position);this._isKey(t.KeyCodes.enter,e)?this._onFocalPointEnd("Keyboard"):(this._isKey(t.KeyCodes.escape,e)?(n=50,a=50):this._isKey(t.KeyCodes.left,e)?n--:this._isKey(t.KeyCodes.up,e)?a--:this._isKey(t.KeyCodes.right,e)?n++:this._isKey(t.KeyCodes.down,e)&&a++,this._onFocalPointMove({x:Math.min(Math.max(Math.round(n),0),100),y:Math.min(Math.max(Math.round(a),0),100)}))},this._debounceReadPosition=this._async.debounce(this._readPosition,500,{leading:!1}),this.state={isDragging:!1}}}function L(e){return new Promise(t=>{const n=new Image;n.src=e,i._SPKillSwitch.isActivated("d836e865-e27f-495b-9a89-b622a2b621e3")||(n.crossOrigin="anonymous"),n.onload=()=>{const e=document.createElement("canvas");e.width=n.naturalWidth,e.height=n.naturalHeight;const a=e.getContext("2d");a.drawImage(n,0,0);const i=a.getImageData(0,0,e.width,e.height).data;let r=0;const o=[];for(let e=0;e<i.length;e+=4){const t=.299*i[e]+.587*i[e+1]+.114*i[e+2];r+=t,o.push(t)}const s=Math.floor(r/(n.naturalHeight*n.naturalWidth));t(s)}})}function k(e){return L(e).then(e=>{let t,n,a;return e<=153?(t="#000000",a=!0,n=e<=51?20:e<=102?40:60):(t="#FFFFFFF",a=!1,n=e<=204?80:60),{color:t,opacity:n,useLightText:a}})}A.hideClassName="h_N_L-5_hlP5V";var M=m(207),P=m(909);const T={jsonRequest:!0,jsonResponse:!0,defaultSameOriginCredentials:!0,defaultODataVersion:P.ODataVersion.v3,requestDigest:!0};class U{async getCdnUrls(e){const t=await this._spHttpClient.post(`${this._webAbsoluteUrl}/_api/tenantcdn/getcdnurls`,new P.SPHttpClientConfiguration(P.SPHttpClient.configurations.v1,T),{body:JSON.stringify({items:e})});return(await this._checkResponseStatus(t)).value}_extractErrorMessage(e){return e?e.message?e.message:e.error&&e.error.message?e.error.message:e["odata.error"]?`message=${e["odata.error"].message.value}|code=${e["odata.error"].code}`:"unknowError":""}constructor(e,t){this._checkResponseStatus=e=>e.status>=200&&e.status<=299?e.json():e.json().catch(t=>Promise.reject(new Error(`Unexpected response. Response code: ${e.status}. Correlation id: ${e.correlationId}. Error message: ${this._extractErrorMessage(t)}.`))),this._spHttpClient=e,this._webAbsoluteUrl=t}}const F=[2560,1600,960,400].sort(function(e,t){return t-e});class H{static createFromServiceScope(e,t){if(e._isFinished){const n=e.consume(P.SPHttpClient.serviceKey);if(n&&t){const e=new U(n,t);return new H(e)}M._TraceLogger.logError(H._logSource,new Error("CdnService.createFromServiceScope: spHttpClient or webAbsoluteUrl is undefined"))}else M._TraceLogger.logError(H._logSource,new Error("CdnService.createFromServiceScope: serviceScope is not finished"))}async seedImageBreakpointsIntoCdn(e,t){const n={serverRelativeUrl:"scrubbed",sourceWidth:t};if(!t||t<=0)return void(E()?this._proactiveThumbSeedMonitor.writeUnexpectedFailure(`naturalWidth invalid: ${t}`):this._proactiveThumbSeedMonitor.writeUnexpectedFailure("naturalWidth invalid",void 0,n));const a=async e=>{const a=F.filter(e=>e<=t);n.breakpointsAvailable=a.join(",");const r=[];for(const n of a){const o={breakpoint:n,isFirstBreakpoint:n===a[0],isRetry:!1,isAbandoned:!1,isSuccessful:!1,statusCode:0,statusText:""},s=new M._QosMonitor("ProactiveThumbnailSeedItem"),c={serverRelativeUrl:"scrubbed",breakpoint:n,isFirstBreakpoint:o.isFirstBreakpoint,sourceWidth:t};try{const a=this._updatePreferOptimized(e),d=this._updateThumbnailWidth(a,n),l=await this._fetchImageBlob(d);if(o.isSuccessful=!0,o.statusCode=l.status,o.statusText=l.statusText,c.cdnUrlWithWidth="scrubbed",c.statusCode=o.statusCode,c.sourceWidth=t,!i._SPKillSwitch.isActivated("75282f9d-b485-4141-9879-737fc14d46a2"))try{const e=await this._getImageInfo(await l.blob());c.actualWidth=e.width,c.actualHeight=e.height,c.size=e.sizeBytes,c.type=e.mimeType}catch(e){M._TraceLogger.logError(H._logSource,e)}s.writeSuccess(c)}catch(e){o.statusCode=e?.statusCode,o.statusText=e?.statusText,c.statusCode=o.statusCode,c.statusText=o.statusText;const t=new Error(`<serverRelativeUrl>scrubbed</serverRelativeUrl> <statusCode>${c.statusCode}</statusCode> Error:${e?.error}`);if(s.writeUnexpectedFailure(`Failed for width: ${n}`,t,c),o.isFirstBreakpoint){o.isAbandoned=!0;break}M._TraceLogger.logError(H._logSource,e)}finally{r.push(o)}}n.successfulBreakpoints=r.filter(e=>e.isSuccessful).map(e=>e.breakpoint).join(","),n.failedBreakpoints=r.filter(e=>!e.isSuccessful).map(e=>e.breakpoint).join(","),1===r.length&&r.length<a.length?(n.statusCode=r[0].statusCode,n.statusText=r[0].statusText,this._proactiveThumbSeedMonitor.writeUnexpectedFailure("seedCdn",new Error("Initial thumb failed. Abandoned all subsequent attempts."),n)):r.some(e=>e.isSuccessful)?this._proactiveThumbSeedMonitor.writeSuccess(n):0===r.length?this._proactiveThumbSeedMonitor.writeExpectedFailure(E()?"No available breakpoints to process: scrubbed":"No available breakpoints to process",void 0,n):this._proactiveThumbSeedMonitor.writeUnexpectedFailure("All failed",new Error("Impossible failure. Logic around abandoning at first items failure must have changed."),n)};try{const t=await this.getCdnURLForItem(e);if(void 0===t)return void(E()?this._proactiveThumbSeedMonitor.writeUnexpectedFailure("cdnUrlResult is undefined"):this._proactiveThumbSeedMonitor.writeUnexpectedFailure("cdnUrlResult is undefined",void 0,n));if(!t.CdnUrl)return void(E()?this._proactiveThumbSeedMonitor.writeExpectedFailure("No CDN url for the provided item: scrubbed"):this._proactiveThumbSeedMonitor.writeExpectedFailure("No CDN url for the provided item",void 0,n));await a(t.CdnUrl)}catch(e){E()?this._proactiveThumbSeedMonitor.writeUnexpectedFailure("Cannot Continue",e):this._proactiveThumbSeedMonitor.writeUnexpectedFailure("Cannot Continue",e,n),M._TraceLogger.logError(H._logSource,e)}}getCdnURLForItem(e){return this._tenantCdnDataProvider.getCdnUrls([e]).then(e=>{if(e.length>0)return e[0]})}_updateThumbnailWidth(e,t){return`${e}${-1===e.indexOf("?")?"?":"&"}width=${t}`}_updatePreferOptimized(e){return i._SPKillSwitch.isActivated("f223316a-d833-4394-8b17-bbb07fbcce9f")?e:`${e}${-1===e.indexOf("?")?"?":"&"}preferOptimized=true`}async _fetchImageBlob(e,t){const n=new Headers(t),a=new AbortController,i=setTimeout(()=>a.abort("Request timed out after: 5000ms"),5e3);try{const t=await fetch(e,{headers:n,cache:"reload",redirect:"follow",signal:a.signal});if(clearTimeout(i),t.ok)return t;throw new Error(`Request Failed: ${t.status} ${t.statusText}`)}catch(e){if(a.signal.aborted)throw new Error(a.signal.reason);throw e}}_getImageInfo(e){return new Promise((t,n)=>{try{const a=URL.createObjectURL(e),i=new Image;i.onload=()=>{const n={width:i.naturalWidth,height:i.naturalHeight,sizeBytes:e.size,mimeType:e.type};t(n)},i.onerror=()=>{n()},i.src=a}catch(e){n(e)}})}constructor(e){this._proactiveThumbSeedMonitor=new M._QosMonitor("ProactiveThumbnailSeed"),this._tenantCdnDataProvider=e}}H._logSource=M._LogSource.create("CdnService");var R=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],N=e=>{let t=0;for(let n=0;n<e.length;n++){let a=e[n];t=83*t+R.indexOf(a)}return t},B=(e,t)=>{var n="";for(let a=1;a<=t;a++){let i=Math.floor(e)/Math.pow(83,t-a)%83;n+=R[Math.floor(i)]}return n},j=e=>{let t=e/255;return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},V=e=>{let t=Math.max(0,Math.min(1,e));return t<=.0031308?Math.trunc(12.92*t*255+.5):Math.trunc(255*(1.055*Math.pow(t,.4166666666666667)-.055)+.5)},z=(e,t)=>(e=>e<0?-1:1)(e)*Math.pow(Math.abs(e),t),G=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},K=e=>{let t=e>>8&255,n=255&e;return[j(e>>16),j(t),j(n)]},W=(e,t)=>{let n=Math.floor(e/361),a=Math.floor(e/19)%19,i=e%19;return[z((n-9)/9,2)*t,z((a-9)/9,2)*t,z((i-9)/9,2)*t]},q=(e,t,n,a)=>{let i=0,r=0,o=0,s=4*t;for(let c=0;c<t;c++){let t=4*c;for(let d=0;d<n;d++){let n=t+d*s,l=a(c,d);i+=l*j(e[n]),r+=l*j(e[n+1]),o+=l*j(e[n+2])}}let c=1/(t*n);return[i*c,r*c,o*c]};const Q="LowQualityImagePlaceholder",Y="Unknown",J=M._LogSource.create(Q);function X(e,t=100,n){return new Promise((a,i)=>{const r=new M._QosMonitor(Q+".GenerateBlurHash"),o=new Image;o.crossOrigin="Anonymous",o.onload=()=>{try{const e=Math.min(1,t/Math.max(o.width,o.height)),s=Math.floor(o.width*e),c=Math.floor(o.height*e),d=document.createElement("canvas");d.width=s,d.height=c;const l=d.getContext("2d");if(!l){const e=new Error("Failed to get canvas context");return r.writeUnexpectedFailure("CanvasContextFailed",e,{webPartName:n||Y}),void i(e)}l.drawImage(o,0,0,s,c);const u=l.getImageData(0,0,s,c),f=function(){if("undefined"==typeof window||void 0===window.location)return;const e=new URLSearchParams(window.location.search).get("changeLQIPQuality");if(null===e||""===e)return;const t=parseInt(e,10);return isNaN(t)||t<1||t>10?void 0:t}(),p=f||s>c?3:2,m=f||s>c?2:3,_=((e,t,n,a,i)=>{if(a<1||a>9||i<1||i>9)throw new G("BlurHash must have between 1 and 9 components");if(t*n*4!==e.length)throw new G("Width and height must match the pixels array");let r=[];for(let o=0;o<i;o++)for(let i=0;i<a;i++){let a=0==i&&0==o?1:2,s=q(e,t,n,(e,r)=>a*Math.cos(Math.PI*i*e/t)*Math.cos(Math.PI*o*r/n));r.push(s)}let o,s=r[0],c=r.slice(1),d="";if(d+=B(a-1+9*(i-1),1),c.length>0){let e=Math.max(...c.map(e=>Math.max(...e))),t=Math.floor(Math.max(0,Math.min(82,Math.floor(166*e-.5))));o=(t+1)/166,d+=B(t,1)}else o=1,d+=B(0,1);return d+=B((e=>(V(e[0])<<16)+(V(e[1])<<8)+V(e[2]))(s),4),c.forEach(e=>{d+=B(((e,t)=>19*Math.floor(Math.max(0,Math.min(18,Math.floor(9*z(e[0]/t,.5)+9.5))))*19+19*Math.floor(Math.max(0,Math.min(18,Math.floor(9*z(e[1]/t,.5)+9.5))))+Math.floor(Math.max(0,Math.min(18,Math.floor(9*z(e[2]/t,.5)+9.5)))))(e,o),2)}),d})(u.data,s,c,p,m);r.writeSuccess({webPartName:n||Y,originalWidth:o.width.toString(),originalHeight:o.height.toString(),scaledWidth:s.toString(),scaledHeight:c.toString(),blurHashLength:_.length.toString()}),a(_)}catch(e){r.writeUnexpectedFailure("EncodingFailed",e instanceof Error?e:new Error("Unknown error"),{webPartName:n||Y}),i(new Error("Low Quality Image Placeholder failed to generate image: "+e))}},o.onerror=e=>{r.writeUnexpectedFailure("ImageLoadFailed",new Error("Failed to load image"),{webPartName:n||Y,error:e instanceof Error?e.message:"Error decoding image"}),i(new Error("Low Quality Image Placeholder failed to generate image: "+e))},o.src=e,M._EngagementLogger.logEventWithLogEntry(new M._LogEntry("LowQualityImagePlaceHolder","GenerateBlurHash",M._LogType.Event,{webPartName:n||Y}))})}function Z(e,t,n,a=1,i){const r=new M._QosMonitor(Q+".CreateImageFromBlurHash");try{const o=document.createElement("canvas");o.width=t,o.height=n;const s=o.getContext("2d");if(!s)throw new Error("Unable to get canvas 2D context");const c=((e,t,n,a)=>{(e=>{if(!e||e.length<6)throw new G("The blurhash string must be at least 6 characters");let t=N(e[0]),n=Math.floor(t/9)+1,a=t%9+1;if(e.length!==4+2*a*n)throw new G(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*a*n}`)})(e),a|=1;let i=N(e[0]),r=Math.floor(i/9)+1,o=i%9+1,s=(N(e[1])+1)/166,c=new Array(o*r);for(let t=0;t<c.length;t++)if(0===t){let n=N(e.substring(2,6));c[t]=K(n)}else{let n=N(e.substring(4+2*t,6+2*t));c[t]=W(n,s*a)}let d=4*t,l=new Uint8ClampedArray(d*n);for(let e=0;e<n;e++)for(let a=0;a<t;a++){let i=0,s=0,u=0;for(let d=0;d<r;d++)for(let r=0;r<o;r++){let l=Math.cos(Math.PI*a*r/t)*Math.cos(Math.PI*e*d/n),f=c[r+d*o];i+=f[0]*l,s+=f[1]*l,u+=f[2]*l}let f=V(i),p=V(s),m=V(u);l[4*a+0+e*d]=f,l[4*a+1+e*d]=p,l[4*a+2+e*d]=m,l[4*a+3+e*d]=255}return l})(e,t,n,a),d=s.createImageData(t,n);d.data.set(c),s.putImageData(d,0,0);const l=o.toDataURL();return r.writeSuccess({webPartName:i||Y,outputWidth:t.toString(),outputHeight:n.toString(),dataUrlLength:l.length.toString()}),M._EngagementLogger.logEventWithLogEntry(new M._LogEntry("LowQualityImagePlaceHolder","CreateImageFromBlurHash",M._LogType.Event,{operation:"CreateImageFromBlurHash",blurHashLength:e.length.toString(),width:t.toString(),height:n.toString(),webPartName:i||Y})),l}catch(e){throw r.writeUnexpectedFailure("DecodingFailed",e instanceof Error?e:new Error("Unknown error"),{webPartName:i||Y}),new Error("Low Quality Image Placeholder failed to decode blur hash: "+(e instanceof Error?e.message:"Unknown error"))}}const $=({encodedImage:t,alt:n="",webPartName:a,...i})=>{const r=e.useMemo(()=>{try{return Z(t,32,32,1,a)}catch(e){return M._TraceLogger.logError(J,e),""}},[t,a]);return e.createElement("img",{src:r,alt:n,style:{position:"absolute",borderRadius:"4px",width:"100%",height:"100%"},...i,"data-automation-id":"lowQualityImagePlaceholder"})}})(),_})());