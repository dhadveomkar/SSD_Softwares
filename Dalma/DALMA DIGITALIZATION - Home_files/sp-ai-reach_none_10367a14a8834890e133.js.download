define("bc4e7295-a03b-4296-8192-eeb0a8745dd7_0.1.0",["@microsoft/sp-diagnostics","@microsoft/sp-core-library","@microsoft/sp-page-context","@msinternal/sp-component-utilities","@microsoft/sp-http-base","@microsoft/sp-image-helper"],(e,t,n,a,i,r)=>(()=>{"use strict";var o={676:e=>{e.exports=t},207:t=>{t.exports=e},737:e=>{e.exports=i},949:e=>{e.exports=r},408:e=>{e.exports=n},718:e=>{e.exports=a}},s={};function c(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={exports:{}};return o[e](n,n.exports,c),n.exports}c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var d={};return(()=>{c.r(d),c.d(d,{ActionType:()=>U,getWorkflowExecutorAsync:()=>G,isAIReachEnabled:()=>B,isAltTextToolTipEnabled:()=>K});class e{constructor(t){e.assign(e,this,t)}static getTypeName(){return"AugLoop_Core_SchemaObject"}static getBaseTypes(){return[]}static getTypeNameFor(e){return e&&e.H_?e.H_.T_:void 0}static getBaseTypesFor(e){return e&&e.H_&&e.H_.B_&&Array.isArray(e.H_.B_)?e.H_.B_:[]}static getAllTypesFor(t){const n=e.getTypeNameFor(t);return n?[n,...e.getBaseTypesFor(t)]:[]}static matchesTypesFor(t,n){if(!Array.isArray(n)||0===n.length)return!0;const a=e.getTypeNameFor(t),i=e.getBaseTypesFor(t);for(const e of n){if(e===a)return!0;if(i.indexOf(e)>=0)return!0}return!1}static assign(e,t,n){if(n)for(const e of Object.keys(n))t[e]=n[e];return t.H_=e.H_,t}}e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()};class t{constructor(n){e.assign(t,this,n)}static getTypeName(){return"AugLoop_SharepointCopilot_AIReachBaseSignal"}static getBaseTypes(){return["AugLoop_Signals_Signal"]}static typeGuard(n){return e.matchesTypesFor(n,[t.getTypeName()])}}t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()};class n{constructor(t){e.assign(n,this,t)}static getTypeName(){return"AugLoop_SharepointCopilot_AIReachGenerateTitleSignal"}static getBaseTypes(){return["AugLoop_SharepointCopilot_AIReachBaseSignal","AugLoop_Signals_Signal"]}static typeGuard(t){return e.matchesTypesFor(t,[n.getTypeName()])}}n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()};class a{constructor(t){e.assign(a,this,t)}static getTypeName(){return"AugLoop_SharepointCopilot_AIReachGenerateDescriptionSignal"}static getBaseTypes(){return["AugLoop_SharepointCopilot_AIReachBaseSignal","AugLoop_Signals_Signal"]}static typeGuard(t){return e.matchesTypesFor(t,[a.getTypeName()])}}a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};class i{constructor(t){e.assign(i,this,t)}static getTypeName(){return"AugLoop_SharepointCopilot_AIReachGenerateThumbnailSignal"}static getBaseTypes(){return["AugLoop_SharepointCopilot_AIReachBaseSignal","AugLoop_Signals_Signal"]}static typeGuard(t){return e.matchesTypesFor(t,[i.getTypeName()])}}i.H_={T_:i.getTypeName(),B_:i.getBaseTypes()};class r{constructor(t){e.assign(r,this,t)}static getTypeName(){return"AugLoop_SharepointCopilot_AIReachGenerateAltTextSignal"}static getBaseTypes(){return["AugLoop_SharepointCopilot_AIReachBaseSignal","AugLoop_Signals_Signal"]}static typeGuard(t){return e.matchesTypesFor(t,[r.getTypeName()])}}var o,s;r.H_={T_:r.getTypeName(),B_:r.getBaseTypes()},function(e){e[e.GenerateTitle=1]="GenerateTitle",e[e.GenerateThumbnail=11]="GenerateThumbnail",e[e.GenerateDescription=12]="GenerateDescription",e[e.GenerateAltText=13]="GenerateAltText"}(o||(o={})),function(e){e[e.Success=0]="Success",e[e.Error=1]="Error",e[e.DataReady=2]="DataReady",e[e.UserIntentReady=3]="UserIntentReady"}(s||(s={}));class l{get metadata(){return this.M_}set metadata(e){this.M_=e}constructor(t){e.assign(l,this,t)}static getTypeName(){return"AugLoop_SharepointCopilot_AIReachAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}static typeGuard(t){return e.matchesTypesFor(t,[l.getTypeName()])}}l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};var u=c(207);class f{constructor(t){e.assign(f,this,t)}static getTypeName(){return"AugLoop_Core_ItemDelta"}static getBaseTypes(){return[]}static typeGuard(t){return e.matchesTypesFor(t,[f.getTypeName()])}}f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()};class p{constructor(t){e.assign(p,this,t)}static getTypeName(){return"AugLoop_Core_ItemChangesDelta"}static getBaseTypes(){return["AugLoop_Core_ItemDelta"]}static typeGuard(t){return e.matchesTypesFor(t,[p.getTypeName()])}}p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()};class m{constructor(t){e.assign(m,this,t)}static getTypeName(){return"AugLoop_Core_Operation"}static getBaseTypes(){return[]}static typeGuard(t){return e.matchesTypesFor(t,[m.getTypeName()])}}m.H_={T_:m.getTypeName(),B_:m.getBaseTypes()};class _{constructor(t){e.assign(_,this,t)}static getTypeName(){return"AugLoop_Core_OperationWithSiblingContext"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[_.getTypeName()])}}_.H_={T_:_.getTypeName(),B_:_.getBaseTypes()};class h{constructor(t){e.assign(h,this,t)}static getTypeName(){return"AugLoop_Core_AddOperation"}static getBaseTypes(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[h.getTypeName()])}}h.H_={T_:h.getTypeName(),B_:h.getBaseTypes()};class b{constructor(t){e.assign(b,this,t)}static getTypeName(){return"AugLoop_Core_MoveOperation"}static getBaseTypes(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[b.getTypeName()])}}b.H_={T_:b.getTypeName(),B_:b.getBaseTypes()};class g{constructor(t){e.assign(g,this,t)}static getTypeName(){return"AugLoop_Core_UpdateAnnotationMetaDataOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[g.getTypeName()])}}g.H_={T_:g.getTypeName(),B_:g.getBaseTypes()};class v{constructor(t){e.assign(v,this,t)}static getTypeName(){return"AugLoop_Core_UpdateOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[v.getTypeName()])}}v.H_={T_:v.getTypeName(),B_:v.getBaseTypes()};class y{constructor(t){e.assign(y,this,t)}static getTypeName(){return"AugLoop_Core_DeleteOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[y.getTypeName()])}}y.H_={T_:y.getTypeName(),B_:y.getBaseTypes()};class S{constructor(t){e.assign(S,this,t)}static getTypeName(){return"AugLoop_Core_PurgeOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[S.getTypeName()])}}S.H_={T_:S.getTypeName(),B_:S.getBaseTypes()};class D{constructor(t){e.assign(D,this,t)}static getTypeName(){return"AugLoop_Core_PurgeSubtreeExceptTypesOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[D.getTypeName()])}}D.H_={T_:D.getTypeName(),B_:D.getBaseTypes()};class I{constructor(t){e.assign(I,this,t)}static getTypeName(){return"AugLoop_Core_PurgeByTypesOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[I.getTypeName()])}}I.H_={T_:I.getTypeName(),B_:I.getBaseTypes()};class x{constructor(t){e.assign(x,this,t)}static getTypeName(){return"AugLoop_Core_FocusOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[x.getTypeName()])}}x.H_={T_:x.getTypeName(),B_:x.getBaseTypes()};class C{constructor(t){e.assign(C,this,t)}static getTypeName(){return"AugLoop_Core_VisibilityOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[C.getTypeName()])}}C.H_={T_:C.getTypeName(),B_:C.getBaseTypes()};class O{constructor(t){e.assign(O,this,t)}static getTypeName(){return"AugLoop_Core_DeltaUpdateOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[O.getTypeName()])}}O.H_={T_:O.getTypeName(),B_:O.getBaseTypes()};class w{constructor(t){e.assign(w,this,t)}static getTypeName(){return"AugLoop_Core_MicroSyncOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[w.getTypeName()])}}w.H_={T_:w.getTypeName(),B_:w.getBaseTypes()};class E{constructor(t){e.assign(E,this,t)}static getTypeName(){return"AugLoop_Signals_SignalOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[E.getTypeName()])}}E.H_={T_:E.getTypeName(),B_:E.getBaseTypes()};class A{constructor(t){e.assign(A,this,t)}static getTypeName(){return"AugLoop_Core_CancelSignalTriggeredWorkflowExecutionOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[A.getTypeName()])}}A.H_={T_:A.getTypeName(),B_:A.getBaseTypes()};var L,k=c(676),M=c(408);!function(e){e.INVALID_INTENT="INVALID_INTENT",e.SYDNEY_RAI_BLOCKED="SYDNEY_RAI_BLOCKED",e.SYDNEY_REQUEST_BLOCKED="SYDNEY_REQUEST_BLOCKED",e.SYDNEY_USER_THROTTLED_BY_LLM="SYDNEY_USER_THROTTLED_BY_LLM",e.WORKFLOW_TIMEOUT="WORKFLOW_TIMEOUT"}(L||(L={}));class P extends Error{static getDisplayMessageType(e){switch(e){case"SYDNEY_RAI_BLOCKED":case"SYDNEY_REQUEST_BLOCKED":return"Blocked";case"INVALID_INTENT":return"Unsupported";case"SYDNEY_USER_THROTTLED_BY_LLM":return"TooManyRequests";case"WORKFLOW_TIMEOUT":return"Timeout";default:return"Error"}}logQos(e,t){this.isExpected?e.writeExpectedFailure(this.errorCode,void 0,t):e.writeUnexpectedFailure(this.errorCode,void 0,t);const n="WORKFLOW_TIMEOUT"===this.errorCode?"AIReach.WorkflowTimeoutError":this.isExpected?void 0:"AIReach.WorkflowUnknownError";if(n){const e=new u._QosMonitorShareFailureWithCP(n,!1,[]);this.isExpected?e.writeExpectedFailure(this.errorCode,void 0,t):e.writeUnexpectedFailure(this.errorCode,void 0,t)}}constructor(e){super(),this.errorCode=e,this.isExpected=["INVALID_INTENT","SYDNEY_RAI_BLOCKED","SYDNEY_REQUEST_BLOCKED","SYDNEY_USER_THROTTLED_BY_LLM"].includes(e),this.DisplayMessageType=P.getDisplayMessageType(e)}}function T(e){return`AIReach.${e}`}var U,F=c(718);!function(e){e[e.None=0]="None",e[e.Generate=1]="Generate",e[e.Regenerate=2]="Regenerate"}(U||(U={}));var H=c(737),R=c(949);class N{constructor(e,t){this.base64EncodeImage=async(e,t)=>{const n=new u._QosMonitor(this._qosMonitorName);try{await this._ensureDependencies();const a={callerId:"ImageBase64Encoder",spResource:e},i=R._ThumbnailUrlGenerator.getThumbnailUrl(a)??e,r=R._ThumbnailUrlGenerator.getThumbnailProvider(i),o=await(this._httpClient?.get(i,H.HttpClient.configurations.v1,{}));if(!o){const e=new Error("HttpClient was undefined when fetching image.");return void n.writeUnexpectedFailure("ClientUndefined",e,{provider:r})}if(!o.ok){const{status:e}=o,t=new Error(`Failed to fetch image with status of ${e}`);return void n.writeUnexpectedFailure("FailedToFetchImage",t,{provider:r,status:e})}const s=await o.blob();if(t&&s.size>t){const e=new Error(`Image of size ${s.size/1024} KB exceeds max size of ${t/1024} KB`);return void n.writeExpectedFailure("ImageExceedsMaxSize",e,{provider:r,blobSize:s.size,maxFileSize:t})}const c=await this.base64EncodeBlob(s);return n.writeSuccess({provider:r,blobSize:s.size,maxFileSize:t}),c}catch(e){return void n.writeUnexpectedFailure("FailedToFetchBase64",e)}},this.base64EncodeBlob=e=>new Promise((t,n)=>{const a=new FileReader;a.onloadend=()=>{t(a.result)},a.onerror=n,a.readAsDataURL(e)}),this._ensureDependencies=()=>this._httpClient?Promise.resolve():new Promise(e=>{this._serviceScope.whenFinished(()=>{this._httpClient=this._serviceScope.consume(H.HttpClient.serviceKey),e()})}),this._serviceScope=e,this._qosMonitorName=t,this._ensureDependencies()}}function B(e){if(!e||!k._SPFlight.isEnabled(62653))return!1;const{legacyPageContext:t}=e.consume(M.PageContext.serviceKey);return t.canUserUseSPCopilot}function j(e){if(!e||!k._SPFlight.isEnabled(62751))return!1;const{legacyPageContext:t}=e.consume(M.PageContext.serviceKey);return t.canUserUseSPCopilot}const V=u._LogSource.create("AIReachWorkflowExecutor");class z{static getInstance(e){return this._promise||(this._promise=this._getAlProxy(void 0,e).then(t=>{const n=new z(t,e);return this._executor=n,n})),{current:this._executor,promise:this._promise}}static async _getAlProxy(e,t){const n=t.consume(M.PageContext.serviceKey);return e||await F.SPalProxyManager.getAlProxy(n.legacyPageContext,n.listItem?.uniqueId,void 0,[`enableGettyImageSearch:${B(t)}`,`aIReachTitleGeneration:${j(t)}`,`aIReachDescriptionGeneration:${B(t)}`,`aIReachThumbnailGeneration:${B(t)}`])}get sessionId(){return this._sessionId}async generateTitle(e){const{tone:t,pageContext:n,actionType:a,handleResponse:i,abortSignal:r,featureInstanceId:o}=e;return await this._requestTitle({request:{pageContext:n,tone:t},actionType:a,handleResponse:i,abortSignal:r,featureInstanceId:o})}async generateDescription(e){const{currentDescription:t,pageContext:n,actionType:a,handleResponse:i,abortSignal:r,featureInstanceId:o}=e;return await this._requestDescription({request:{pageContext:n,currentDescription:t},actionType:a,handleResponse:i,abortSignal:r,featureInstanceId:o})}async recommendThumbnail(e){const{images:t,useImageSearch:n,description:a,pageContext:i,actionType:r,handleResponse:o,abortSignal:s,featureInstanceId:c}=e,d=t.map(e=>this._convertImageToBase64Image(e)),l=await Promise.all(d),u=[],f=[];l.forEach((e,t)=>{e.base64&&(f.push(t),u.push(e))});const p=await this._requestThumbnail({request:{pageContext:i,images:u,description:a,useImageSearch:n},actionType:r,handleResponse:o,abortSignal:s,featureInstanceId:c});return p.selectedImages.forEach(e=>{const{imageIndex:t}=e;void 0!==t&&(e.imageIndex=f[t])}),p}async generateAltText(e){const{pageContext:t,actionType:n,handleResponse:a,abortSignal:i,featureInstanceId:r}=e,o=await this._convertImageToBase64Image(e.image);if(o.base64)return await this._requestAltText({request:{pageContext:t,image:o},actionType:n,handleResponse:a,abortSignal:i,featureInstanceId:r})}get alSessionKey(){return this._alProxy.getAugloopSessionKey()}async _requestTitle(e){const{request:t,actionType:a=U.Generate,abortSignal:i,handleResponse:r}=e;return await this._runTaskV2({signal:new n(t),scenario:o.GenerateTitle,qosName:T("Workflow.GenerateTitle"),actionType:a,handleResponse:async e=>{u._EngagementLogger.logEventWithLogEntry(new u._LogEntry("AIReach","TitleGenerated",u._LogType.Event,{clientScenario:U[a]})),r&&await r(e)},abortSignal:i,timeoutInMs:18e4})}async _requestDescription(e){const{request:t,actionType:n=U.Generate,abortSignal:i,handleResponse:r}=e;return await this._runTaskV2({signal:new a(t),scenario:o.GenerateDescription,qosName:T("Workflow.GenerateDescription"),actionType:n,handleResponse:async e=>{u._EngagementLogger.logEventWithLogEntry(new u._LogEntry("AIReach","DescriptionGenerated",u._LogType.Event,{clientScenario:U[n]})),r&&await r(e)},abortSignal:i,timeoutInMs:18e4})}async _requestThumbnail(e){const{request:t,actionType:n=U.Generate,abortSignal:a,handleResponse:r}=e;return await this._runTaskV2({signal:new i(t),scenario:o.GenerateThumbnail,qosName:T("Workflow.GenerateThumbnail"),actionType:n,handleResponse:async e=>{u._EngagementLogger.logEventWithLogEntry(new u._LogEntry("AIReach","ThumbnailGenerated",u._LogType.Event,{clientScenario:U[n]})),r&&await r(e)},abortSignal:a,timeoutInMs:18e4})}async _requestAltText(e){const{request:t,actionType:n=U.Generate,abortSignal:a,handleResponse:i}=e;return await this._runTaskV2({signal:new r(t),scenario:o.GenerateAltText,qosName:T("Workflow.GenerateAltText"),actionType:n,handleResponse:async e=>{u._EngagementLogger.logEventWithLogEntry(new u._LogEntry("AIReach","AltTextGenerated",u._LogType.Event,{clientScenario:U[n]})),i&&await i(e)},abortSignal:a,timeoutInMs:6e4})}async _runTaskV2({signal:e,scenario:t,qosName:n,handleResponse:a,abortSignal:i,actionType:r,timeoutInMs:o}){const c=new u._QosMonitor(n),d=this._operationId.toString(),l=new E({parentPath:this._messagesPath,items:[{id:d,body:e}]}),f=await this._alProxy.getAugloopSession();await this._submitOperations([l]),this._operationId++;const p=()=>({augLoopSessionKey:this._alProxy.getAugloopSessionKey(),AIReachId:this._sessionId,isAugloopSessionConnected:f.isConnected,isAugloopSessionClosed:f.isClosed});return new Promise((e,n)=>{const l=setTimeout(()=>{const e=new P(L.WORKFLOW_TIMEOUT);this._responseCallbacks.has(d)&&this._responseCallbacks.set(d,()=>{new u._QosMonitor(c.name+".TimeoutDataReturned").writeExpectedFailure("TimeoutDataReturned",void 0,p())}),c.writeUnexpectedFailure("timeout",e,p()),n(e)},o);let f;const m=()=>{clearTimeout(l),this._responseCallbacks.delete(d),c.writeExpectedFailure("Aborted",void 0,p()),n(new Error("Operation aborted"))};i?.aborted?m():(i?.addEventListener("abort",m),this._responseCallbacks.set(d,async o=>{try{const n=o;if(n.status===s.DataReady){clearTimeout(l);const e=this._parseInProgressResponse(o,t);a&&e&&(f=a(e))}if(n.status===s.Error||n.status===s.Success){const n=p(),i=this._parseFinalResponse(o,t,r,c,n).data;a&&(f||(f=a(i)),await f),c.writeSuccess(n),e(i)}}catch(e){u._TraceLogger.logError(V,e,"Error handling annotation",e),n(e)}finally{i?.removeEventListener("abort",m)}}))})}_activateAnnotation(e,t){return this._alProxy.getAugloopSession().then(n=>n.activateAnnotation(e,{callback:e=>{if(h.typeGuard(e)&&this._isUnderSubtree(e.parentPath,this._messagesPath))for(const n of e.items){const a=e.parentPath[e.parentPath.length-1],i=this._responseCallbacks.get(a);i&&(i(n.body),t(n.body)&&this._responseCallbacks.delete(a))}}}))}_isUnderSubtree(e,t){if(e.length<t.length)return!1;for(let n=0;n<t.length;n++)if(e[n]!==t[n])return!1;return!0}_parseInProgressResponse(e,t){const n=e;if(n.scenario===t&&void 0!==n.data)return JSON.parse(n.data)}_parseFinalResponse(e,t,n,a,i){const r=e;if(r.conversationId&&(i={...i,conversationId:r.conversationId}),r.status===s.Error){const e=new P(r.error);throw e.logQos(a,i),this._logExecutionResult(void 0,t,n,r.error),e}if(r.scenario!==t){const e=`Unexpected scenario: ${r.scenario}. Expected: ${t}`;throw a.writeUnexpectedFailure("UnexpectedScenario",void 0,{...i,errorMessage:e}),this._logExecutionResult(void 0,t,n,"SCENARIO_MISMATCH"),new Error(e)}if(void 0===r.data)throw a.writeUnexpectedFailure("NoDataReturned",void 0,i),this._logExecutionResult(void 0,t,n,"NO_DATA_RETURNED"),new Error("Workflow execution returned no data.");const o=JSON.parse(r.data);return this._logExecutionResult(o,t,n,""),{data:JSON.parse(r.data),conversationId:r.conversationId}}_logExecutionResult(e,t,n,a){u._EngagementLogger.logEventWithLogEntry(new u._LogEntry("AIReach","WorkflowExecuted",u._LogType.Event,{scenario:o[t],status:(!!e).toString(),errorCode:a||"",clientScenario:U[n]}))}async _submitOperations(e){(await this._alProxy.getAugloopSession()).submitOperations(e)}constructor(e,t){this._operationId=0,this._setupSessionListeners=()=>this._alProxy.getAugloopSession().then(e=>{e.setConnectCallback(this._getSessionStateChangeHandler("Connected")),e.setSessionCloseCallback(this._getSessionStateChangeHandler("Closed")),e.setDisconnectCallback(this._getSessionStateChangeHandler("Disconnected")),e.setReconnectCallback(this._getSessionStateChangeHandler("Reconnected"))}),this._getSessionStateChangeHandler=e=>()=>{u._TraceLogger.logVerbose(V,`Augloop session state changed - ${e}`),new u._QosMonitor(`AIReachALSession.${e}`).writeSuccess()},this._convertImageToBase64Image=async(e,t=512e3)=>{const{src:n,caption:a}=e;return{base64:await this._base64Generator.base64EncodeImage(n,t),caption:a}},this._alProxy=e,this._base64Generator=new N(t,T("Base64Generator")),u._TraceLogger.logVerbose(V,"AIReachWorkflowExecutor init - alSessionKey: "+e.getAugloopSessionKey()),this._sessionId=k.Guid.newGuid().toString(),this._messagesPath=["session",this._sessionId],this._responseCallbacks=new Map,this._activateAnnotation(l.getTypeName(),e=>e.status===s.Error||e.status===s.Success).catch(e=>{u._TraceLogger.logError(V,e,"Error activating annotation",e)}),this._setupSessionListeners().catch(e=>{u._TraceLogger.logError(V,e,"Error setting up session listeners",e)})}}const G=e=>{const{promise:t}=z.getInstance(e);return t};function K(e){if(!e||!k._SPFlight.isEnabled(62670))return!1;const{legacyPageContext:t}=e.consume(M.PageContext.serviceKey);return t.canUserUseSPCopilot}})(),d})());