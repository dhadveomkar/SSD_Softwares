define("71ed20ab-51c2-42fe-af94-7a1c442b34f3_0.1.0",["@msinternal/sp-design-ideas-utilities","@microsoft/sp-diagnostics","@microsoft/sp-core-library","@msinternal/sp-design-ideas-catalog","@msinternal/sp-canvas-read","@msinternal/sp-component-utilities","@msinternal/sp-design-ideas-core","@microsoft/sp-image-helper","@microsoft/sp-page-context","@msinternal/sp-ck5editor","@microsoft/sp-lodash-subset","@msinternal/sp-canvas-edit-shared","@msinternal/sp-image-edit-next"],(e,t,n,a,i,r,o,s,c,d,l,u,f)=>(()=>{"use strict";var p={676:e=>{e.exports=n},207:e=>{e.exports=t},949:e=>{e.exports=s},529:e=>{e.exports=l},408:e=>{e.exports=c},707:e=>{e.exports=u},631:e=>{e.exports=i},700:e=>{e.exports=d},718:e=>{e.exports=r},549:e=>{e.exports=a},397:e=>{e.exports=o},742:t=>{t.exports=e},758:e=>{e.exports=f}},m={};function _(e){var t=m[e];if(void 0!==t)return t.exports;var n=m[e]={exports:{}};return p[e](n,n.exports,_),n.exports}_.d=(e,t)=>{for(var n in t)_.o(t,n)&&!_.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},_.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),_.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var h={};return(()=>{_.r(h),_.d(h,{AriaLabelProvider:()=>u,CKEditorForDesignIdeas:()=>F,DesignIdeasStyler:()=>pe,RteDtoStyler:()=>q,StylerFactory:()=>Q,_getCanvasZoneBackgroundData:()=>me,getConfigurationDescription:()=>_e,getConfigurationForSection:()=>e.getConfigurationForSection,isImageSuggestionsAvailable:()=>e.isImageSuggestionsAvailable,isSameConfiguration:()=>he,isSameInlineImageCountFor1Text0Image:()=>be,preprocessControls:()=>ge});var e=_(742),t=_(207),n=_(676),a=_(549);function i(){return n._SPKillSwitch.isActivated("ff415e1a-c5ed-4f0e-b873-f4228d1a2f56")}function r(){return n._SPKillSwitch.isActivated("32648ad4-624a-4da1-ae4d-75def5a8de47")}function o(){return n._SPKillSwitch.isActivated("3b56b10c-bb91-42ce-8777-4fe783ad57b1")}function s(){return n._SPKillSwitch.isActivated("5822aec1-f6bb-477d-b8f4-5ce62b73f89b")}function c(){return!n._SPKillSwitch.isActivated("f8599d10-6c76-11ef-bf24-866dda444461")&&(1===n._SPExperiment.getVariantAndLogExposure(90328)||n._SPFlight.isEnabled(62125))}function d(){return!n._SPKillSwitch.isActivated("b2e7a8ba-1211-478c-995c-220b1a408070")&&n._SPFlight.isEnabled(61115)}const l=JSON.parse('{"S0":"{0} {1} {2} {3}","I7":"{0} {1} {2}","d3":"Section background image {0}.","_Z":"description unavailable","RW":"Section background {0}.","iC":"{0} section.","iV":"description unavailable","gN":"{0} aligned.","X1":"The {0} column contains {1}","O0":"Top","n6":"Center","xO":"Bottom","Oi":"Left","UI":"None","OI":"Neutral shading","Sm":"Soft shading","E0":"Strong shading","C6":"One column","Um":"Two column","zL":"Three column","P8":"One-third left","C":"One-third right","pX":"left","pl":"center","G4":"right","vt":"{0}. {1}.","XM":"{0}. {1}. {2}.","tD":"Text {0}","eS":"Text {0} style {1}","HO":"Text {0} custom style","jp":"Image {0}","OZ":"Image {0} shape {1}","zy":"{0}, {1}","RK":"Author","pH":"Color block","db":"Cut in shape","a$":"Fade","pZ":"Full-width image","aX":"No image"}');class u{setStyle(e){this._style=e}buildSectionLabels(){this._layoutLabel=this._getLayoutLabel(),this._backgroundLabel=this._getBackgroundLabel(),this._alignmentLabel=this._getAlignmentLabel()}applyColumnsLabel(e){this._style&&!this._style.BannerStyle&&(this._columnsLabel=this._getColumnsLabel(e))}setAriaLabel(){this._suggestion&&(this._suggestion.AriaLabel=this._formatAriaLabel())}_formatAriaLabel(){return this._columnsLabel&&""!==this._columnsLabel?n.Text.format(l.S0,this._layoutLabel,this._backgroundLabel,this._alignmentLabel,this._columnsLabel):n.Text.format(l.I7,this._layoutLabel,this._backgroundLabel,this._alignmentLabel)}_getLayoutLabel(){let e="";return this._style?.BannerStyle?(this._layoutType=0,e=this._getBannerLayoutDescription()):e=this._style?.WebPartPositionStyle.length&&this._style.WebPartPositionStyle.length>0?this._getLayoutDescription():l.iV,n.Text.format(l.iC,e)}_getBackgroundLabel(){let e="";switch(this._suggestion?.DynamicStyle?.BackgroundStyle?.Type){case void 0:return new t._QosMonitorShareFailureWithCP("DesignIdeasSuggestionAriaLabel.Background",!1,[]).writeUnexpectedFailure("BackgroundStyleUndefined"),"";case"image":const i=this._suggestion.DynamicStyle.BackgroundStyle.Value.description;return e=i&&""!==i?i:l._Z,n.Text.format(l.d3,e);case"emphasis":let r=l._Z;switch(this._suggestion.DynamicStyle.BackgroundStyle.Value){case 0:r=l.UI;break;case 1:r=l.OI;break;case 2:r=l.Sm;break;case 3:r=l.E0}return n.Text.format(l.RW,r);case"oobBackground":case"color":return e=a.gradientsMap.get(this._suggestion.DynamicStyle.BackgroundStyle.Value)??a.gradientsMap.get(this._suggestion.DynamicStyle.BackgroundStyle.Value.gradient)??l._Z,n.Text.format(l.RW,e);case"themeIndex":const o=this._suggestion.DynamicStyle.BackgroundStyle.Value;return n.Text.format(l.RW,JSON.stringify(o))}}_getAlignmentLabel(){let e="";const t=this._style?.BannerStyle?.[0]?.alignment;if(t)switch(t){case"Left":e=l.Oi;break;case"Center":e=l.n6}else switch(this._style?.ContentAlignment){case void 0:e=l.O0;break;case 0:e=l.n6;break;case 1:e=l.xO}return n.Text.format(l.gN,e)}_getColumnsLabel(t){if((0,e.isFlexibleSectionWithSupportEnabled)(t))return"";if(!n._SPKillSwitch.isActivated("6c46a7e5-7a7b-4491-a0c5-3711b431cbe5")&&t[0].webPartId===e.WebPartManifestIds.QuickLinks)return"";if(t.filter(t=>(0,e.isDesignIdeasWebPartDecompEnabled)()&&e.DECOMP_WEB_PARTS.has(t.webPartId)).length>0)return"";const a=Math.max(...t.map(e=>e.position.sectionIndex||0)),i=Array.from({length:a},()=>[]);for(const e of t)e.position.sectionIndex&&i[e.position.sectionIndex-1].push(e);const r=[];let o=0,s=0;for(const e of i){const t=[];for(const a of e)switch(a.controlType){case 4:t.push(m(o,this._suggestion,c()?this._style?.TextStyleDTO:void 0)),o++;break;case 3:t.push((d=s,"Default"===(u=this._style)?.ImageStyle[d].shape?n.Text.format(l.jp,d+1):n.Text.format(l.OZ,d+1,u?.ImageStyle[d].shape))),s++}if(1===t.length)r.push(t[0]);else{let e=n.Text.format(l.zy,t[0],t[1]);if(t.length>2)for(const a of t.slice(2))e=n.Text.format(l.zy,e,a);r.push(e)}}var d,u;let _="",h="",b="";switch(this._layoutType){case 1:return n.Text.format(l.X1,"",r[0]);case 3:return _=f(r[0]),b=p(r[1]),n.Text.format(l.vt,_,b);case 4:return _=f(r[0]),g=r[1],h=n.Text.format(l.X1,l.pl,g),b=p(r[2]),n.Text.format(l.XM,_,h,b);default:return""}var g}_getLayoutDescription(){switch(this._style?.WebPartPositionStyle[0].sectionFactor){default:return l.iV;case 12:return this._layoutType=1,l.C6;case 8:return this._layoutType=2,l.C;case 6:return this._layoutType=3,l.Um;case 4:return 8===this._style.WebPartPositionStyle[this._style.WebPartPositionStyle.length-1].sectionFactor?(this._layoutType=5,l.P8):(this._layoutType=4,l.zL)}}_getBannerLayoutDescription(){const e=this._style?.BannerStyle?.[0]?.layoutType;switch(e){case"Author":return l.RK;case"ColorBlock":return l.pH;case"CutInShape":return l.db;case"Fade":return l.a$;case"FullWidthImage":return l.pZ;case"NoImage":return l.aX;default:return l.iV}}constructor(e){this._layoutLabel="",this._backgroundLabel="",this._alignmentLabel="",this._columnsLabel="",this._layoutType=6,this._suggestion=e}}function f(e){return n.Text.format(l.X1,l.pX,e)}function p(e){return n.Text.format(l.X1,l.G4,e)}function m(e,t,i){if(c()&&(t?.DynamicStyle?.TextStyleDTO&&t.DynamicStyle.TextStyleDTO.length>0&&(i=t.DynamicStyle.TextStyleDTO),t?.DynamicStyle?.TextStyleDTO&&t.DynamicStyle.TextStyleDTO.length>e&&i&&i.length>e)){const i=t.DynamicStyle.TextStyleDTO[e];if(i){const r=(0,a.matchBuiltInTextStyleDTO)(i);return r&&t.StyleMetadata?.TextStyleDTO?(t.StyleMetadata.TextStyleDTO[e]=r.name,n.Text.format(l.eS,e+1,r.name)):n.Text.format(l.HO,e+1)}}const r=t?.StyleMetadata?.TextStyleDTO?t?.StyleMetadata?.TextStyleDTO[e]:void 0;return r?n.Text.format(l.eS,e+1,r.charAt(r.length-1)):n.Text.format(l.tD,e+1)}var b=_(631);class g{async getUpdatedCanvasControlData(e,t){return Promise.resolve({...t,[this.dataKey]:await this.performStyleChange(e.style,t[this.dataKey]),position:{...t.position,controlIndex:e.position.controlIndex,sectionIndex:e.position.sectionIndex,sectionFactor:0===t.position.sectionFactor?0:e.position.sectionFactor},emphasis:{zoneEmphasis:e.emphasis??t.emphasis?.zoneEmphasis},zoneGroupMetadata:{...t.zoneGroupMetadata,alignment:e.alignment??t.zoneGroupMetadata?.alignment}})}constructor(e){this.serviceScope=e}}function v(e,t,n){const a={x:0,y:0,width:0,height:0,positionStyle:void 0};return t&&e&&(e/t<n?(a.height=Math.round(e/n),a.width=e,a.y=Math.round((t-a.height)/2)):(a.width=Math.round(t*n),a.height=t,a.x=Math.round((e-a.width)/2))),a}class y extends g{get dataKey(){return"webPartData"}get identifier(){return{contentType:b.CanvasControlType.WebPartZone,webPartId:e.WebPartManifestIds.ImageWebPart}}async performStyleChange(e,t){const n=function(e,t,n){if(!e.aspectRatioInfo)return;const a=e.aspectRatioInfo;return"style1-1-1"===a.positionStyle||"style2-1-1"===a.positionStyle||"style3-1-1"===a.positionStyle?v(t,n,1.5):"style3-2-2"!==a.positionStyle&&"style3-3-3"!==a.positionStyle||!a.shortAspectRatio?"style1-2-2"!==a.positionStyle&&"style1-3-3"!==a.positionStyle||!a.narrowAspectRatio?void 0:v(t,n,a.narrowAspectRatio):v(t,n,a.shortAspectRatio)}(e,t.properties.imgWidth,t.properties.imgHeight);return Promise.resolve({...t,properties:{...t.properties,imageShape:e.shape,resizeCoefficient:e.resizeCoefficient,resizeDesiredWidth:e.resizeDesiredWidth,cropX:n?.x??0,cropY:n?.y??0,cropWidth:n?.width??void 0,cropHeight:n?.height??void 0}})}constructor(e){super(e)}}var S=_(718);class D extends g{get dataKey(){return"webPartData"}get identifier(){return{contentType:b.CanvasControlType.WebPartZone,webPartId:e.WebPartManifestIds.Banner}}async performStyleChange(t,n){const a=t.layoutType,i=t.backgroundStyle?.Value;let r;return i&&(r=(0,e.replaceTasDomainWithHubble)(i.url)),Promise.resolve({...n,properties:{...n.properties,imageSourceType:2,imgWidth:i?i.width:n.properties.imgWidth,imgHeight:i?i.height:n.properties.imgHeight,layoutType:a,textAlignment:t.alignment||n.properties.textAlignment,enableGradientEffect:t.enableGradientEffect||n.properties.enableGradientEffect,title:n.properties.title?n.properties.title:t.placeHolderText,contentProvider:i?.contentProvider,insertionISOTimestamp:(0,S.getTimestampForGettyContent)(i?.contentProvider),stockMediaId:i?i.id:n.properties?.stockMediaId},serverProcessedContent:{...n.serverProcessedContent,imageSources:{imageSource:r||n.serverProcessedContent?.imageSources?.imageSource||""}}})}constructor(e){super(e)}}var I=_(397),x=_(949);const C={powerpointdocument:[".pptx",".ppt",".pps",".ppsx",".pptm",".potx",".potm",".ppam",".ppa"],worddocument:[".docx",".doc"],exceldocument:[".xlsx",".xls"],pdf:[".pdf"],document:[".odt",".rtf",".txt"],table:[".ods",".csv",".tsv"],presentation:[".odp",".key"],video:[".mp4",".avi",".mov",".wmv",".flv",".mkv",".webm"],globe:[".aspx",".html",".htm",".xml",".json",".yaml",".yml",".md",".markdown"]};function O(e,t,n){let a=t||void 0;e||!t&&n&&(a=n||void 0);for(const[t,n]of Object.entries(C))if(n.includes(e)||a&&n.some(e=>-1!==a?.toLowerCase().indexOf(e)))return t}var w;function E(e,t,n){return e.properties.items&&0!==e.properties.items.length&&3!==e.properties.items[0].thumbnailType?2===e.properties.items[0].thumbnailType&&"circleaddition"!==e.properties.items[0].fabricReactIcon?1:1===e.properties.items[0].thumbnailType?0:1:n?0:1}!function(e){e[e.Image=0]="Image",e[e.Icon=1]="Icon"}(w||(w={}));const A=JSON.parse('{"W":"Add your own title"}'),L=[".doc",".docx",".ppt",".pptx",".xls",".xlsx",".pdf",".txt"],k=[I.ButtonTreatment.FillColor,I.ButtonTreatment.Outline,I.ButtonTreatment.None];class M extends g{get dataKey(){return"webPartData"}get identifier(){return{contentType:b.CanvasControlType.WebPartZone,webPartId:e.WebPartManifestIds.QuickLinks}}async performStyleChange(e,t){const n=e.zoneEmphasis||0,o=e.layoutId,s=e.suggestedImages,c=e.suggestedIcons,d=t.properties?.items||[],l=t.serverProcessedContent?.links||{},u=d.length||0,f=t.serverProcessedContent?.imageSources||{},p="Grid"===e.layoutId||"FilmStrip"===e.layoutId,m=(e,t)=>{d[e]={...d[e],thumbnailType:2,fabricReactIcon:{iconName:t}}},_=E(t,0,p);let h=!1;for(let e=0;e<d.length;e++){if(d[e].title!==A.W){h=!1;break}h=!0}if(_===w.Icon)for(let e=0;e<u;e++){d[e].thumbnailType=2;const n=c?c.get(e):void 0;if(!n||"globe"===n||void 0!==t.properties?.items[e].fabricReactIcon&&"circleaddition"!==t.properties.items[e].fabricReactIcon.iconName)if(t.serverProcessedContent?.searchablePlainTexts?.[`items[${e}].title`]===A.W)m(e,"circleaddition");else if(n||t.properties?.items[e].fabricReactIcon&&("circleaddition"!==t.properties.items[e].fabricReactIcon.iconName||!d[e].sourceItem?.fileExtension))"circleaddition"===t.properties?.items[e].fabricReactIcon&&t.serverProcessedContent?.searchablePlainTexts?.[`items[${e}].title`]!==A.W&&m(e,"globe");else{const n=d[e].sourceItem?.fileExtension?.toLowerCase(),a=t.properties?.items[e].title||void 0,i=t.serverProcessedContent?.searchablePlainTexts,r=O(n,a,i&&i[`items[${e}].title`]);r&&m(e,r)}else m(e,n)}else if(_===w.Image)for(let e=0;e<u;e++){2===d[e].thumbnailType&&(d[e].thumbnailType=1);const t=s?s.get(e):void 0;!t||x._PreviewUtility.isImage(l[`items[${e}].sourceItem.url`])||f[`items[${e}].image.url`]&&!f[`items[${e}].image.url`].includes("DesignIdeasCuratedImage")||(f[`items[${e}].image.url`]=t.url,d[e]={...d[e],image:{url:t.url,contentProvider:t.contentProvider,insertionISOTimestamp:(0,S.isGettyContent)(t?.contentProvider)?(new Date).toISOString():void 0,stockMediaId:t.id}});let n=d[e].sourceItem?.fileExtension;n&&(n=n.toLowerCase(),L.includes(n)&&(d[e].thumbnailType=3))}else if(!p)for(let e=0;e<u;e++){let n=d[e].sourceItem?.fileExtension;if(n){n=n.toLowerCase();const a=t.properties?.items[e].title||void 0,i=t.serverProcessedContent?.searchablePlainTexts,r=O(n,a,i&&i[`items[${e}].title`]);r&&m(e,r)}}const b=4-u,g=4===b||h?p:_===w.Image,v=a.CuratedStockImageProvider.getCuratedStockImages(h?4:b);if(h)for(let e=0;e<d.length;e++)g?(d[e].image={url:v[e].url},d[e].thumbnailType=1):d[e].thumbnailType=2,l[`items[${e}].sourceItem.url`]=v[e].url,f[`items[${e}].image.url`]=v[e].url;for(let e=u;e<4;e++){const t=v[e-u].url;d[e]=g?{title:A.W,image:{url:t},thumbnailType:1,sourceItem:{itemType:2}}:{title:A.W,thumbnailType:2,sourceItem:{itemType:2}},f[`items[${e}].fabricReactIcon.iconName`]="circleaddition",l[`items[${e}].sourceItem.url`]=t,f[`items[${e}].image.url`]=t}if(!r())for(let e=0;e<d.length;e++)d[e].id=d.length-e;return i()||function(e,t){switch(e.layoutId){case"Button":const e=t.properties.buttonLayoutOptions;if(e.buttonTreatment===I.ButtonTreatment.None&&e.iconPositionType===I.IconPositionType.NoIcon)t.properties.buttonLayoutOptions={...t.properties.buttonLayoutOptions,buttonTreatment:Math.random()>.5?I.ButtonTreatment.Outline:I.ButtonTreatment.FillColor,iconPositionType:Math.random()>.5?I.IconPositionType.IconToLeft:I.IconPositionType.IconToTop};else if(e.iconPositionType!==I.IconPositionType.NoIcon){const e=k[Math.floor(Math.random()*k.length)];t.properties.buttonLayoutOptions={...t.properties.buttonLayoutOptions,buttonTreatment:e}}else t.properties.buttonLayoutOptions={...t.properties.buttonLayoutOptions,IconPositionType:Math.random()>.5?I.IconPositionType.IconToLeft:I.IconPositionType.IconToTop};break;case"List":t.properties.listLayoutOptions={...t.properties.listLayoutOptions,showIcon:!0};break;case"Waffle":const n=t.properties.items.some(e=>1===e.thumbnailType),a=t.properties.waffleLayoutOptions;if(n)if(a.onlyShowThumbnail){if(a.onlyShowThumbnail){const e=[I.IconSize.ExtraLarge,I.IconSize.Fill];a.iconSize=e[Math.floor(Math.random()*e.length)]}}else{const e=[I.IconSize.Small,I.IconSize.Large,I.IconSize.ExtraLarge,I.IconSize.Fill];a.iconSize=e[Math.floor(Math.random()*e.length)]}else{const e=[I.IconSize.Small,I.IconSize.Medium,I.IconSize.Large];a.iconSize=e[Math.floor(Math.random()*e.length)]}}}(e,t),Promise.resolve({...t,serverProcessedContent:{...t.serverProcessedContent,imageSources:f},properties:{...t.properties,items:d,zoneEmphasis:n,layoutId:o}})}constructor(e){super(e)}}class P extends g{get dataKey(){return"webPartData"}get identifier(){return{contentType:b.CanvasControlType.WebPartZone,webPartId:this._webPartId}}async performStyleChange(e,t){return Promise.resolve({...t})}constructor(e,t){super(e),this._webPartId=t}}var T=_(408),U=_(700);class F{static getInstance(e){return F._instancePromise||(F._instancePromise=U.CK5Loader.createNewShadowEditor({currentHTML:"",serviceScope:e,pageContext:e.consume(T.PageContext.serviceKey),additionalPlugins:["DesignIdeas"]}).catch(e=>{throw new Error(`CKEditorForDesignIdeas.instance: ${e}`)})),F._instancePromise}static destroyInstance(){F._instancePromise&&F._instancePromise.then(e=>{e.editor.destroy().then(e=>{F._instancePromise=void 0}).catch(e=>{throw new Error(`CKEditorForDesignIdeas.instance: ${e}`)})}).catch(e=>{throw new Error(`CKEditorForDesignIdeas.instance: ${e}`)})}}F._instancePromise=void 0;class H{async getUpdatedCanvasControlData(e,t,n,a){return{...t,[this.dataKey]:await this.performStyleChange(e.style,t[this.dataKey],a),position:{...t.position,controlIndex:e.position.controlIndex,sectionIndex:e.position.sectionIndex,sectionFactor:0===t.position.sectionFactor?0:e.position.sectionFactor},zoneHeight:n?void 0:e.zoneHeight,emphasis:{zoneEmphasis:e.emphasis??t.emphasis?.zoneEmphasis},zoneGroupMetadata:{...t.zoneGroupMetadata,alignment:e.alignment??t.zoneGroupMetadata?.alignment},...!n&&e.position?.flexibleLayoutPosition&&{flexibleLayoutPosition:{lg:{x:e.position?.flexibleLayoutPosition.x||0,y:e.position?.flexibleLayoutPosition.y||0,w:e.position?.flexibleLayoutPosition.w||0,h:e.position?.flexibleLayoutPosition.h||0}}}}}constructor(e){this.serviceScope=e}}const R=new RegExp(/class="([^"]*\s)?\bfontColorThemePrimary\b(\s[^"]*)?"/g),N=new RegExp(/class="([^"]*\s)?\bfontColorNeutral[^"\s]*\b(\s[^"]*)?"/g);function B(e,t){return e.replace(t?R:N,(e,t,n)=>{const a=`${t||""}${n||""}`.trim().replace(/\s{2,}/g," ");return a?`class="${a}"`:""}).replace(/class="\s*"/g,"")}const j=JSON.parse('{"Bj":"Add your own headline","f7":"Add your own subheadline","T7":"Add a subheadline","Rp":"Get your point across, tell a story, or connect with people in a style that suits you. Add an image if you want. Then, see it come to life in different layouts to help you make your page as beautiful and effective as possible.","UE":"Add an image if you want. Then, see it come to life in different layouts to help you make your page as beautiful and effective as possible.","Tf":"Get your point across, tell a story, or connect with people in a style that suits you."}');function V(e){const{textPlaceholderType:t,cap:n,fontSize:a,contentLength:i}=e;return"heading"===t||"all"===n||a>=28?j.Bj:"subHeading"===t||a>=20&&a<28?i&&i>21?j.f7:j.T7:"paragraph"===t&&i?i>140?j.Rp:i>90?j.UE:j.Tf:j.Rp}const z=t._LogSource.create("DesignIdeasStyler"),G=["heading1","heading2","heading3","paragraph"],K=new Set(G),W=new Map([["heading1","h1"],["heading2","h2"],["heading3","h3"],["paragraph","p"]]);class q extends H{get identifier(){return{contentType:b.CanvasControlType.RTE}}get dataKey(){return"innerHTML"}async performStyleChange(e,n,a){return new Promise((i,r)=>{const o=performance.now();F.getInstance(this.serviceScope).then(s=>{const c=new t._QosMonitor("DesignIdeas.Styler.ApplyRteDtoStyle",!1,!0);try{t._TraceLogger.logVerbose(z,"RteDto styler start."),""===n&&a&&(n=this._generatePlaceholderContentForDto(e)),s.editor.data.set(n),t._TraceLogger.logVerbose(z,"RteDto styler setData.");const r=this._convertDtoToTemplate(e);s.editor.commands.execute("DesignIdeas",{template:r,newContentHandler:e=>{i(e),c.writeSuccess(),t._TraceLogger.logVerbose(z,`RteDto styler end. Time taken: ${performance.now()-o}ms`)},isRteDtoStyler:!0})}catch(e){c.writeUnexpectedFailure(void 0,e),r(e)}})})}_generatePlaceholderContentForDto(e){let t="";return G.forEach(n=>{const a=e[n];if(a&&a.isPreferredElementForEmpty){const e=W.get(n)||"",i="all"===a.cap?V(a).toUpperCase():V(a);t+=`<${e}>${i}</${e}>`}}),0===t.length?`<p>${j.Rp}</p>`:t}_convertDtoToTemplate(t){return Object.entries(t).reduce((n,[a,i])=>{const r=i,o=a;return void 0!==r&&"boolean"!=typeof r&&(n[o]=this._generateHtmlTemplate(r),(0,e.isThemeV2EnabledInDesignIdeas)()&&(t.hasThemePrimaryBackground&&K.has(a)?n[o]=B(n[o],!0):t.hasOobOrCustomBackgroundImage&&K.has(a)&&(n[o]=B(n[o],!0),n[o]=B(n[o],!1)))),n},{paragraph:"",heading1:"",heading2:"",heading3:"",blockQuote:"",pre:"",image:"",table:"",tableRow:"",tableCell:"",tableColumnGroup:"",tableColumn:""})}_generateHtmlTemplate(e){const t=[e.fontSize&&!e.fontSizeClass?`font-size:${e.fontSize}px`:"",e.textAlignment?`text-align:${e.textAlignment}`:""].filter(Boolean).join("; "),a=[e.fontSizeClass?e.fontSizeClass:"",e.fontColor?e.fontColor:"",!n._SPKillSwitch.isActivated("8e3ed938-054c-48d3-a20f-63e35aa50b04")&&e.class?e.class:""].filter(Boolean).join(" ");let i=`<span ${t?`style="${t}"`:""} ${a?`class="${a}"`:""} dataAutomationId="convertedTextStyle">`;return e.isUnderline&&(i+="<u>"),e.isBold&&(i+="<strong>"),e.isItalic&&(i+="<i>"),i+="{0}",e.isItalic&&(i+="</i>"),e.isBold&&(i+="</strong>"),e.isUnderline&&(i+="</u>"),i+="</span>",i}constructor(e){super(e)}}class Q{createStyler(t){let n;return t.contentType===b.CanvasControlType.RTE?new q(this._serviceScope):t.contentType===b.CanvasControlType.WebPartZone&&t.webPartId===e.WebPartManifestIds.ImageWebPart?(n=new y(this._serviceScope),n):t.contentType===b.CanvasControlType.WebPartZone&&t.webPartId===e.WebPartManifestIds.Banner?(n=new D(this._serviceScope),n):t.contentType===b.CanvasControlType.WebPartZone&&t.webPartId===e.WebPartManifestIds.QuickLinks?new M(this._serviceScope):t.contentType===b.CanvasControlType.WebPartZone&&t.webPartId&&e.DECOMP_WEB_PARTS.has(t.webPartId)?new P(this._serviceScope,t.webPartId):void 0}constructor(e){this._serviceScope=e}}function Y(t){if(t){if(t.contentType===b.CanvasControlType.RTE)return I.WebPartType.Text;if(t.contentType===b.CanvasControlType.WebPartZone&&t.webPartId){if(t.webPartId===e.WebPartManifestIds.ImageWebPart)return I.WebPartType.Image;if(t.webPartId===e.WebPartManifestIds.Banner)return I.WebPartType.Banner;if(t.webPartId===e.WebPartManifestIds.QuickLinks)return I.WebPartType.QuickLinks;if((0,e.isDesignIdeasWebPartDecompEnabled)()&&e.DECOMP_WEB_PARTS.has(t.webPartId))return I.WebPartType.Placeholder}}return I.WebPartType.None}class J{clearWebpartIndexes(){s()?this._webPartIndexes=[]:(this._assignedPositions.clear(),this._styleCounters.clear())}getNextStyle(e){return this._suggestion?s()?this._getNextStyleLegacy(e):this._getNextStyleRefactored(e):Promise.reject(new Error("Suggestion not found"))}_getNextStyleRefactored(e){return this._controlStyles.then(t=>{const n=Y(e),a=n===I.WebPartType.Text?this._getNextTextPosition(t):this._getNextAvailablePosition(t),i=this._getVisualStyleForWebPart(t,n);return{controlType:n,position:a,style:i?.style,emphasis:i?.emphasis,alignment:i?.alignment}})}_getNextStyleLegacy(e){return this._controlStyles.then(t=>{const n=Y(e);void 0===this._webPartIndexes[n]&&(this._webPartIndexes[n]=0);for(let e=this._webPartIndexes[n];e<t.length;e++){const a=t[e];if(a.controlType===n)return this._webPartIndexes[n]=e+1,a}throw new Error("No next style")})}_getNextTextPosition(e){if(!e||0===e.length)throw new Error(`No styles available for text positioning. Suggestion: ${this._suggestion.Id}`);for(let t=0;t<e.length;t++){const n=e[t];if(!this._assignedPositions.has(t)&&n.controlType===I.WebPartType.Text)return this._assignedPositions.add(t),n.position}throw new Error("No more text positions available")}_getNextAvailablePosition(e){for(let t=0;t<e.length;t++){const n=e[t];if(!this._assignedPositions.has(t)&&n.controlType!==I.WebPartType.Text)return this._assignedPositions.add(t),n.position}throw new Error("No more non-text positions available")}_getVisualStyleForWebPart(e,t){const n=e.filter(e=>e.controlType===t);if(0===n.length)return;const a=this._styleCounters.get(t)||0;return a<n.length?(this._styleCounters.set(t,a+1),n[a]):void 0}constructor(e,n){this._assignedPositions=new Set,this._styleCounters=new Map,this._webPartIndexes=[],this._suggestion=e;const i=e.Style(),r=e.Id.includes("_f");this._controlStyles=i.then(t=>s()?(0,a.getControlStylesLegacy)(t,e.DynamicStyle,e.StyleMetadata,r):(0,a.getControlStyles)(t,e.DynamicStyle,e.StyleMetadata,r)),i.then(e=>{n.setStyle(e)}).catch(e=>{new t._QosMonitorShareFailureWithCP("DesignIdeasSectionAriaLabel",!1,[]).writeUnexpectedFailure("BuildSectionLabels",e)})}}var X=_(529),Z=_(707),$=_(758);const ee=t._LogSource.create("DesignIdeasStyler");async function te(e){const t=e.Value;let i,r;!n._SPKillSwitch.isActivated("a7455fda-f876-48e8-8060-236afcfd2328")&&t.url.includes("DesignIdeasCuratedImage")&&(r=a.CuratedStockImageProvider.getBackgroundOverlaySettings(t));const o=function(e){return{source:b.ImageSource.Hubble,fileName:(0,$.getFileNameFromUrl)(e.url),url:e.url,width:e.width,height:e.height,contentProvider:n._SPKillSwitch.isActivated("6b3c97ae-c33a-4c1e-9b88-5dc1e87ab20f")?void 0:e.contentProvider,stockMediaId:e.id,insertionISOTimestamp:(0,S.getTimestampForGettyContent)(e.contentProvider)}}(t);return i=r?{type:"image",imageData:o,overlay:{color:r.color,opacity:r.opacity},useLightText:r.useLightText}:{type:"image",imageData:o,...await ne(o)},i}function ne(e){const n=(0,b.getZoneBgImageThumbnailUrl)(e,400);return new Promise((e,a)=>{const i=performance.now(),r=new Image;r.crossOrigin="anonymous",r.onload=()=>{t._TraceLogger.logVerbose(ee,`Image loaded in ${performance.now()-i}ms`),(0,Z.getRecommendOverlayAndOpacity)(r).then(n=>{t._TraceLogger.logVerbose(ee,`Image loaded and calculated in ${performance.now()-i}ms`),e(n)}).catch(e=>{a(e)})},r.onerror=e=>{a(e)},r.src=n})}class ae extends H{get dataKey(){return"webPartData"}get identifier(){return{contentType:b.CanvasControlType.WebPartZone,webPartId:e.WebPartManifestIds.ImageWebPart}}async performStyleChange(e,t){const n=t.properties.imageSource||t.serverProcessedContent?.imageSources?.imageSource,i=!(!(0,a.isCuratedImage)(n)||!e.imageInfo),r=i?e.imageInfo?.width:t.properties.imgWidth,o=i?e.imageInfo?.height:t.properties.imgHeight,s=e.aspectRatio?v(r,o,e.aspectRatio):void 0,c=i?e.imageInfo?.url||"":n,d=i?e.imageInfo?.width:t.properties.imgWidth,l=i?e.imageInfo?.height:t.properties.imgHeight;return Promise.resolve({...t,properties:{...t.properties,imageSource:c,imageShape:e.shape,imageShapeData:{imageShape:e.shape,width:d,height:l},resizeCoefficient:e.resizeCoefficient,resizeDesiredWidth:e.resizeDesiredWidth,cropX:s?.x??0,cropY:s?.y??0,cropWidth:s?.width??void 0,cropHeight:s?.height??void 0,imgWidth:d,imgHeight:l},serverProcessedContent:{customMetadata:{imageSource:{width:d,height:l}},imageSources:{imageSource:c}}})}constructor(e){super(e)}}const ie=[".doc",".docx",".ppt",".pptx",".xls",".xlsx",".pdf",".txt"],re=[I.ButtonTreatment.FillColor,I.ButtonTreatment.Outline,I.ButtonTreatment.None];class oe extends H{get dataKey(){return"webPartData"}get identifier(){return{contentType:b.CanvasControlType.WebPartZone,webPartId:e.WebPartManifestIds.QuickLinks}}async performStyleChange(e,t){const n=e.zoneEmphasis||0,o=e.layoutId,s=e.suggestedImages,c=e.suggestedIcons,d=t.properties?.items||[],l=t.serverProcessedContent?.links||{},u=d.length||0,f=t.serverProcessedContent?.imageSources||{},p="Grid"===e.layoutId||"FilmStrip"===e.layoutId,m=(e,t)=>{d[e]={...d[e],thumbnailType:2,fabricReactIcon:{iconName:t}}},_=E(t,0,p);let h=!1;for(let e=0;e<d.length;e++){if(d[e].title!==A.W){h=!1;break}h=!0}if(_===w.Icon)for(let e=0;e<u;e++){d[e].thumbnailType=2;const n=c?c.get(e):void 0;if(!n||"globe"===n||void 0!==t.properties?.items[e].fabricReactIcon&&"circleaddition"!==t.properties.items[e].fabricReactIcon.iconName)if(t.serverProcessedContent?.searchablePlainTexts?.[`items[${e}].title`]===A.W)m(e,"circleaddition");else if(n||t.properties?.items[e].fabricReactIcon&&("circleaddition"!==t.properties.items[e].fabricReactIcon.iconName||!d[e].sourceItem?.fileExtension))"circleaddition"===t.properties?.items[e].fabricReactIcon&&t.serverProcessedContent?.searchablePlainTexts?.[`items[${e}].title`]!==A.W&&m(e,"globe");else{const n=d[e].sourceItem?.fileExtension?.toLowerCase(),a=t.properties?.items[e].title||void 0,i=t.serverProcessedContent?.searchablePlainTexts,r=O(n,a,i&&i[`items[${e}].title`]);r&&m(e,r)}else m(e,n)}else if(_===w.Image)for(let e=0;e<u;e++){2===d[e].thumbnailType&&(d[e].thumbnailType=1);const t=s?s.get(e):void 0;!t||x._PreviewUtility.isImage(l[`items[${e}].sourceItem.url`])||f[`items[${e}].image.url`]&&!f[`items[${e}].image.url`].includes("DesignIdeasCuratedImage")||(f[`items[${e}].image.url`]=t.url,d[e]={...d[e],image:{url:t.url,contentProvider:t.contentProvider,insertionISOTimestamp:(0,S.isGettyContent)(t?.contentProvider)?(new Date).toISOString():void 0,stockMediaId:t.id}});let n=d[e].sourceItem?.fileExtension;n&&(n=n.toLowerCase(),ie.includes(n)&&(d[e].thumbnailType=3))}else if(!p)for(let e=0;e<u;e++){let n=d[e].sourceItem?.fileExtension;if(n){n=n.toLowerCase();const a=t.properties?.items[e].title||void 0,i=t.serverProcessedContent?.searchablePlainTexts,r=O(n,a,i&&i[`items[${e}].title`]);r&&m(e,r)}}const b=4-u,g=4===b||h?p:_===w.Image,v=a.CuratedStockImageProvider.getCuratedStockImages(h?4:b);if(h)for(let e=0;e<d.length;e++)g?(d[e].image={url:v[e].url},d[e].thumbnailType=1):d[e].thumbnailType=2,l[`items[${e}].sourceItem.url`]=v[e].url,f[`items[${e}].image.url`]=v[e].url;for(let e=u;e<4;e++){const t=v[e-u].url;d[e]=g?{title:A.W,image:{url:t},thumbnailType:1,sourceItem:{itemType:2}}:{title:A.W,thumbnailType:2,sourceItem:{itemType:2}},f[`items[${e}].fabricReactIcon.iconName`]="circleaddition",l[`items[${e}].sourceItem.url`]=t,f[`items[${e}].image.url`]=t}if(!r())for(let e=0;e<d.length;e++)d[e].id=d.length-e;return i()||function(e,t){switch(e.layoutId){case"Button":const e=t.properties.buttonLayoutOptions;if(e.buttonTreatment===I.ButtonTreatment.None&&e.iconPositionType===I.IconPositionType.NoIcon)t.properties.buttonLayoutOptions={...t.properties.buttonLayoutOptions,buttonTreatment:Math.random()>.5?I.ButtonTreatment.Outline:I.ButtonTreatment.FillColor,iconPositionType:Math.random()>.5?I.IconPositionType.IconToLeft:I.IconPositionType.IconToTop};else if(e.iconPositionType!==I.IconPositionType.NoIcon){const e=re[Math.floor(Math.random()*re.length)];t.properties.buttonLayoutOptions={...t.properties.buttonLayoutOptions,buttonTreatment:e}}else t.properties.buttonLayoutOptions={...t.properties.buttonLayoutOptions,IconPositionType:Math.random()>.5?I.IconPositionType.IconToLeft:I.IconPositionType.IconToTop};break;case"List":t.properties.listLayoutOptions={...t.properties.listLayoutOptions,showIcon:!0};break;case"Waffle":const n=t.properties.items.some(e=>1===e.thumbnailType),a=t.properties.waffleLayoutOptions;if(n)if(a.onlyShowThumbnail){if(a.onlyShowThumbnail){const e=[I.IconSize.ExtraLarge,I.IconSize.Fill];a.iconSize=e[Math.floor(Math.random()*e.length)]}}else{const e=[I.IconSize.Small,I.IconSize.Large,I.IconSize.ExtraLarge,I.IconSize.Fill];a.iconSize=e[Math.floor(Math.random()*e.length)]}else{const e=[I.IconSize.Small,I.IconSize.Medium,I.IconSize.Large];a.iconSize=e[Math.floor(Math.random()*e.length)]}}}(e,t),Promise.resolve({...t,serverProcessedContent:{...t.serverProcessedContent,imageSources:f},properties:{...t.properties,items:d,zoneEmphasis:n,layoutId:o}})}constructor(e){super(e)}}class se extends H{get dataKey(){return"webPartData"}get identifier(){return{contentType:b.CanvasControlType.WebPartZone,webPartId:e.WebPartManifestIds.Banner}}async performStyleChange(t,n){const a=t.layoutType,i=t.backgroundStyle?.Value;let r;return i&&(r=(0,e.replaceTasDomainWithHubble)(i.url)),Promise.resolve({...n,properties:{...n.properties,imageSourceType:2,imgWidth:i?i.width:n.properties.imgWidth,imgHeight:i?i.height:n.properties.imgHeight,layoutType:a,textAlignment:t.alignment||n.properties.textAlignment,enableGradientEffect:t.enableGradientEffect||n.properties.enableGradientEffect,title:n.properties.title?n.properties.title:t.placeHolderText,contentProvider:i?.contentProvider,insertionISOTimestamp:(0,S.getTimestampForGettyContent)(i.contentProvider),stockMediaId:i?i.id:n.properties.stockMediaId},serverProcessedContent:{...n.serverProcessedContent,imageSources:{imageSource:r||n.serverProcessedContent?.imageSources?.imageSource||""}}})}constructor(e){super(e)}}class ce extends H{get dataKey(){return"webPartData"}get identifier(){return{contentType:b.CanvasControlType.WebPartZone,webPartId:this._webPartId}}async performStyleChange(e,t){return Promise.resolve({...t})}constructor(e,t){super(e),this._webPartId=t}}class de{createStyler(t,n){let a;return t.contentType===b.CanvasControlType.RTE?new q(this._serviceScope):t.contentType===b.CanvasControlType.WebPartZone&&t.webPartId===e.WebPartManifestIds.ImageWebPart?(a=new ae(this._serviceScope),a):t.contentType===b.CanvasControlType.WebPartZone&&t.webPartId===e.WebPartManifestIds.QuickLinks?(a=new oe(this._serviceScope),a):t.contentType===b.CanvasControlType.WebPartZone&&t.webPartId===e.WebPartManifestIds.Banner?(a=new se(this._serviceScope),a):t.contentType===b.CanvasControlType.WebPartZone&&t.webPartId&&e.DECOMP_WEB_PARTS.has(t.webPartId)?(a=new ce(this._serviceScope,t.webPartId),a):void 0}constructor(e){this._serviceScope=e}}const le=17.2;class ue{_initializeSectionPositionMapEntry(t,n,a,i){const r=n.position.sectionIndex,o=n.position.controlIndex,s=n.alignment||b.ZoneGroupAlignment.Center,c=n.position.flexibleLayoutPosition.w;if(void 0!==r&&void 0!==o){this._sectionPositionMap[r]||(this._sectionPositionMap[r]={});const d=`${t.id}_${a}`,l=t.controlType===b.CanvasControlType.WebPartZone&&t.webPartId===e.WebPartManifestIds.ImageWebPart?this._calculateImageWebPartHeight(t.webPartData.properties,c):0,u={y:i?n.position.flexibleLayoutPosition.y:-1,h:l,x:n.position.flexibleLayoutPosition.x,w:n.position.flexibleLayoutPosition.w,customControlId:d,contentAlignment:s,webPartId:t.controlType===b.CanvasControlType.WebPartZone?t.webPartId:void 0,originalY:i?n.position.flexibleLayoutPosition.y:void 0};this._sectionPositionMap[r][o]=u}}_updateFlexibleControlPositions(e,t,n){if(n)this._updateFlexibleControlPositionsForPageTemplate(e,t);else{for(const e in this._sectionPositionMap)this._sectionPositionMap[parseInt(e,10)]&&this._updateYPositionsInSection(parseInt(e,10));t===b.ZoneGroupAlignment.Center&&this._updateYPositionForCenterAlignment(),e.forEach(e=>{const t=e.position.sectionIndex,n=e.position.controlIndex;if(void 0!==t&&void 0!==n){const a=this._sectionPositionMap[t][n];if(a&&e.flexibleLayoutPosition){const t={...e.flexibleLayoutPosition.lg,x:a.x,w:a.w,y:a.y,h:a.h};e.flexibleLayoutPosition={lg:t}}}})}}async adjustHeightsAfterRender(t,a,i){let r={},s=!1;const c=[];for(const e of Object.values(this._sectionPositionMap))if(e)for(const t of Object.values(e))t.customControlId&&c.push(t.customControlId);if(c.length>0)try{const a=!n._SPKillSwitch.isActivated("dea54ebb-f015-4731-bdd5-dd0e46e4c942")&&t.some(e=>this._isIframeBasedWebPart(e)),i=!o()&&t.some(t=>t.controlType===b.CanvasControlType.WebPartZone&&e.DYNAMIC_CONTENT_WEB_PARTS.has(t.webPartId)),s=a||i?8e3:3e3;r=o()?await this._getRenderedControlHeights(c,s):await this._getStabilizedControlHeights(c,s)}catch(e){s=!0,await this._waitForDomUpdate()}const d=[];for(const e in this._sectionPositionMap)if(this._sectionPositionMap[e]){const t=this._sectionPositionMap[e];for(const e in t)if(t[e]){const n=t[e];n.customControlId&&(s?d.push(this._getControlHeightWithRetry(n.customControlId).then(e=>{e&&(n.h=e/le)})):n.h=r[n.customControlId]?r[n.customControlId]/le:2)}}await Promise.all(d),i&&this._finalizePageTemplatePositions(a),this._updateFlexibleControlPositions(t,a,i)}_finalizePageTemplatePositions(e){for(const e in this._sectionPositionMap)this._sectionPositionMap[parseInt(e,10)]&&this._updateYPositionsInSectionForPageTemplate(parseInt(e,10));e===b.ZoneGroupAlignment.Center&&this._updateYPositionForCenterAlignmentPageTemplate()}async _getControlHeightWithRetry(e,t=5,n=100){for(let a=0;a<t;a++){const t=document.querySelector(`[data-flex-control-id="${e}"]`);if(t){await new Promise(e=>requestAnimationFrame(e));const e=t.offsetHeight;if(e>0)return e}await new Promise(e=>setTimeout(e,n))}}async _getStabilizedControlHeights(t,n=3e3){const a=Date.now(),i={},r=new Set;for(const t of Object.values(this._sectionPositionMap))for(const n of Object.values(t))n.customControlId&&n.webPartId&&e.DYNAMIC_CONTENT_WEB_PARTS.has(n.webPartId)&&r.add(n.customControlId);return new Promise((e,o)=>{const s=()=>{const c={};let d=!0;for(const e of t){const t=document.querySelector(`[data-automationid="SPContentPanelView-panels"] [data-flex-control-id="${e}"]`);if(!t||0===t.offsetHeight){d=!1;break}const n=t.offsetHeight;r.has(e)?(i[e]||(i[e]=[]),i[e].push(n),i[e].length>3&&i[e].shift(),3===i[e].length&&i[e].every(e=>e===n)?c[e]=n:d=!1):c[e]=n}d&&Object.keys(c).length===t.length?e(c):Date.now()-a>n?o(new Error("Timeout waiting for all controls to render with stabilized heights")):setTimeout(s,1e3)};s()})}async _getRenderedControlHeights(e,t=3e3){const n=Date.now();return new Promise((a,i)=>{const r=()=>{const o={};for(const a of e){const e=document.querySelector(`[data-automationid="SPContentPanelView-panels"] [data-flex-control-id="${a}"]`);if(!(e&&e.offsetHeight>0))return void(Date.now()-n>t?i(new Error("Timeout waiting for all controls to render")):setTimeout(r,100));o[a]=e.offsetHeight}a(o)};r()})}_waitForDomUpdate(e=3e3){return new Promise((t,n)=>{const a=new MutationObserver(e=>{a.disconnect(),t()}),i=document.querySelector('[data-automationid="SPContentPanelView-panels"]');i?(a.observe(i,{childList:!0,subtree:!0,attributes:!0}),setTimeout(()=>{a.disconnect(),t()},e)):n(new Error("ContentPanel node for MutationObserver not found."))})}_updateYPositionsInSection(e){const t=this._sectionPositionMap[e];Object.keys(t).forEach(e=>{const n=parseInt(e,10);let a=0;if(n>1&&t[n-1]){const e=t[n-1];a+=e.y+e.h}t[n].y=a;const i=a+t[n].h;this._zoneHeight=Math.max(this._zoneHeight,i*le)})}_calculateTotalContentHeight(e){let t=0;return Object.keys(e).forEach(n=>{const a=parseInt(n,10);a>1&&(t+=2);const i=e[a];t+=i.h}),t}_updateYPositionForCenterAlignment(){for(const e in this._sectionPositionMap)if(this._sectionPositionMap[e]){const t=this._sectionPositionMap[e],n=this._calculateTotalContentHeight(t),a=this._zoneHeight/le/2,i=Math.max(0,a-n/2),r=Object.keys(t)[0],o=parseInt(r,10);t[o]&&(t[o].y=i),Object.keys(t).forEach(e=>{if(e===r)return;const n=parseInt(e,10),a=t[n-1],i=a.y+a.h+2;t[n].y=i})}}_calculateImageWebPartHeight(e,t){const n=e.imgHeight||0,a=e.imgWidth||0;return t?t/(a/n):n/le}_isIframeBasedWebPart(t){return t.controlType===b.CanvasControlType.WebPartZone&&e.IFRAME_BASED_WEB_PARTS.has(t.webPartId)}_updateFlexibleControlPositionsForPageTemplate(e,t){e.forEach(e=>{const t=e.position.sectionIndex,n=e.position.controlIndex;if(void 0!==t&&void 0!==n){const a=this._sectionPositionMap[t][n];if(a&&e.flexibleLayoutPosition){const t={...e.flexibleLayoutPosition.lg,x:a.x,w:a.w,y:a.y,h:a.h};e.flexibleLayoutPosition={lg:t}}}})}_updateYPositionsInSectionForPageTemplate(e){const t=this._sectionPositionMap[e],a=Object.keys(t).map(e=>parseInt(e,10)).sort((e,n)=>{const a=t[e],i=t[n];return(a.originalY??0)-(i.originalY??0)}),i=[];a.forEach(e=>{const a=t[e];let r=void 0!==a.originalY&&a.originalY>=0?a.originalY:0,o=0;for(;o<50&&this._hasCollisionForPageTemplate(a,r,i);){const e=this._findLowestClearPosition(a,r,i),t=n._SPKillSwitch.isActivated("a381467f-e815-44d4-8cf3-df0d0b101766")?0:1;r=Math.max(r+1,e+t),o++}a.y=r,i.push({...a})}),a.forEach(e=>{const n=t[e],a=n.y+n.h;this._zoneHeight=Math.max(this._zoneHeight,a*le)})}_hasCollisionForPageTemplate(e,t,n){const a=e.x,i=e.x+e.w,r=t,o=t+e.h;return n.some(e=>{const t=e.x,n=e.x+e.w,s=e.y,c=e.y+e.h;return a<n&&i>t&&r<c&&o>s})}_findLowestClearPosition(e,t,n){const a=e.x,i=e.x+e.w;let r=t;return n.filter(e=>{const t=e.x,n=e.x+e.w;return a<n&&i>t}).forEach(e=>{const t=e.y+e.h;r=Math.max(r,t)}),r}_updateYPositionForCenterAlignmentPageTemplate(){for(const e in this._sectionPositionMap)if(this._sectionPositionMap[e]){const t=this._sectionPositionMap[e];let n=1/0,a=-1/0;Object.keys(t).forEach(e=>{const i=t[parseInt(e,10)];n=Math.min(n,i.y),a=Math.max(a,i.y+i.h)});const i=a-n,r=this._zoneHeight/le/2,o=Math.max(0,r-i/2)-n;Object.keys(t).forEach(e=>{const n=parseInt(e,10);t[n].y+=o})}}constructor(){this._sectionPositionMap={},this._zoneHeight=0}}const fe=t._LogSource.create("DesignIdeas.Styler");class pe{async applyStyle(a,i,r){const o=[],s=new u(a),c=new J(a,s);let l=r;const f=(0,e.isFlexibleSectionWithSupportEnabled)(i);this._isPowerpointSuggestion=n._SPKillSwitch.isActivated("e5daf3f9-dca5-4f2f-be70-6a81bd954afa")?void 0:a.Id.includes("_fp"),this._isPageTemplate=a.Id.includes("_ft");const p=a.Id.includes("_f")&&!this._isPageTemplate&&!this._isPowerpointSuggestion;this._hasFlexibleSuffix=p||this._isPageTemplate,this._isEmptySection=i.some(e=>"emptySection"===e.id);let m=!1;if(!n._SPKillSwitch.isActivated("685fcf26-a9ed-4a82-9b1a-7119b4ab2a1c")){for(const t of i)if((0,e.isTitleRegion)(t)){m=!0;break}l=await async function(t,a,i,r,o){let s=(0,X.cloneDeep)(a);const c=(0,b.getZoneSettingsFromExtraData)(s,i,"zoneBackground"),d=(!n._SPKillSwitch.isActivated("3d2220b5-5a8a-466b-9998-4b7e84da74fa")&&n._SPFlight.isEnabled(1927)||!n._SPKillSwitch.isActivated("b2e7a8ba-1211-478c-995c-220b1a408070")&&n._SPFlight.isEnabled(61115))&&"color"===t?.Type;if((0,e.isThemeV2EnabledInDesignIdeas)()&&s&&s.webPartData.properties.zoneThemeIndex&&s.webPartData.properties.zoneThemeIndex?.[i]&&(s.webPartData.properties.zoneThemeIndex[i]=void 0),t&&("oobBackground"===t?.Type||d)){if(c){const e=a?.webPartData.properties.zoneBackground?.[i];if(e&&"image"===e.type){const t=await ne(e.imageData),n={...e,...t};return s=(0,Z.createCanvasExtraDataControl)({zoneBackground:{[i]:n}}),Promise.resolve(s)}return o?(s=(0,Z.createCanvasExtraDataControl)({zoneBackground:{[i]:t.Value}}),Promise.resolve(s)):Promise.resolve(a)}return s=(0,Z.createCanvasExtraDataControl)({zoneBackground:{[i]:t.Value}}),s}if("image"===t?.Type&&!r){const e=await te(t);return s&&"image"===c?.type?s.webPartData.properties.zoneBackground[i]=e:s=(0,Z.createCanvasExtraDataControl)({zoneBackground:{[i]:e}}),s}if((0,e.isThemeV2EnabledInDesignIdeas)()&&"themeIndex"===t?.Type){const e=t.Value;return s=(0,Z.createCanvasExtraDataControl)({zoneThemeIndex:{[i]:e}}),s}}(a.DynamicStyle?.BackgroundStyle,r,i[0]?.position.zoneId,m,f)}return i.filter(e=>e.id&&"emptySection"!==e.id).forEach(e=>{if(f){const t=this.getFlexibleStyler(e),n=t&&c.getNextStyle(t.identifier);this._processStylerAndStyle(t,n,e,o,a.Id)}else{const t=this.getStyler(e),n=t&&c.getNextStyle(t.identifier);this._processStylerAndStyle(t,n,e,o,a.Id)}}),Promise.all(o).then(t=>{if(s.buildSectionLabels(),(0,e.isTitleRegion)(i[0])||s.applyColumnsLabel(t),d()&&f&&this._hasFlexibleSuffix){const e=a.DynamicStyle?.ContentAlignment??b.ZoneGroupAlignment.Center;this._positionMapBuilder._updateFlexibleControlPositions(t,e,this._isPageTemplate)}return s.setAriaLabel(),{controls:t,canvasExtraData:l}}).catch(e=>{throw this._qosMonitor.writeUnexpectedFailure("ApplyStyle",e),t._TraceLogger.logError(fe,e),e})}triggerHeightRecalculation(e,t){return this._positionMapBuilder||(this._positionMapBuilder=new ue),this._positionMapBuilder.adjustHeightsAfterRender(e,t,this._isPageTemplate)}getStyler(e){return e.controlType===b.CanvasControlType.RTE?this._stylerFactory.createStyler({contentType:e.controlType}):e.controlType===b.CanvasControlType.WebPartZone?this._stylerFactory.createStyler({contentType:e.controlType,webPartId:e.webPartId}):void 0}getFlexibleStyler(e){return e.controlType===b.CanvasControlType.RTE?this._flexibleStylerFactory.createStyler({contentType:e.controlType}):e.controlType===b.CanvasControlType.WebPartZone?this._flexibleStylerFactory.createStyler({contentType:e.controlType,webPartId:e.webPartId}):void 0}_processStylerAndStyle(e,t,n,a,i){e&&t?a.push(t.then(async t=>{await this._yieldToMain();const a=await e.getUpdatedCanvasControlData(t,n,this._hasFlexibleSuffix,this._isEmptySection);if(d()&&this._hasFlexibleSuffix){const e=t;this._positionMapBuilder._initializeSectionPositionMapEntry(a,e,i,this._isPageTemplate)}return a})):a.push(Promise.resolve(n))}_yieldToMain(){return new Promise(e=>{setTimeout(e,0)})}constructor(e){this._qosMonitor=new t._QosMonitor("DesignIdeas.Styler.applyStyle",!1,!0),this._serviceScope=e,this._hasFlexibleSuffix=!1,this._isPageTemplate=!1,this._stylerFactory=new Q(this._serviceScope),this._flexibleStylerFactory=new de(this._serviceScope),this._positionMapBuilder=new ue,this._isEmptySection=!1}}async function me(t,n){const a=((0,e.isDesignIdeasForEmptyFlexibleSectionEnabled)()||(0,e.isDesignIdeasFlexibleSectionsWithContentEnabled)())&&"color"===t?.Type;return t&&("oobBackground"===t?.Type||a)?t.Value:"image"!==t?.Type||n?void 0:await te(t)}function _e(t,i,r,o,s){const c=[],d=[],l=[];let u,f;const p=[];if(t){const i=t[0].emphasis;if(t.forEach(i=>{if(i.controlType===b.CanvasControlType.RTE&&i.innerHTML)c.push(i.innerHTML),(0,e.isFlexibleSectionWithSupportEnabled)(t)&&((0,a.extractHeadings)(i.innerHTML)?.length?p.push("heading"):p.push("paragraph"));else if((0,e.isTitleRegion)(i))c.push(i.webPartData.properties.title),u=function(t){const n={TextStyleDTO:[]};if((0,e.isTitleRegion)(t)){n.OtherStyles=new Map;const e=(a=t.webPartData?.properties?.layoutType,i=t.webPartData?.properties?.textAlignment,"CutInShape"===a&&"Left"===i?"cutInShapeLeft":"CutInShape"===a&&"Center"===i?"cutInShapeCenter":"ColorBlock"===a&&"Left"===i?"colorBlockLeft":"ColorBlock"===a&&"Center"===i?"colorBlockCenter":"Fade"===a&&"Left"===i?"fadeLeft":"FullWidthImage"===a&&"Left"===i?"fullWidthLeft":"FullWidthImage"===a&&"Center"===i?"fullWidthCenter":void 0);e&&n.OtherStyles.set("BannerStyle",[e])}var a,i;return n}(i),i.webPartData.serverProcessedContent?.imageSources?.imageSource&&(f={Type:"image",Value:i.webPartData.serverProcessedContent?.imageSources?.imageSource||""});else if(n._SPKillSwitch.isActivated("9f5b2f7a-ab91-43cc-8711-30a7735301db")||i.controlType!==b.CanvasControlType.WebPartZone||i.webPartId!==e.WebPartManifestIds.ImageWebPart){if(i.controlType===b.CanvasControlType.WebPartZone&&i.webPartId===e.WebPartManifestIds.QuickLinks){const e=i.webPartData.properties.items.length||0;for(let t=0;t<e;t++){const e=i.webPartData.serverProcessedContent?.searchablePlainTexts;let n=i.webPartData.properties?.items[t].title||void 0;!n&&e&&(n=e[`items[${t}].title`]||void 0),l.push(n)}}}else{const e=i,t={url:e.webPartData.properties.imageSource||e.webPartData.serverProcessedContent?.imageSources?.imageSource||"",width:e.webPartData.properties.imgWidth||e.webPartData.serverProcessedContent?.customMetadata?.imageSource?.width||0,height:e.webPartData.properties.imgHeight||e.webPartData.serverProcessedContent?.customMetadata?.imageSource?.height||0};t.url&&t.width>0&&t.height>0&&d.push(t)}}),(0,e.isFlexibleSectionWithSupportEnabled)(t)&&(!n._SPKillSwitch.isActivated("468c6eee-98d2-4169-99e9-093b0fb5a3dc")&&"emptySection"===t[0].id&&s&&c.push(s),u={...u,PlaceholderType:p}),i&&i.zoneEmphasis)return{backgroundStyle:{Type:"emphasis",Value:i.zoneEmphasis?.toString()},htmlContent:c,imageContent:d,linkContent:l,styleMetdata:u}}if(i&&r){const e=(0,b.getZoneSettingsFromExtraData)(i,r,"zoneBackground");if("gradient"===e?.type)return{backgroundStyle:{Type:"oobBackground",Value:e.gradient},htmlContent:c,imageContent:d,linkContent:l,styleMetdata:u};if("image"===e?.type)return{backgroundStyle:{Type:e.imageData.source!==b.ImageSource.Layouts||!n._SPKillSwitch.isActivated("2aafdb7c-4e25-462b-9112-3362f1aff3e2")&&(0,a.isCuratedImage)(e.imageData.url)?"image":"oobBackground",Value:e.imageData.url},htmlContent:c,imageContent:d,linkContent:l,styleMetdata:u}}return{backgroundStyle:f,htmlContent:c,imageContent:d,linkContent:l,styleMetdata:u,cultureName:o}}function he(e,t){if(void 0===e&&void 0===t)return!0;if(void 0===e||void 0===t)return!1;let n=0,a=0,i=0,r=0,o=0,s=0,c=0,d=0,l=0,u=0;return n=e.OtherWebParts?.get("NonSupported")||0,r=t.OtherWebParts?.get("NonSupported")||0,a=e.OtherWebParts?.get("Banner")||0,o=t.OtherWebParts?.get("Banner")||0,i=e.OtherWebParts?.get("QuickLinks")||0,s=t.OtherWebParts?.get("QuickLinks")||0,c=e.OtherWebParts?.get("Cards")||0,d=t.OtherWebParts?.get("Cards")||0,l=e.OtherWebParts?.get("Media")||0,u=t.OtherWebParts?.get("Media")||0,e.TextCount===t.TextCount&&e.BlankTextCount===t.BlankTextCount&&e.ImageCount===t.ImageCount&&n===r&&a===o&&i===s&&c===d&&l===u}function be(e,t){return 1!==e?.TextCount||0!==e?.ImageCount||1!==t?.TextCount||0!==t?.ImageCount||!!e?.InlineImageCount==!!t?.InlineImageCount}function ge(t,a){let i=function(t,n){const a=t.DynamicStyle?.ImageStyle;if(a){const t=(0,X.cloneDeep)(n);for(let i=0;i<a.length;i++)a[i].imageInfo&&t.push((0,e.getImageWebPart)(a[i].imageInfo,n[0]?.position,a[i].overlayTextInfo,n[0]?.emphasis));return t}return n}(t,a);return i=function(t,a,i=!1){if(!t.Content)return a;if(!t.Content.TextContents||!t.Content.TextContents.length)return a;if(i){const i=!!(t.Content.ImageContents&&t.Content.ImageContents.length>0),r=(0,X.cloneDeep)(a).filter(e=>4!==e.controlType&&("d1d91016-032f-456d-98a4-721247c305e8"!==e.id||!i));t.Content?.TextContents.forEach((e,t)=>{r.push({controlType:4,id:n.Guid.newGuid().toString(),position:{...a[0]?.position,controlIndex:(a[0]?.position.controlIndex||0)+1+t},innerHTML:e})});let o=!1;return t.Content?.ImageContents?.forEach((n,i)=>{n.imageInfo&&(r.push((0,e.getImageWebPart)(n.imageInfo,a[0]?.position,n.overlayTextInfo,a[0]?.emphasis)),"Reflection"!==t.StyleMetadata?.BackgroundStyle||o||(t.DynamicStyle={TextStyleDTO:t.DynamicStyle?.TextStyleDTO||[],ImageStyle:t.DynamicStyle?.ImageStyle||[],WebPartPositionStyle:t.DynamicStyle?.WebPartPositionStyle||[],BackgroundStyle:{Type:"image",Value:n.imageInfo}},o=!0))}),r}{const e=(0,X.cloneDeep)(a),n=e.length,i=t.Content.TextContents?t.Content.TextContents.length:0;let r=0,o=0;for(;r<n;){const n=e[r++];if(n.controlType===b.CanvasControlType.RTE&&void 0!==n.innerHTML&&o<i){const e=document.createElement("div");e.innerHTML=n.innerHTML,e.textContent||(n.innerHTML=t.Content.TextContents[o++])}}return e}}(t,i,(0,e.isDesignIdeasTextDecompEnabled)()),i=function(t){const n=(0,X.cloneDeep)(t);return n.forEach(t=>{if((0,b.isWebPart)(t)&&t.webPartId===e.WebPartManifestIds.ImageWebPart){const n=t.webPartData,a=n.properties.imageSource||n.serverProcessedContent?.imageSources?.imageSource,i=(0,e.replaceTasDomainWithHubble)(a);i&&(t.webPartData=function(e,t){return{...e,properties:{...e.properties,imageSource:t},serverProcessedContent:{...e.serverProcessedContent,imageSources:{imageSource:t}}}}(n,i))}}),n}(i),i=c()?function(t){const n=(0,X.cloneDeep)(t);return n.forEach(t=>{"innerHTML"in t&&t.innerHTML&&(t.innerHTML=(0,e.removeFullTextStyles)(t.innerHTML))}),n}(i):i,i}})(),h})());