define("b941ee31-7b1e-4ee7-84da-5f94b24ac421_0.1.0",["@microsoft/sp-core-library","@microsoft/sp-diagnostics","@microsoft/sp-page-context","@msinternal/sp-component-utilities","@microsoft/sp-lodash-subset","@msinternal/sp-canvas-types","@msinternal/sp-ai-properties-tools","@msinternal/sp-ai-properties","@msinternal/sp-canvas-edit-shared","@msinternal/sp-canvas-read","@microsoft/sp-http","@microsoft/sp-loader","@microsoft/sp-webpart-base","react"],(e,t,n,a,i,r,o,s,c,d,l,u,f,p)=>(()=>{"use strict";var m={676:t=>{t.exports=e},207:e=>{e.exports=t},909:e=>{e.exports=l},414:e=>{e.exports=u},529:e=>{e.exports=i},408:e=>{e.exports=n},642:e=>{e.exports=f},232:e=>{e.exports=s},286:e=>{e.exports=o},707:e=>{e.exports=c},631:e=>{e.exports=d},560:e=>{e.exports=r},718:e=>{e.exports=a},959:e=>{e.exports=p}},_={};function h(e){var t=_[e];if(void 0!==t)return t.exports;var n=_[e]={exports:{}};return m[e](n,n.exports,h),n.exports}h.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return h.d(t,{a:t}),t},h.d=(e,t)=>{for(var n in t)h.o(t,n)&&!h.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},h.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),h.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var b={};return(()=>{h.r(b),h.d(b,{AIPropertiesEngagementService:()=>It,AIPropertiesFeatureName:()=>U,AIPropertiesServiceType:()=>vt,AIPropertiesWorkflowError:()=>z,AIPropertiesWorkflowExecutor:()=>rt,CALL_TO_ACTION_WEBPART_MANIFEST_ID:()=>Ye,CHART_WIDGET_WEBPART_MANIFEST_ID:()=>He,COUNTDOWN_WEBPART_MANIFEST_ID:()=>Be,ComponentType:()=>st,DEFAULT_AI_PROPERTIES_WEBPART_ALLOW_LIST:()=>Xe,DIVIDER_WEBPART_MANIFEST_ID:()=>Ne,EVENTS_WEBPART_MANIFEST_ID:()=>Re,HERO_WEBPART_MANIFEST_ID:()=>We,IMAGE_WEBPART_NEXT_MANIFEST_ID:()=>Je,IntentValidationType:()=>ot,LIST_WEBPART_V2_MANIFEST_ID:()=>Fe,LOOP_WEB_PREVIEWER_WEBPART_MANIFEST_ID:()=>Ge,ManifestClient:()=>tt,NEWS_WEBPART_MANIFEST_ID:()=>ze,PAGE_TITLE_WEBPART_MANIFEST_ID:()=>Qe,PEOPLE_WEBPART_MANIFEST_ID:()=>je,QUICK_LINKS_WEBPART_MANIFEST_ID:()=>qe,RequestCategoryType:()=>ct,SPACER_WEBPART_MANIFEST_ID:()=>Ve,STREAM_WEBPART_MANIFEST_ID:()=>Ke,StreamingAICanvas:()=>Me,VIBE_AUTHORING_PROPERTIES_WEBPART_ALLOW_LIST:()=>Ze,WorkflowErrors:()=>V,addConversationLog:()=>B,filterManifestsWithAIProperties:()=>$e,fromAICanvasRawDataToCanvasContent:()=>Ae,fromAICanvasRawDataToCanvasContentAsync:()=>Ee,fromAICanvasResultToRaw:()=>ne,fromAIColumnRawDataToCanvasControls:()=>le,fromAIColumnResultToRaw:()=>Z,fromAIControlDataRawToAIProperties:()=>_t,fromAIControlDataRawToAIPropertiesWithFallback:()=>ht,fromAIControlRawDataToCanvasControl:()=>de,fromAIControlRawDataToCanvasControlWithoutPosition:()=>ce,fromAIControlResultToRaw:()=>X,fromAIPageDataRawToAIPropertiesWithFallback:()=>gt,fromAIPageResultToRaw:()=>lt,fromAIRegularLayoutRawDataToCanvasContent:()=>Oe,fromAIRegularLayoutRawDataToCanvasContentAsync:()=>Ce,fromAIRegularLayoutResultToRaw:()=>ee,fromAISPImageResultToBackgroundData:()=>me,fromAISectionRawDataToCanvasContent:()=>xe,fromAISectionRawDataToCanvasContentAsync:()=>Ie,fromAISectionResultToRaw:()=>$,fromAIVerticalLayoutRawDataToCanvasControls:()=>we,fromAIVerticalLayoutResultToRaw:()=>te,fromWebPartDataToWebPartProperties:()=>ft,fromWebPartPropertiesToAIProperties:()=>pt,getAIPropertiesServiceConfigString:()=>dt,getConversationLogs:()=>j,getDefaultAlProxy:()=>K,getSitePath:()=>Ue,isSectionBackgroundProcessed:()=>De,processBackgroundImageForAICanvasRaw:()=>ve,processBackgroundImageForAIRegurlayLayoutRaw:()=>ye,processBackgroundImageForAISectionRaw:()=>Se,usePreWarmedAIPropertiesWorkflowExecutor:()=>Dt});class e{constructor(t){e.assign(e,this,t)}static getTypeName(){return"AugLoop_Core_SchemaObject"}static getBaseTypes(){return[]}static getTypeNameFor(e){return e&&e.H_?e.H_.T_:void 0}static getBaseTypesFor(e){return e&&e.H_&&e.H_.B_&&Array.isArray(e.H_.B_)?e.H_.B_:[]}static getAllTypesFor(t){const n=e.getTypeNameFor(t);return n?[n,...e.getBaseTypesFor(t)]:[]}static matchesTypesFor(t,n){if(!Array.isArray(n)||0===n.length)return!0;const a=e.getTypeNameFor(t),i=e.getBaseTypesFor(t);for(const e of n){if(e===a)return!0;if(i.indexOf(e)>=0)return!0}return!1}static assign(e,t,n){if(n)for(const e of Object.keys(n))t[e]=n[e];return t.H_=e.H_,t}}e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()};class t{constructor(n){e.assign(t,this,n)}static getTypeName(){return"AugLoop_SharepointCopilot_AIPropertiesSignalBase"}static getBaseTypes(){return["AugLoop_Signals_Signal"]}static typeGuard(n){return e.matchesTypesFor(n,[t.getTypeName()])}}t.H_={T_:t.getTypeName(),B_:t.getBaseTypes()};class n{constructor(t){e.assign(n,this,t)}static getTypeName(){return"AugLoop_SharepointCopilot_AIPropertiesCreationSignal"}static getBaseTypes(){return["AugLoop_SharepointCopilot_AIPropertiesSignalBase","AugLoop_Signals_Signal"]}static typeGuard(t){return e.matchesTypesFor(t,[n.getTypeName()])}}n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()};class a{constructor(t){e.assign(a,this,t)}static getTypeName(){return"AugLoop_SharepointCopilot_AIPropertiesModificationSignal"}static getBaseTypes(){return["AugLoop_SharepointCopilot_AIPropertiesSignalBase","AugLoop_Signals_Signal"]}static typeGuard(t){return e.matchesTypesFor(t,[a.getTypeName()])}}a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};class i{constructor(t){e.assign(i,this,t)}static getTypeName(){return"AugLoop_SharepointCopilot_AIPropertiesEvaluationSignal"}static getBaseTypes(){return["AugLoop_SharepointCopilot_AIPropertiesSignalBase","AugLoop_Signals_Signal"]}static typeGuard(t){return e.matchesTypesFor(t,[i.getTypeName()])}}var r,o,s,c,d,l,u,f,p;i.H_={T_:i.getTypeName(),B_:i.getBaseTypes()},function(e){e[e.Creation=1]="Creation",e[e.Modification=2]="Modification",e[e.Evaluation=3]="Evaluation"}(r||(r={})),function(e){e[e.Success=0]="Success",e[e.Error=1]="Error",e[e.DataReady=2]="DataReady",e[e.Streaming=3]="Streaming",e[e.ValidateIntentReady=4]="ValidateIntentReady"}(o||(o={})),function(e){e.Section="Section",e.Control="Control",e.BetweenSections="BetweenSections",e.BetweenControls="BetweenControls"}(s||(s={})),function(e){e.Regular="Regular",e.Vertical="Vertical"}(c||(c={})),function(e){e.BizChat="BizChat",e.KnowledgeAgent="KnowledgeAgent"}(d||(d={})),function(e){e.Control="Control",e.Section="Section",e.MultiSections="MultiSections",e.RegularLayout="RegularLayout",e.Canvas="Canvas"}(l||(l={})),function(e){e.RTE="RTE",e.Control="Control",e.Section="Section"}(u||(u={})),function(e){e.SmartSection="SmartSection",e.FreePromptGeneration="FreePromptGeneration",e.SitePageGeneration="SitePageGeneration",e.TemplateGeneration="TemplateGeneration",e.BizchatHandoff="BizchatHandoff"}(f||(f={})),function(e){e.GPT5="GPT5",e.GPT4_1="GPT4_1"}(p||(p={}));class m{get metadata(){return this.M_}set metadata(e){this.M_=e}constructor(t){e.assign(m,this,t)}static getTypeName(){return"AugLoop_SharepointCopilot_AIPropertiesAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}static typeGuard(t){return e.matchesTypesFor(t,[m.getTypeName()])}}m.H_={T_:m.getTypeName(),B_:m.getBaseTypes()};class _{constructor(t){e.assign(_,this,t)}static getTypeName(){return"AugLoop_Core_ItemDelta"}static getBaseTypes(){return[]}static typeGuard(t){return e.matchesTypesFor(t,[_.getTypeName()])}}_.H_={T_:_.getTypeName(),B_:_.getBaseTypes()};class g{constructor(t){e.assign(g,this,t)}static getTypeName(){return"AugLoop_Core_ItemChangesDelta"}static getBaseTypes(){return["AugLoop_Core_ItemDelta"]}static typeGuard(t){return e.matchesTypesFor(t,[g.getTypeName()])}}g.H_={T_:g.getTypeName(),B_:g.getBaseTypes()};class v{constructor(t){e.assign(v,this,t)}static getTypeName(){return"AugLoop_Core_Operation"}static getBaseTypes(){return[]}static typeGuard(t){return e.matchesTypesFor(t,[v.getTypeName()])}}v.H_={T_:v.getTypeName(),B_:v.getBaseTypes()};class y{constructor(t){e.assign(y,this,t)}static getTypeName(){return"AugLoop_Core_OperationWithSiblingContext"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[y.getTypeName()])}}y.H_={T_:y.getTypeName(),B_:y.getBaseTypes()};class S{constructor(t){e.assign(S,this,t)}static getTypeName(){return"AugLoop_Core_AddOperation"}static getBaseTypes(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[S.getTypeName()])}}S.H_={T_:S.getTypeName(),B_:S.getBaseTypes()};class D{constructor(t){e.assign(D,this,t)}static getTypeName(){return"AugLoop_Core_MoveOperation"}static getBaseTypes(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[D.getTypeName()])}}D.H_={T_:D.getTypeName(),B_:D.getBaseTypes()};class I{constructor(t){e.assign(I,this,t)}static getTypeName(){return"AugLoop_Core_UpdateAnnotationMetaDataOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[I.getTypeName()])}}I.H_={T_:I.getTypeName(),B_:I.getBaseTypes()};class x{constructor(t){e.assign(x,this,t)}static getTypeName(){return"AugLoop_Core_UpdateOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[x.getTypeName()])}}x.H_={T_:x.getTypeName(),B_:x.getBaseTypes()};class C{constructor(t){e.assign(C,this,t)}static getTypeName(){return"AugLoop_Core_DeleteOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[C.getTypeName()])}}C.H_={T_:C.getTypeName(),B_:C.getBaseTypes()};class O{constructor(t){e.assign(O,this,t)}static getTypeName(){return"AugLoop_Core_PurgeOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[O.getTypeName()])}}O.H_={T_:O.getTypeName(),B_:O.getBaseTypes()};class w{constructor(t){e.assign(w,this,t)}static getTypeName(){return"AugLoop_Core_PurgeSubtreeExceptTypesOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[w.getTypeName()])}}w.H_={T_:w.getTypeName(),B_:w.getBaseTypes()};class E{constructor(t){e.assign(E,this,t)}static getTypeName(){return"AugLoop_Core_PurgeByTypesOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[E.getTypeName()])}}E.H_={T_:E.getTypeName(),B_:E.getBaseTypes()};class A{constructor(t){e.assign(A,this,t)}static getTypeName(){return"AugLoop_Core_FocusOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[A.getTypeName()])}}A.H_={T_:A.getTypeName(),B_:A.getBaseTypes()};class L{constructor(t){e.assign(L,this,t)}static getTypeName(){return"AugLoop_Core_VisibilityOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[L.getTypeName()])}}L.H_={T_:L.getTypeName(),B_:L.getBaseTypes()};class k{constructor(t){e.assign(k,this,t)}static getTypeName(){return"AugLoop_Core_DeltaUpdateOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[k.getTypeName()])}}k.H_={T_:k.getTypeName(),B_:k.getBaseTypes()};class M{constructor(t){e.assign(M,this,t)}static getTypeName(){return"AugLoop_Core_MicroSyncOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[M.getTypeName()])}}M.H_={T_:M.getTypeName(),B_:M.getBaseTypes()};class P{constructor(t){e.assign(P,this,t)}static getTypeName(){return"AugLoop_Signals_SignalOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[P.getTypeName()])}}P.H_={T_:P.getTypeName(),B_:P.getBaseTypes()};class T{constructor(t){e.assign(T,this,t)}static getTypeName(){return"AugLoop_Core_CancelSignalTriggeredWorkflowExecutionOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(t){return e.matchesTypesFor(t,[T.getTypeName()])}}T.H_={T_:T.getTypeName(),B_:T.getBaseTypes()};var U,F=h(676),H=h(207),R=h(408);!function(e){e.SmartSection="Smart section",e.CanvasControlDebugToolbar="Canvas control debug toolbar",e.FreePromptGeneration="Free prompt generation",e.BizchatHandoffPageCreation="Bizchat handoff page creation",e.Unknown="Unknown"}(U||(U={}));const N=[];function B(e){const{rowData:t,conversationMetadata:n}=e,a={...t,timestamp:t.timestamp||new Date},i=N.find(e=>e.conversationId===n.conversationId);i?i.rows.push(a):N.push({...n,rows:[a]})}function j(){const e=N.slice();return e.sort((e,t)=>t.rows[0].timestamp.getTime()-e.rows[0].timestamp.getTime()),e}var V;!function(e){e.INVALID_INTENT="INVALID_INTENT",e.SYDNEY_RAI_BLOCKED="SYDNEY_RAI_BLOCKED",e.SYDNEY_REQUEST_BLOCKED="SYDNEY_REQUEST_BLOCKED",e.SYDNEY_USER_THROTTLED_BY_LLM="SYDNEY_USER_THROTTLED_BY_LLM",e.WORKFLOW_TIMEOUT="WORKFLOW_TIMEOUT",e.SCENARIO_MISMATCH="ScenarioMismatch"}(V||(V={}));class z extends Error{logQos(e,t){this.isExpected?e.writeExpectedFailure(this.errorCode,void 0,t):e.writeUnexpectedFailure(this.errorCode,void 0,t);const n="WORKFLOW_TIMEOUT"===this.errorCode?"AIPropertiesWorkflow.TimeoutError":this.isExpected?void 0:"AIPropertiesWorkflow.UnknownError";if(n){const e=new H._QosMonitorShareFailureWithCP(n,!1,[]);this.isExpected?e.writeExpectedFailure(this.errorCode,void 0,t):e.writeUnexpectedFailure(this.errorCode,void 0,t)}}constructor(e,t){super(),this.errorCode=e,this.message=t||e||"",this.isExpected=["INVALID_INTENT","SYDNEY_RAI_BLOCKED","SYDNEY_REQUEST_BLOCKED","SYDNEY_USER_THROTTLED_BY_LLM"].includes(e)}}var G=h(718);function K(e){return G.SPalProxyManager.getAlProxy(e.legacyPageContext,e.listItem?.uniqueId,void 0,["enableGettyImageSearch:true","useIconSubset:true","enableWebSearch:true"])}function W(e){return e.status===o.Success||e.status===o.Error}var q=h(529),Q=h(286),Y=h(232),J=h(560);function X({aiControlResult:e,manifest:t}){const{controlAIPropertiesId:n,controlAIPropertiesData:a,flexibleLayoutPosition:i}=e;let{instanceId:r}=e;r||(r=F.Guid.newGuid().toString());const o=i?{x:i.x,y:i.y,width:i.width,height:i.height}:void 0;if(n===Q.RTE_AI_PROPERTIES_ID)return{instanceId:r,control:{...a,controlType:J.CanvasControlType.RTE},flexibleLayoutPosition:o};if(n===Q.READ_ONLY_WEB_PART_AI_PROPERTIES_ID){const e=a,n=e?.manifestId??t?.id;if(!n)throw new Error("Manifest id missing for read-only web part control.");const i=e?.data_DO_NOT_CHANGE;if(!i||0===i.trim().length)throw new Error("Invalid data format for read-only web part control data. Expecting string.");const s=JSON.parse(i);return{instanceId:r,control:{controlType:J.CanvasControlType.WebPartZone,webPartId:n,webPartData:s},flexibleLayoutPosition:o}}if(!t)throw new Error(`Manifest not provided for web part: ${n}`);const s=(0,Q.getWebPartAIPropertiesSchemaFromManifest)(t);if(!s?.mapping)throw new Error(`Mapping does NOT exist for web part: ${t.alias} - ${t.id}`);const c=(0,Y.mapData)(a,s.mapping,s.control_AI_properties_JSON_schema.dependencies),d=1===t.preconfiguredEntries?.length&&t.preconfiguredEntries[0].properties,l=(0,Q.immutableMerge)(d??{},c);return{instanceId:r,control:{controlType:J.CanvasControlType.WebPartZone,webPartId:t.id,webPartData:{instanceId:r,id:t.id,properties:l,dataVersion:s.control_AI_properties_JSON_schema.dataVersionString,title:""}},flexibleLayoutPosition:o}}function Z(e,t){return{controls:e.controls.map(e=>X({aiControlResult:e,manifest:t.find(t=>t.id===e.controlAIPropertiesId)}))}}function $(e,t){return{id:e.id,layout:e.layout,sectionAlignment:e.alignment,sectionBackground:e.sectionBackground,titleOfCollapsibleSection:e.titleOfCollapsibleSection,sectionEmphasis:e.emphasis,columns:e.columns.map(e=>Z(e,t))}}function ee(e,t){return{sections:e.sections.map(e=>$(e,t))}}function te(e,t){return{controls:e.controls.map(e=>X({aiControlResult:e,manifest:t.find(t=>t.id===e.controlAIPropertiesId)}))}}function ne(e,t){return{regularLayout:ee(e.regularLayout,t),verticalLayout:e.verticalLayout?te(e.verticalLayout,t):void 0}}var ae,ie,re,oe,se=h(707);function ce(e){const t=(0,Q.mapRawToFlexibleLayoutPosition)(e.flexibleLayoutPosition);return{...e.control,id:e.instanceId,addedFromPersistedData:!0,...t&&{flexibleLayoutPosition:t}}}function de(e,t){return(0,Q.immutableMerge)(t,ce(e))}function le(e,t){return 0===e.controls.length?[(0,Q.immutableMerge)(t,{controlType:J.CanvasControlType.Empty,id:"emptySection",position:{controlIndex:1}})]:e.controls.map((e,n)=>(0,Q.immutableMerge)(de(e,t),{position:{controlIndex:n+1}}))}function ue(){return F._SPKillSwitch.isActivated("8f3f3e2b-1f4e-4c4d-9c6d-5e2b7e6f4a1c")}function fe(){return F._SPKillSwitch.isActivated("68436f65-99d5-4ba1-96fc-9921bc96a06f")}!function(e){e.LoopingVideos="32318599-a475-448c-a583-7aadf5e41c8c",e.Icons="f9a6197b-243d-4381-ad7d-43250cb11014",e.Illustrations="5c594da3-1700-4c4e-824b-dbefe528f53b",e.CartoonPeople="71309e27-d6ab-4fa5-865c-60d4e6d863b3",e.Images="f8218404-63dd-4670-b0f5-f8b50674f963",e.AiGeneratedImages="60f8b9be-536b-4a0f-9552-f3321c243f86",e.CutoutPeople="42fea961-805e-4900-a0f5-7288c55d7780",e.Stickers="0678df82-d05e-475d-9c04-5daa1f5c6d55",e.Annotations="0b60f44c-a895-4414-ab8f-6f62b5de973c",e.Shapes="9409ec95-a250-402e-8609-319208802c02",e.Emojis="84e04d41-3574-4764-a2d3-c24ae80c75eb",e.Audios="72b42841-c22c-44fd-9ac3-964371503269",e.SFX="dbddd5cf-9502-42f3-bee8-9ad41a2b6ff8",e.Overlays="c4d5cd5-eaf3-47da-8b3c-0a6bced0fe71",e.Filters="9e3db81f-2412-4606-88a7-18902fae34a6",e.Transitions="0629c8e7-8f4c-4138-bf04-816285391431",e.ClipchampIcons="01234567-89ab-cdef-0123-456789abcdef",e.Backgrounds="12345678-90ab-cdef-1234-567890abcdef",e.ClipchampStickers="f3e2d1c0-b9a8-7654-3210-fedcba987654",e.ClipchampAnnotations="456789ab-cdef-0123-4567-89abcdef0123",e.ClipchampShapes="98765432-10fe-dcba-9876-543210fedcba",e.Frames="0fedcba9-8765-4321-0abc-def123456789"}(ae||(ae={})),function(e){e.Icon="Icon",e.Image="Image",e.Video="Video",e.Audio="Audio",e.Collection="Collection",e.PowerpointTemplate="PowerpointTemplate",e.WordTemplate="WordTemplate",e.ClipchampTemplate="ClipchampTemplate",e.PromptTemplate="PromptTemplate",e.Folder="Folder"}(ie||(ie={})),function(e){e.My="My",e.Stock="Stock",e.Enterprise="Enterprise",e.External="External",e.Clipchamp="Clipchamp",e.Brand="Brand",e.Cit="Cit"}(re||(re={})),function(e){e.Bing="Bing",e.Getty="Getty",e.GettyVideo="GettyVideo",e.Giphy="Giphy",e.GooglePhotos="GooglePhotos",e.Hubble="Hubble",e.OneDrivePhotos="OneDrivePhotos",e.Shutterstock="Shutterstock",e.StockImages="StockImagesSearch",e.Storyblocks="Storyblocks",e.TAS="TAS",e.TasFirstPartyImageSearch="TasFirstPartyImageSearch",e.Tenor="Tenor",e.Cit="Cit",e.Unknown="Unknown",e.BrandKit="BrandKit",e.OAL="OAL",e.Templafy="Templafy",e.AdobeExpManager="AdobeExpManager"}(oe||(oe={}));const pe=H._LogSource.create("from_AISPImageResult_to_SectionBackgroundData");function me(e){try{const t=e?.image,n=fe()?!e?.useLightText:void 0===e?.useLightText,a=fe()?e?.useLightText:!!e?.useLightText;if(!e||!(0,Q.isAIImageReadyData)(t))return;return!e.overlay||n?void H._TraceLogger.logError(pe,new Error("Background data ignored due to missing overlay or useLightText in sectionBackground")):{type:"image",imageData:{source:J.ImageSource.Hubble,url:t.urlOrBlob,width:t.width,height:t.height,fileName:t.fileName??"",contentProvider:t.contentProvider||oe.Unknown,stockMediaId:t.stockMediaId,insertionISOTimestamp:t.insertionISOTimestamp},overlay:e.overlay,useLightText:a}}catch(e){return void H._TraceLogger.logError(pe,e)}}var _e=h(631);function he(){return F._SPKillSwitch.isActivated("d9e388b0-5c12-4981-816d-c65ce6badb69")}function be(){return F._SPKillSwitch.isActivated("d342a23a-e656-47fc-8a4d-93138b3e39e5")}const ge=H._LogSource.create("backgroundImageClientProcessor");async function ve(e){const t=await ye(e.regularLayout);return{...e,regularLayout:t}}async function ye(e){if(!e.sections.length)return e;const t=await Promise.all(e.sections.map(e=>Se(e)));return{...e,sections:t}}async function Se(e){const{sectionBackground:t}=e,n=t?.image;if(!(0,Q.isAIImageReadyData)(n))return e;if(De(t))return e;const a=new H._QosMonitor("AIProperties.fromAISPImageResultToBackgroundData");try{const i={source:J.ImageSource.Hubble,url:n.urlOrBlob,width:n.width,height:n.height,fileName:n.fileName||"",contentProvider:n.contentProvider||oe.Unknown,stockMediaId:n.stockMediaId,insertionISOTimestamp:n.insertionISOTimestamp},r=await async function(e,t){const n=(0,_e.getZoneBgImageThumbnailUrl)(e,400);return new Promise((e,a)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=()=>{(0,se.getRecommendOverlayAndOpacity)(i).then(t=>{e(t)}).catch(e=>{a(e)})},i.onerror=e=>{a(e),be()||t.writeUnexpectedFailure(void 0,new Error("Failed to load image for background processing"))},i.src=n})}(i,a);return function(e,t){be()||(void 0===t.overlay?e.writeUnexpectedFailure("NoOverlayRecommendation"):void 0===t.useLightText?e.writeUnexpectedFailure("NoLightTextRecommendation"):e.writeSuccess())}(a,r),{...e,sectionBackground:{...t,...r}}}catch(t){return H._TraceLogger.logError(ge,t),a.writeUnexpectedFailure(void 0,t),e}}function De(e){if(!e)return!1;const t=e;return void 0!==t.overlay&&void 0!==t.useLightText}async function Ie(e,t){return xe(e=await Se(e),t)}function xe(e,t){const n=[];let a;const i=(0,Q.getSectionFactorsFromLayoutType)(e.layout);let r;he()||(r=new H._QosMonitor("fromAISectionRawDataToCanvasContent")),0===e.columns.length&&e.columns.push({controls:[]});for(let o=0;o<e.columns.length;o++){const s=e.columns[o],c=(0,Q.immutableMerge)(t,{position:{zoneId:e.id,sectionFactor:i[o]??12,sectionIndex:o+1},...e.sectionEmphasis&&{emphasis:{zoneEmphasis:J.SPVariantThemeType[e.sectionEmphasis]}},zoneGroupMetadata:{...e.sectionAlignment&&{alignment:J.ZoneGroupAlignment[e.sectionAlignment]},...e.titleOfCollapsibleSection&&{type:J.CanvasGroupType.Accordion,displayName:e.titleOfCollapsibleSection,isTitleEnabled:!0}}});if(n.push(...le(s,c)),e.sectionBackground&&!De(e.sectionBackground)){if(he()||!r)throw new Error("sectionBackground must be processed by backgroundImageClientProcessor first.");r.extraData={overlay:e.sectionBackground.overlay,useLightText:e.sectionBackground.useLightText},r.writeUnexpectedFailure("UnprocessedSectionBackground"),e.sectionBackground=void 0}const d=me(e.sectionBackground);d&&(a={zoneBackground:{[e.id]:d}})}return he()||!r||r.hasEnded||r.writeSuccess(),{controls:n,canvasExtraData:a&&(0,se.createCanvasExtraDataControl)(a)}}async function Ce(e,t={}){return Oe(e=await ye(e),t)}function Oe(e,t={}){const n=[];let a;return e.sections.map((e,n)=>xe(e,(0,Q.immutableMerge)(t,{position:{layoutIndex:J.firstLayoutIndex,zoneIndex:n+1}}))).forEach(e=>{const{controls:t,canvasExtraData:i}=e;n.push(...t),a?i&&(a=(0,Q.immutableMerge)(a,i)):a=i}),{controls:n,canvasExtraData:a}}function we(e,t={}){const n=[];return e.controls.forEach(e=>{const a=de(e,(0,Q.immutableMerge)(t,{position:{layoutIndex:J.verticalLayoutIndex}}));n.push(a)}),n}async function Ee(e){return Ae(e=await ve(e))}function Ae(e){const{controls:t,canvasExtraData:n}=Oe(e.regularLayout);return{controls:[...t,...e.verticalLayout?we(e.verticalLayout):[]],canvasExtraData:n}}const Le={rteHTML:/^(?:(regularLayout)\.sections\[(\d+)\]\.columns\[(\d+)\]\.controls\[(\d+)\].*\.innerHTML|(verticalLayout)\.controls\[(\d+)\].*\.innerHTML)$/,control:/^(?:(regularLayout)\.sections\[(\d+)\]\.columns\[(\d+)\]\.controls\[(\d+)\]|(verticalLayout)\.controls\[(\d+)\])$/,sectionProperty:/^(regularLayout)\.sections\[(\d+)\]\.(layout|emphasis|alignment)$/,section:/^(regularLayout)\.sections\[(\d+)\]$/};class ke{getSectionId(e){const t=`${e.canvas}-${e.sectionsIndex??""}`;if(this._instanceIdMap.has(t))return this._instanceIdMap.get(t)||"";const n=F.Guid.newGuid().toString();return this._instanceIdMap.set(t,n),n}getControlId(e){const t=`${e.canvas}-${e.sectionsIndex??""}-${e.columnsIndex??""}-${e.controlsIndex??""}`;if(this._instanceIdMap.has(t))return this._instanceIdMap.get(t)||"";const n=F.Guid.newGuid().toString();return this._instanceIdMap.set(t,n),n}constructor(){this._instanceIdMap=new Map}}class Me{async updateCanvasContent(){const e=ne(this._data,this._manifests);this._canvasContent=await Ee(e),F._SPKillSwitch.isActivated("a480321d-7814-4bbe-9123-3da92c82f22b")||this._callbacks.onUpdateCanvasContent?.(this._canvasContent)}async addStreamData(e){const t=((e,t)=>{const n=function(e,t){if(!t)return e;if(/^(regularLayout|verticalLayout)\./.test(e))return e;switch(t){default:return e;case"RegularLayout":case"MultiSections":return`regularLayout.${e}`;case"Section":return`regularLayout.sections[0].${e}`;case"Control":return`regularLayout.sections[0].columns[0].controls[0].${e}`}}(e,this._level),a=Le.rteHTML.exec(n);if(a){if("regularLayout"===a[1])return{canvas:"regularLayout",sectionsIndex:parseInt(a[2],10),columnsIndex:parseInt(a[3],10),controlsIndex:parseInt(a[4],10),type:"rteHTML"};if("verticalLayout"===a[5])return{canvas:"verticalLayout",sectionsIndex:void 0,columnsIndex:void 0,controlsIndex:parseInt(a[6],10),type:"rteHTML"}}const i=Le.control.exec(n);if(i){if("regularLayout"===i[1])return{canvas:"regularLayout",sectionsIndex:parseInt(i[2],10),columnsIndex:parseInt(i[3],10),controlsIndex:parseInt(i[4],10),type:"control"};if("verticalLayout"===i[5])return{canvas:"verticalLayout",sectionsIndex:void 0,columnsIndex:void 0,controlsIndex:parseInt(i[6],10),type:"control"}}const r=Le.sectionProperty.exec(n);if(r)return{canvas:"regularLayout",sectionsIndex:parseInt(r[2],10),columnsIndex:void 0,controlsIndex:void 0,type:"sectionProperty"};const o=Le.section.exec(n);return o?{canvas:"regularLayout",sectionsIndex:parseInt(o[2],10),columnsIndex:void 0,controlsIndex:void 0,type:"section"}:void 0})(e.key);if(!t)throw new Error(`Failed to parse streaming key: ${e.key}`);switch(await this._ensureObjectExisted(t),t.type){case"rteHTML":this._handleRTEHTMLUpdate(t,e);break;case"control":this._handleControlUpdate(t,e);break;case"section":await this._handleSectionUpdate(t,e);break;case"sectionProperty":await this._handleSectionPropertyUpdate(t,e)}await this.updateCanvasContent();const n=this._keyInstanceIdBuilder.getSectionId({canvas:t.canvas,sectionsIndex:t.sectionsIndex,type:"section"});switch(t.type){case"rteHTML":case"control":case"sectionProperty":case"section":{const a=this._canvasContent?.controls.filter(e=>e.position?.zoneId===n);if(a?.forEach(e=>{e.id=this._keyInstanceIdBuilder.getControlId({canvas:t.canvas,sectionsIndex:t.sectionsIndex,controlsIndex:e.position.controlIndex||-1,columnsIndex:e.position.sectionIndex||-1,type:"control"})}),!a)throw new Error(`Section with index ${t.sectionsIndex} not found after update for key: ${e.key}`);a.length>0&&a.some(J.isWebPartOrRte)&&this._callbacks.onUpdateSection?.(a,this._canvasContent?.canvasExtraData);break}}}async _ensureObjectExisted(e){if("verticalLayout"===e.canvas&&(this._data.verticalLayout=this._currentVerticalLayout),"number"==typeof e.sectionsIndex){for(;this._currentRegularLayout.sections.length<=e.sectionsIndex;){const t={id:this._keyInstanceIdBuilder.getSectionId(e),layout:"oneColumn",columns:[],emphasis:"None",alignment:"Top"};this._currentRegularLayout.sections.push(t)}this._currentSection=this._currentRegularLayout.sections[e.sectionsIndex]}if("number"==typeof e.columnsIndex&&e.columnsIndex>=0)for(;this._currentSection.columns.length<=e.columnsIndex;)this._currentSection.columns.push({controls:[]});if("number"==typeof e.controlsIndex&&e.controlsIndex>=0)if("verticalLayout"===e.canvas){for(;this._currentVerticalLayout.controls.length<=e.controlsIndex;)this._currentVerticalLayout.controls.push({instanceId:this._keyInstanceIdBuilder.getControlId(e),controlAIPropertiesId:"",controlAIPropertiesData:{}});this._currentControl=this._currentVerticalLayout.controls[e.controlsIndex]}else{if(void 0===e.columnsIndex)throw new Error(`Missing columnsIndex for regularLayout control at key: ${e}`);{const t=this._currentSection.columns[e.columnsIndex];for(;t.controls.length<=e.controlsIndex;)t.controls.push({instanceId:this._keyInstanceIdBuilder.getControlId(e),controlAIPropertiesId:"",controlAIPropertiesData:{}});this._currentControl=t.controls[e.controlsIndex]}}}_handleRTEHTMLUpdate(e,t){if(!this._currentControl)throw new Error(`RTE HTML update received before control was initialized at key: ${t.key}`);this._currentControl.controlAIPropertiesId="SP_RTE",this._currentControl.controlAIPropertiesData={...this._currentControl.controlAIPropertiesData,innerHTML:t.value}}_handleControlUpdate(e,t){if(!this._currentControl)throw new Error(`Control update received before control was initialized at key: ${t.key}`);const n=t.value;(0,q.merge)(this._currentControl,n),this._currentControl.instanceId=this._keyInstanceIdBuilder.getControlId(e)}async _handleSectionUpdate(e,t){if(!this._currentSection)throw new Error(`Section update received before section was initialized at key: ${t.key}`);const n=t.value;(0,q.merge)(this._currentSection,n),this._currentSection.id=this._keyInstanceIdBuilder.getSectionId(e)}async _handleSectionPropertyUpdate(e,t){if(!this._currentSection)throw new Error(`Section update received before section was initialized at key: ${t.key}`);const n=t.value,a=this._currentSection;switch(this._currentSection.id=this._keyInstanceIdBuilder.getSectionId(e),t.key.split(".").pop()){case"layout":a.layout=n;break;case"emphasis":a.emphasis=n;break;case"alignment":a.alignment=n}}constructor(e,t,n){this._keyInstanceIdBuilder=new ke,this._currentRegularLayout={sections:[]},this._currentVerticalLayout={controls:[]},this._canvasContent={controls:[]},this._callbacks=e,this._manifests=t.map(e=>JSON.parse(e)),this._currentRegularLayout={sections:[]},this._data={regularLayout:this._currentRegularLayout},this._level=n}}var Pe=h(909),Te=h(414);function Ue(e){return e.consume(R.PageContext.serviceKey).web.absoluteUrl}const Fe="a572f711-58d9-473f-a827-ac3ffd529516",He="1fdd612d-8dda-47de-8dc1-23f90527cc92",Re="20745d7d-8581-4a6c-bf26-68279bc123fc",Ne="2161a1c6-db61-4731-b97c-3cdb303f7cbb",Be="62cac389-787f-495d-beca-e11786162ef4",je="7f718435-ee4d-431c-bdbf-9c4ff326f46e",Ve="8654b779-4886-46d4-8ffb-b5ed960ee986",ze="8c88f208-6c77-4bdb-86a0-0c47b4316588",Ge="aebfc87c-c62d-4f2e-8ee4-9a4c4bbb627e",Ke="ac0e47ca-30af-452c-bdbb-510b715d0e46",We="c4bd7b2f-7b6e-4599-8485-16504575f590",qe="c70391ea-0b10-4ee9-b2b4-006d3fcad0cd",Qe="cbe7b0a9-3504-44dd-a3a3-0e5cacd07788",Ye="df8e44e7-edd5-46d5-90da-aca1539313b8",Je="fe2f2812-4df0-42c7-ae2e-2db57e092751",Xe=new Set([Fe,Re,Ne,Be,je,Ve,ze,Ge,Ke,We,qe,Qe,Ye,Je,He]),Ze=new Set([Fe,Re,Ne,Be,je,Ve,ze,Ke,qe,Qe,We,Ye,Je,He]);function $e(e,t){const n=t?new Set(t):Xe;return e.filter(e=>!!e.experimentalData?.aiProperties&&n.has(e.id))}const et="FetchedWebPartManifestsWithAIProperties";class tt{static getInstance(e){return tt._instance||(tt._instance=new tt(e)),tt._instance}async getWebPartManifestsForAIProperties(e){const t=this._getValidCachedData();if(t)try{const n=t.map(e=>JSON.parse(e)),a=this._tryGetListManifest(),i=a&&!n.some(e=>e.id===a.id)?[...n,a]:n,r=$e(this._mergeWithRegisteredManifests(i),e),o=this._ensureListManifestPresence(r,a);return this._setCachedData(o.map(e=>JSON.stringify(e))),o}catch{}const n=new Te._ManifestProvider(this._serviceScope,Ue(this._serviceScope)).tryGetManifest(Fe),a=this._serviceScope.consume(Pe.SPHttpClient.serviceKey),i=await a.post(Ue(this._serviceScope)+"/_api/web/GetClientSideComponentsByComponentType(componentTypesString='1', includeManifestActivatedTime=true)",Pe.SPHttpClient.configurations.v1,{body:JSON.stringify({project:F.Session.clientSideApplicationId}),headers:{"x-odsp-web-version":Te._ManifestStore.instance.buildNumber}});if(!i.ok)throw new Error(`Failed to get web part manifests. Status: ${i.status}`);const r=(await i.json()).value.map(e=>JSON.parse(e.Manifest)),o=await n,s=this._tryGetListManifest(o),c=s&&!r.some(e=>e.id===s.id)?[...r,s]:r,d=$e(this._mergeWithRegisteredManifests(c),e);return s&&!d.some(e=>e.id===s.id)&&d.push(s),this._setCachedData(d.map(e=>JSON.stringify(e))),d}async getWebPartManifestStringsForAIProperties(e){return this._getValidCachedData()||(await this.getWebPartManifestsForAIProperties(e)).map(e=>JSON.stringify(e))}_setCachedData(e){try{const t={data:e,timestamp:Date.now()};localStorage.setItem(et,JSON.stringify(t))}catch(e){}}_getValidCachedData(){try{const e=localStorage.getItem(et);if(!e)return null;const t=JSON.parse(e);return Date.now()-t.timestamp>=36e5?null:t.data}catch{return null}}_mergeWithRegisteredManifests(e){const t=new Map,n=e=>{if("WebPart"!==e.componentType)return;const n=t.get(e.id);t.set(e.id,this._preferManifest(n,e))};for(const e of this._getRegisteredWebPartManifests())n(e);for(const t of e)n(t);return Array.from(t.values())}_getRegisteredWebPartManifests(){return Te._ManifestStore.instance.getRegisteredManifests().filter(e=>"WebPart"===e.componentType).map(e=>e)}_ensureListManifestPresence(e,t){return t&&"WebPart"===t.componentType&&!e.some(e=>e.id===t.id)?[...e,t]:e}_tryGetListManifest(e){const t=Te._ManifestStore.instance.tryGetManifest(Fe),n=t&&"WebPart"===t.componentType?t:void 0;let a;if(e){const t=e.find(e=>e.id===Fe&&"WebPart"===e.componentType);t&&(a=t)}return n&&a?this._preferManifest(n,a):n||a}_preferManifest(e,t){if(!e)return t;const n=this._isDebugManifest(e),a=this._isDebugManifest(t);return n&&!a?e:!n&&a?t:e}_isDebugManifest(e){return Boolean(e._isDebug)}constructor(e){this._serviceScope=e}}async function nt(e,t){return{...e,debugWebPartManifests:e.debugWebPartManifests??await(async()=>{const n=tt.getInstance(t);return await n.getWebPartManifestStringsForAIProperties(e.allowedManifestIds)})()}}const at=H._LogSource.create("AIPropertiesWorkflowExecutor"),it=3e5;class rt{async createAIProperties(e){const{featureInstanceId:t,featureName:a,dataReadyCallback:i,validationReadyCallback:o,abortSignal:s,streamingCallbacks:c={}}=e,d=await nt(e.request,this._serviceScope);!function(e){const{pageContextAround:t,serviceConfig:n}=e;if(t?.pageData){let e;try{e=JSON.parse(t.pageData)}catch(e){throw new Error("Invalid pageData, it must be a valid JSON string")}if(!(0,Q.isAIPageData)(e))throw new Error("Invalid pageData, it must be type of IAIPageData")}if(n){let e;try{e=JSON.parse(n)}catch(e){throw new Error("Invalid serviceConfig, it must be a valid JSON string")}if(!e.serviceType)throw new Error("Invalid serviceConfig, it must have a valid serviceType")}}(d);const l=await this._runTask({signal:new n(d),scenario:r.Creation,qosName:"AIPropertiesWorkflow.Create",dataReadyCallback:async e=>{if(i)return i(e)},validationReadyCallback:o?async(e,n)=>{if(!ue()&&n&&e?.intent&&B({conversationMetadata:{conversationId:n,feature:a||U.Unknown,featureInstanceId:t},rowData:{description:`intent: ${e.intent}`}}),o)return o(e,n)}:void 0,abortSignal:s,timeoutInMs:it,streamingCallbacks:c}),{conversationId:u}=l;return u&&B({conversationMetadata:{conversationId:u,feature:a||U.Unknown,featureInstanceId:t},rowData:{description:`create_AI-properties - ${d.userPrompt?d.userPrompt:"<empty user prompt>"}`}}),l}async evaluateAIProperties(e){const t=new i({userPrompt:e.userPrompt,serviceConfig:"",debugWebPartManifests:[],language:"en-US",level:l.Canvas,sitePath:e.sitePath,content:e.content});return await nt(t,this._serviceScope),this._runTask({signal:t,scenario:r.Evaluation,qosName:"AIPropertiesWorkflow.Evaluate",dataReadyCallback:async e=>{},abortSignal:e.aboartSignal,timeoutInMs:it,streamingCallbacks:{}})}async _runTask({signal:e,scenario:t,qosName:n,dataReadyCallback:a,validationReadyCallback:i,abortSignal:r,timeoutInMs:s,streamingCallbacks:c}){const d=new H._QosMonitor(n),l=(this._operationCounter++).toString(),u=new P({parentPath:this._workflowMessagePath,items:[{id:l,body:e}]}),f=await this._alProxyPromise,p=await f.getAugloopSession();p.submitOperation(u);const m=()=>({augLoopSessionKey:f.getAugloopSessionKey(),workflowExecutorInstanceId:this._executorInstanceId,isAugloopSessionConnected:p.isConnected,isAugloopSessionClosed:p.isClosed});return new Promise((n,u)=>{const f=setTimeout(()=>{const e=new z(V.WORKFLOW_TIMEOUT);this._responseCallbacks.has(l)&&this._responseCallbacks.set(l,e=>{W(e)&&new H._QosMonitor(d.name+".TimeoutDataReturned").writeExpectedFailure("TimeoutDataReturned",void 0,m())}),e.logQos(d,m()),u(e)},s);let p,_;const h=()=>{clearTimeout(f),this._responseCallbacks.delete(l),d.writeExpectedFailure("Aborted",void 0,m()),u(new Error("Operation aborted"))};if(r?.aborted)return void h();const b=e.streaming?new Me(c,e.debugWebPartManifests,e.level):void 0;r?.addEventListener("abort",h);const g=e=>{clearTimeout(f),e&&(p=a(e))};this._responseCallbacks.set(l,async e=>{try{if(e.scenario!==t){const e=new z(V.SCENARIO_MISMATCH);throw e.logQos(d,m()),H._TraceLogger.logError(at,e),e}if(e.status===o.ValidateIntentReady&&(a=JSON.parse(e.data),s=ue()?void 0:e.conversationId,i&&(_=i(a,s))),b&&e.status===o.Streaming){const t=JSON.parse(e.data);await b.addStreamData(t)}if(e.status===o.DataReady){const t=JSON.parse(e.data);g(t)}if(e.status===o.Error||e.status===o.Success){const{conversationId:a}=e,i={...m(),conversationId:a,scenario:t};if(e.status===o.Error){const t=new z(e.error);throw t.logQos(d,i),H._TraceLogger.logError(at,t),t}if(!e.data){const e=new z("No data returned");throw e.logQos(d,i),H._TraceLogger.logError(at,e),e}const r=JSON.parse(e.data);p||g(r),await Promise.all([p,_].filter(Boolean)),d.writeSuccess(i),n(r)}}catch(e){H._TraceLogger.logError(at,e,"Error handling annotation",e),u(e)}finally{r?.removeEventListener("abort",h)}var a,s})})}async _ensureAlProxyPromise(e){let t=e.alProxyPromise||rt._defaultAlProxyPromise;const{serviceScope:n}=e,a=n.consume(R.PageContext.serviceKey);let i;t||(rt._defaultAlProxyPromise=K(a),t=rt._defaultAlProxyPromise);try{i=await t}catch(e){H._TraceLogger.logError(at,e,"Error initializing AlProxy",e),rt._defaultAlProxyPromise=K(a),t=rt._defaultAlProxyPromise,i=await t}return await this._activateAnnotation(i),i}async _activateAnnotation(e){const t=await e.getAugloopSession();await t.activateAnnotation(m.getTypeName(),{callback:this._handleAnnotationCallback})}constructor(e){this._responseCallbacks=new Map,this._executorInstanceId=F.Guid.newGuid().toString(),this._workflowMessagePath=["session",this._executorInstanceId],this._operationCounter=0,this._handleAnnotationCallback=e=>{if(function(e,t){if(e.length<t.length)return!1;for(let n=0;n<t.length;n++)if(e[n]!==t[n])return!1;return!0}(e.parentPath,this._workflowMessagePath))for(const t of e.items){const n=e.parentPath[e.parentPath.length-1],a=this._responseCallbacks.get(n);a&&(a(t.body),W(t.body)&&this._responseCallbacks.delete(n))}},this._serviceScope=e.serviceScope,this._alProxyPromise=this._ensureAlProxyPromise(e)}}var ot,st,ct;function dt(e){return JSON.stringify(e)}function lt(e,t){return{pageDescription:e.pageDescription,canvas:ne(e.canvas,t)}}!function(e){e.Valid="Valid",e.Invalid="Invalid",e.Partial="Partial"}(ot||(ot={})),function(e){e.Text="Text",e.WebPart="WebPart",e.Layout="Layout",e.Image="Image",e.Content="Content",e.CurrentPage="CurrentPage",e.DocumentLibrary="Document library"}(st||(st={})),function(e){e.ContentGeneration="Content generation",e.DirectGrounding="Direct grounding",e.IndirectGrounding="Indirect grounding",e.Generic="Generic",e.IrrelevantRequest="Irrelevant request"}(ct||(ct={}));var ut=h(642);function ft({webPartData:e,manifest:t}){const n=(0,Q.getWebPartAIPropertiesSchemaFromManifest)(t);if(!n||!n.propertiesMetadataForReInstate)throw new Error("Manifest does not contain propertiesMetadataForReInstate in experimentalData.");return(0,ut._reInstateServerProcessedData)({deserializedProperties:e.properties,serverProcessedContent:e.serverProcessedContent,renderedFromPersistedData:!0,propertiesMetadata:n.propertiesMetadataForReInstate,manifest:t})}function pt({webPartProperties:e,manifest:t}){const n=(0,Q.getWebPartAIPropertiesSchemaFromManifest)(t);if(n?.mapping)return(0,Y.reverseMapData)(e,n.mapping,n.control_AI_properties_JSON_schema.dependencies);throw new Error(`Mapping does NOT exist for web part: ${t.alias} - ${t.id}`)}const mt=(e,t)=>({manifestId:e,data_DO_NOT_CHANGE:JSON.stringify(t)});function _t(e){try{return bt(e)}catch(e){throw Y._AIPropertiesLogger.error(e),e}}function ht(e){try{return bt(e)}catch(e){throw Y._AIPropertiesLogger.error(e),e}}function bt({rawControlData:e,webPartManifests:t}){const{control:n}=e,a=e.flexibleLayoutPosition?{x:e.flexibleLayoutPosition.x,y:e.flexibleLayoutPosition.y,width:e.flexibleLayoutPosition.width,height:e.flexibleLayoutPosition.height}:void 0;let i;if((0,Q.isAIControlDataRawRTE)(n))return{instanceId:e.instanceId,controlAIPropertiesId:Q.RTE_AI_PROPERTIES_ID,controlAIPropertiesData:{innerHTML:n.innerHTML},flexibleLayoutPosition:a};if((0,Q.isAIControlDataRawWebPart)(n)){const r=function(e){switch(e){case"d1d91016-032f-456d-98a4-721247c305e8":return"fe2f2812-4df0-42c7-ae2e-2db57e092751";case"f92bf067-bc19-489e-a556-7fe95f508720":return"a572f711-58d9-473f-a827-ac3ffd529516";default:return e}}(n.webPartId),o=t.find(e=>e.id===r),s=(0,Q.getWebPartAIPropertiesSchemaFromManifest)(o);if(!o||!s){const{webPartData:t}=n;return{instanceId:e.instanceId,controlAIPropertiesId:Q.READ_ONLY_WEB_PART_AI_PROPERTIES_ID,controlAIPropertiesData:mt(t.id,t)}}return i=pt({webPartProperties:ft({webPartData:n.webPartData,manifest:o}),manifest:o}),{instanceId:e.instanceId,controlAIPropertiesId:s.control_AI_properties_id,controlAIPropertiesData:i,flexibleLayoutPosition:a}}throw new Error(`Unrecognized control type ${n.controlType}`)}function gt({rawPageData:e,webPartManifests:t}){const n={pageDescription:e.pageDescription,canvas:{regularLayout:{sections:e.canvas.regularLayout.sections.map(e=>({...e,columns:e.columns.map(e=>({...e,controls:e.controls.map(e=>ht({rawControlData:e,webPartManifests:t}))}))}))}}};return e.canvas.verticalLayout&&(n.canvas.verticalLayout={controls:e.canvas.verticalLayout.controls.map(e=>ht({rawControlData:e,webPartManifests:t}))}),n}var vt,yt=h(959),St=h.n(yt);function Dt(e,t){const n=St().useRef(!1);t&&(n.current=!0);const a=St().useRef();return n.current&&!a.current&&(a.current=new rt({serviceScope:e})),a}!function(e){e.SmartSection="SmartSection",e.FreePromptGeneration="FreePromptGeneration",e.SitePageGeneration="SitePageGeneration",e.TemplateGeneration="TemplateGeneration",e.BizchatHandoff="BizchatHandoff"}(vt||(vt={}));class It{setLogCallback(e){this._logCallback=e}setUpdateLoggingExtraDataCallback(e){this._updateExtraDataForLoggingGloballyCallback=e}logEngagementData(e,t){this._logCallback&&this._logCallback(e,t)}updateExtraDataForLoggingGlobally(e){this._updateExtraDataForLoggingGloballyCallback&&this._updateExtraDataForLoggingGloballyCallback(e)}}It.serviceKey=F.ServiceKey.create("sp-ai-properties-tools-internal:AIPropertiesEngagementService",It)})(),b})());