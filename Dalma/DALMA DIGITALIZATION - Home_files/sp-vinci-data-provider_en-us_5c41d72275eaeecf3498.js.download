(()=>{var e=document.currentScript;define("2cdb4565-e56e-4712-b913-b4a8c0e5e76c_0.1.0",["@microsoft/sp-core-library","@msinternal/odsp-utilities-bundle","@msinternal/sp-vinci-telemetry-sdk","@microsoft/sp-http","@microsoft/sp-page-context","@microsoft/sp-http-base","@msinternal/odsp-core-bundle","@msinternal/sp-component-utilities","@microsoft/sp-diagnostics"],(t,n,a,i,r,o,s,c,d)=>(()=>{"use strict";var l={676:e=>{e.exports=t},207:e=>{e.exports=d},909:e=>{e.exports=i},737:e=>{e.exports=o},408:e=>{e.exports=r},277:e=>{e.exports=s},810:e=>{e.exports=n},718:e=>{e.exports=c},38:e=>{e.exports=a}},u={};function f(e){var t=u[e];if(void 0!==t)return t.exports;var n=u[e]={exports:{}};return l[e](n,n.exports,f),n.exports}f.m=l;var p,m,_,h={"102":"z5TIeY0HiDVsyjirIuieWoM3l6XZLZTr4WNVmAEgTSc="};f.d=(e,t)=>{for(var n in t)f.o(t,n)&&!f.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},f.f={},f.e=e=>Promise.all(Object.keys(f.f).reduce((t,n)=>(f.f[n](e,t),t),[])),f.u=e=>"chunk.xlsx_none_b736c3e196510e71c4c1.js",f.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),p={},m="2cdb4565-e56e-4712-b913-b4a8c0e5e76c_0.1.0:",f.l=(e,t,n,a)=>{if(p[e])p[e].push(t);else{var i,r;if(void 0!==n)for(var o=document.getElementsByTagName("script"),s=0;s<o.length;s++){var c=o[s];if(c.getAttribute("src")==e||c.getAttribute("data-webpack")==m+n){i=c;break}}if(!i){r=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,f.nc&&i.setAttribute("nonce",f.nc),i.setAttribute("data-webpack",m+n),i.src=e,0!==i.src.indexOf(window.location.origin+"/")&&(i.crossOrigin="anonymous");var d=function(e){return"sha256-"+(h[e]||"Missing+Integrity+Hash+For+Script+Aborting=")}(a);d&&(i.integrity=d)}p[e]=[t];var l=(t,n)=>{i.onerror=i.onload=null,clearTimeout(u);var a=p[e];if(delete p[e],i.parentNode&&i.parentNode.removeChild(i),a&&a.forEach(e=>e(n)),t)return t(n)},u=setTimeout(l.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=l.bind(null,i.onerror),i.onload=l.bind(null,i.onload),r&&document.head.appendChild(i)}},f.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},_=e?e.src:"",f.p=_.slice(0,_.lastIndexOf("/")+1),(()=>{var e={623:0};f.f.j=(t,n)=>{var a=f.o(e,t)?e[t]:void 0;if(0!==a)if(a)n.push(a[2]);else{var i=new Promise((n,i)=>a=e[t]=[n,i]);n.push(a[2]=i);var r=f.p+f.u(t),o=new Error;f.l(r,n=>{if(f.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var i=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.src;o.message="Loading chunk "+t+" failed.\n("+i+": "+r+")",o.name="ChunkLoadError",o.type=i,o.request=r,a[1](o)}},"chunk-"+t,t)}};var t=(t,n)=>{var a,i,[r,o,s]=n,c=0;if(r.some(t=>0!==e[t])){for(a in o)f.o(o,a)&&(f.m[a]=o[a]);s&&s(f)}for(t&&t(n);c<r.length;c++)i=r[c],f.o(e,i)&&e[i]&&e[i][0](),e[i]=0},n=self["webpackJsonp_2cdb4565-e56e-4712-b913-b4a8c0e5e76c_0.1.0"]=self["webpackJsonp_2cdb4565-e56e-4712-b913-b4a8c0e5e76c_0.1.0"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var b={};return(()=>{f.r(b),f.d(b,{ApprovalRequestActionType:()=>A,ApprovalRequestPriority:()=>St,ApprovalRequestStatus:()=>vt,ApprovalStatusColumn:()=>yt,CampaignExceptionErrorType:()=>B,CopyPageDestinationType:()=>v,CopyToErrorType:()=>D,CopyToJobProgress:()=>S,CopyToWarningType:()=>I,ExcelCsvValidationErrorCode:()=>Re,PUBLICATION_STATUS_INTEGER_MAP:()=>w,PUBLICATION_STATUS_MAP:()=>O,PageCopyScenarioID:()=>y,PublicationStatusEnum:()=>gt,PublishingErrorCodes:()=>x,PublishingStatus:()=>E,QosEventHandler:()=>Et,VivaAmplifyError:()=>X,VivaEngageDestinationType:()=>C,_EngageDataProvider:()=>Pe,_HttpClientErrorResponse:()=>Y,_QosAwarePromise:()=>kt,_VinciAnalyticsDataProvider:()=>Je,_VinciApprovalsDataProvider:()=>st,_VinciCampaignMembersDataProvider:()=>ht,_VinciCampaignsDataProvider:()=>Oe,_VinciPublicationsDataProvider:()=>Qe,_VinciSecurebrokerAADTokenDataProvider:()=>Ye,_VinciTeamsDataProvider:()=>bt,_VinciZeroTermSuggestionDataProvider:()=>_t,allResults:()=>Ht,debounceAsync:()=>Mt,getErrorCodeFromError:()=>Tt,getHttpStatusCode:()=>Bt,hasApproverPermissions:()=>It,hasContributorPermissions:()=>xt,hasOwnerPermissions:()=>Dt,hasVisitorPermissions:()=>Ct,isAmplifyResults:()=>Ut,isEAPFeatureEnabled:()=>Pt,isNetworkError:()=>jt,nearestCommonAncestor:()=>Rt,resultCodeIsOrInheritsFrom:()=>Ft});var e=f(676),t=f(810),n=f(38);const a="SitePages",i=e=>`v2.1/campaign/${e}`,r=e=>`SP.Directory.DirectorySession/Group('${e}')/members?$skip=0&$top=-1&$inlinecount=allpages&$select=PrincipalName,Id,DisplayName,UserType,Mail`,o=e=>`/v1.0/groups/${e}/members?$select=id,displayName,jobTitle,mail,userPrincipalName`,s=e=>`/v1.0/groups?$filter=mailnickname%20eq%20'${e}'`,c=e=>`/sitepages/pages/CopyToStatus('${e}')`,d=e=>`v2.1/campaign/${e}/oneDrive.EnsureCampaignReady`,l=e=>`v2.1/campaign/${e}/oneDrive.SynchronizeCampaignPersonalCache`,u=e=>`/web/GetFileByServerRelativeUrl('${e}')/recycle()`,p=(e,t)=>`/web/lists(guid'${e}')/Items(${t})/recycle()`,m=e=>`v2.1/campaign/${e}/oneDrive.RemoveStaleCacheItem`,_=e=>`v2.1/campaign/${e}`,h=e=>`SP.Directory.DirectorySession/Group('${e}')`,g=e=>`v2.1/campaign/${e}`;var v,y,S,D,I,x,C;!function(e){e[e.CurrentWeb=0]="CurrentWeb",e[e.UserMySite=1]="UserMySite",e[e.DestinationUrl=2]="DestinationUrl"}(v||(v={})),function(e){e[e.Default=0]="Default",e[e.AmplifyPublish=1]="AmplifyPublish",e[e.PageMove=2]="PageMove",e[e.PageMoveAndPublish=3]="PageMoveAndPublish",e[e.DuplicatePublication=4]="DuplicatePublication"}(y||(y={})),function(e){e[e.Queued=0]="Queued",e[e.CreateAssetsFolderStart=1]="CreateAssetsFolderStart",e[e.CreateAssetsFolderEnd=2]="CreateAssetsFolderEnd",e[e.CopyAssetsStart=3]="CopyAssetsStart",e[e.CopyAssetsEnd=4]="CopyAssetsEnd",e[e.CreatePageStart=5]="CreatePageStart",e[e.CreatePageEnd=6]="CreatePageEnd",e[e.Succeeded=7]="Succeeded",e[e.Deleting=8]="Deleting",e[e.Failed=9]="Failed",e[e.JobNotFound=10]="JobNotFound"}(S||(S={})),function(e){e[e.None=0]="None",e[e.Generic=1]="Generic",e[e.ArgumentError=2]="ArgumentError",e[e.TargetCheckedOutByDifferentUser=3]="TargetCheckedOutByDifferentUser",e[e.TargetNotFound=4]="TargetNotFound",e[e.UnauthorizedOperation=5]="UnauthorizedOperation",e[e.InvalidDestinationWebUrl=6]="InvalidDestinationWebUrl",e[e.PreProcessorError=7]="PreProcessorError",e[e.PostProcessorError=8]="PostProcessorError",e[e.AssetNotFound=9]="AssetNotFound",e[e.AssetNotFile=10]="AssetNotFile",e[e.UserNotFound=11]="UserNotFound",e[e.OnErrorHandlerError=12]="OnErrorHandlerError",e[e.ErrorDeletingNewlyCreatedPage=13]="ErrorDeletingNewlyCreatedPage"}(D||(D={})),function(e){e[e.None=0]="None",e[e.Generic=1]="Generic",e[e.ErrorDeletingSourcePage=2]="ErrorDeletingSourcePage",e[e.ErrorDeletingSourcePageAssets=3]="ErrorDeletingSourcePageAssets"}(I||(I={})),function(e){e[e.NoError=-1]="NoError",e[e.DestinationSharePointSiteNoPermission=1101]="DestinationSharePointSiteNoPermission",e[e.EmailAddressNotValid=1102]="EmailAddressNotValid",e[e.EmailToMissing=1103]="EmailToMissing",e[e.EmailFromMissing=1104]="EmailFromMissing",e[e.DestinationSharePointSiteMissing=1105]="DestinationSharePointSiteMissing",e[e.AutoChangesNotAcknowledged=1106]="AutoChangesNotAcknowledged",e[e.RequiredApprovalMissing=1107]="RequiredApprovalMissing",e[e.PermissionCheckFailed=1109]="PermissionCheckFailed",e[e.DestinationSharePointSiteInvalid=1108]="DestinationSharePointSiteInvalid",e[e.SpSitesSelectedOverLimit=1110]="SpSitesSelectedOverLimit",e[e.EmailRecipientsSelectedOverLimit=1111]="EmailRecipientsSelectedOverLimit",e[e.TeamsChannelsSelectedOverLimit=1112]="TeamsChannelsSelectedOverLimit",e[e.PublicationTitleMissing=1113]="PublicationTitleMissing",e[e.TeamsImagesUploadedAboveLimit=1114]="TeamsImagesUploadedAboveLimit",e[e.TeamsInvalidSelection=1115]="TeamsInvalidSelection",e[e.ClassicPageStoreNotSupported=1116]="ClassicPageStoreNotSupported",e[e.EmailSubjectMissing=1117]="EmailSubjectMissing",e[e.EmailContentSizeExceeded=1118]="EmailContentSizeExceeded",e[e.PublishToEmailFailed=1202]="PublishToEmailFailed",e[e.PublishToSharePointCopyAPIFailed=1203]="PublishToSharePointCopyAPIFailed",e[e.PublishToSharePointPublishAPIFailed=1204]="PublishToSharePointPublishAPIFailed",e[e.PublishToSharePointFailedCopyAPIUnauthorizedOperation=1208]="PublishToSharePointFailedCopyAPIUnauthorizedOperation",e[e.TeamsContentEmpty=1250]="TeamsContentEmpty",e[e.TeamsMissingValues=1251]="TeamsMissingValues",e[e.TeamsMissingMetadata=1252]="TeamsMissingMetadata",e[e.TeamsEmptyAudience=1253]="TeamsEmptyAudience",e[e.TeamsSendAsNotValid=1254]="TeamsSendAsNotValid",e[e.TeamsUnsupportedCardType=1255]="TeamsUnsupportedCardType",e[e.TeamsInvalidContent=1256]="TeamsInvalidContent",e[e.TeamsEmptySender=1257]="TeamsEmptySender",e[e.VivaEngagePermissionDenied=1300]="VivaEngagePermissionDenied",e[e.VivaEngageInvalidThread=1301]="VivaEngageInvalidThread",e[e.VivaEngageUnknownError=1302]="VivaEngageUnknownError",e[e.VivaEngageIsContentTruncated=1303]="VivaEngageIsContentTruncated",e[e.VivaEngageNoDestinations=1304]="VivaEngageNoDestinations",e[e.VivaEngageMixOfCommunitiesAndStorylines=1305]="VivaEngageMixOfCommunitiesAndStorylines",e[e.VivaEngageTooManyCommunities=1306]="VivaEngageTooManyCommunities",e[e.VivaEngageCannotPostAnnouncement=1307]="VivaEngageCannotPostAnnouncement",e[e.VivaEngageUnknownCommunity=1308]="VivaEngageUnknownCommunity",e[e.VivaEngageCannotPostToCommunityCurrentUser=1309]="VivaEngageCannotPostToCommunityCurrentUser",e[e.VivaEngageCannotPostToCommunityDelegation=1310]="VivaEngageCannotPostToCommunityDelegation",e[e.VivaEngageStorylineDoesNotMatchSender=1311]="VivaEngageStorylineDoesNotMatchSender",e[e.VivaEngageCannotPostToStorylineCurrentUser=1312]="VivaEngageCannotPostToStorylineCurrentUser",e[e.VivaEngageCannotPostStorylineAnnouncementCurrentUser=1313]="VivaEngageCannotPostStorylineAnnouncementCurrentUser",e[e.VivaEngageCannotPostToStorylineDelegation=1314]="VivaEngageCannotPostToStorylineDelegation",e[e.VivaEngageCannotPostStorylineAnnouncementDelegation=1315]="VivaEngageCannotPostStorylineAnnouncementDelegation",e[e.VivaEngageValidateContentLengthExceeded=1316]="VivaEngageValidateContentLengthExceeded",e[e.VivaEngageValidatePublishingUserViewOnlyMode=1317]="VivaEngageValidatePublishingUserViewOnlyMode",e[e.VivaEngageValidatePublishingUserUserCannotCreateArticles=1318]="VivaEngageValidatePublishingUserUserCannotCreateArticles",e[e.VivaEngageValidateSenderSenderNull=1319]="VivaEngageValidateSenderSenderNull",e[e.VivaEngageValidateSenderNotDelegate=1320]="VivaEngageValidateSenderNotDelegate",e[e.VivaEngagePublishingUserRetrieveUserSettingsFailed=1321]="VivaEngagePublishingUserRetrieveUserSettingsFailed",e[e.VivaEngageSenderRetrieveUserSettingsFailed=1322]="VivaEngageSenderRetrieveUserSettingsFailed",e[e.VivaEngageSenderRetrieveDelegateTeamsFailed=1323]="VivaEngageSenderRetrieveDelegateTeamsFailed",e[e.VivaEngageTooManyImageAttachments=1324]="VivaEngageTooManyImageAttachments",e[e.VivaEngageNoDefaultStoryline=1325]="VivaEngageNoDefaultStoryline",e[e.VivaEngageContentEmpty=1326]="VivaEngageContentEmpty",e[e.VivaEngageMissingTitle=1327]="VivaEngageMissingTitle",e[e.PublishingPreValidationFailure=1500]="PublishingPreValidationFailure",e[e.PublishingPublicationIsPublishing=1501]="PublishingPublicationIsPublishing",e[e.PublishingSourcePublishingFailed=1502]="PublishingSourcePublishingFailed",e[e.PublishingSourceCheckedOutByOtherUser=1503]="PublishingSourceCheckedOutByOtherUser",e[e.PublishingFailedToAddWITimerJob=1504]="PublishingFailedToAddWITimerJob",e[e.NotApproved=1600]="NotApproved",e[e.SimpleVivaEngageNoDestinationPermission=10301]="SimpleVivaEngageNoDestinationPermission",e[e.SimpleVivaEngageNoStorylinePermission=10302]="SimpleVivaEngageNoStorylinePermission",e[e["SharePoint.DestinationSiteValidation.WebId.NullOrBlank"]=20001]="SharePoint.DestinationSiteValidation.WebId.NullOrBlank",e[e["SharePoint.DestinationSiteValidation.SiteId.NullOrBlank"]=20002]="SharePoint.DestinationSiteValidation.SiteId.NullOrBlank",e[e["SharePoint.DestinationSiteValidation.SiteUrl.NullOrBlank"]=20003]="SharePoint.DestinationSiteValidation.SiteUrl.NullOrBlank"}(x||(x={})),function(e){e[e.Community=1]="Community",e[e.Storyline=2]="Storyline",e[e.AllCompanyCommunity=3]="AllCompanyCommunity"}(C||(C={}));const O={0:"Draft",1:"Publishing",2:"Published",3:"NeedsAttention",4:"PendingApproval",5:"Rejected",6:"ReadyToPublish",7:"Scheduled"},w={Draft:0,Publishing:1,Published:2,NeedsAttention:3,PendingApproval:4,Rejected:5,ReadyToPublish:6,Scheduled:7};var E,A;function L(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}!function(e){e[e.None=0]="None",e[e.Publishing=1]="Publishing",e[e.Failed=2]="Failed",e[e.Successful=3]="Successful",e[e.ContentModerationPending=4]="ContentModerationPending"}(E||(E={})),function(e){e[e.Unknown=0]="Unknown",e[e.Request=1]="Request",e[e.Approve=2]="Approve",e[e.Reject=3]="Reject",e[e.Cancel=4]="Cancel",e[e.Declined=5]="Declined",e[e.Pending=6]="Pending",e[e.PendingAll=7]="PendingAll",e[e.CustomResponse=8]="CustomResponse",e[e.Signed=9]="Signed",e[e.Reassign=10]="Reassign",e[e.CopySent=11]="CopySent",e[e.Viewed=12]="Viewed",e[e.SignedAsDelegate=13]="SignedAsDelegate",e[e.NoResponse=1e3]="NoResponse"}(A||(A={}));class k{}class M extends k{toString(){return`<FieldRef Name="${this.fieldName}" />`}constructor(e){super(),this.fieldName=e}}class P extends k{toString(){return`<Value Type="${L(this.valueType)}">${L(this.value.toString())}</Value>`}constructor(e,t){super(),this.value=e,this.valueType=t}}class T extends k{toString(){return`<${this.operand}>${this.left.toString()}${this.right.toString()}</${this.operand}>`}constructor(e,t,n){super(),this.operand=e,this.left=t,this.right=n}}function U(e,t){let n=t[0];for(let a=1;a<t.length;a++)n=new T(e,n,t[a]);return n}var F=f(909),H=f(408);const R="application/json;odata.metadata=none";var N;!function(e){e[e.Api_Failure=1e3]="Api_Failure",e[e.Api_InvalidArgument=1001]="Api_InvalidArgument",e[e.Api_FlightDisabled=1010]="Api_FlightDisabled",e[e.Api_KillSwitchEnabled=1011]="Api_KillSwitchEnabled",e[e.Api_FlightCheckFailed=1012]="Api_FlightCheckFailed",e[e.Api_ValidationFailed=1013]="Api_ValidationFailed",e[e.Provisioning_Failure=2e3]="Provisioning_Failure",e[e.Provisioning_InvalidArgument=2001]="Provisioning_InvalidArgument",e[e.Provisioning_NotPermitted=2002]="Provisioning_NotPermitted",e[e.Provisioning_ModernSitesDisallowed=2003]="Provisioning_ModernSitesDisallowed",e[e.Provisioning_UpstreamBadRequest=2004]="Provisioning_UpstreamBadRequest",e[e.Provisioning_UpstreamUnauthorized=2005]="Provisioning_UpstreamUnauthorized",e[e.Provisioning_UpstreamSensitivityVisibilityIncompatible=2006]="Provisioning_UpstreamSensitivityVisibilityIncompatible",e[e.Provisioning_UpstreamLabelsNotSupported=2007]="Provisioning_UpstreamLabelsNotSupported",e[e.Provisioning_UpstreamGroupCreationDisabled=2008]="Provisioning_UpstreamGroupCreationDisabled",e[e.Provisioning_UpstreamUncategorized=2009]="Provisioning_UpstreamUncategorized",e[e.Provisioning_FailedToCreateGroupSite=2010]="Provisioning_FailedToCreateGroupSite",e[e.Provisioning_GroupSiteStatusNotReady=2011]="Provisioning_GroupSiteStatusNotReady",e[e.Provisioning_GroupSiteAlreadyExists=2012]="Provisioning_GroupSiteAlreadyExists",e[e.Provisioning_FailedToRetrieveGroup=2013]="Provisioning_FailedToRetrieveGroup",e[e.Provisioning_RetryGroupSiteStatusNotReady=2014]="Provisioning_RetryGroupSiteStatusNotReady",e[e.Provisioning_RetryGroupSiteAlreadyExists=2015]="Provisioning_RetryGroupSiteAlreadyExists",e[e.Provisioning_UserWithoutPermission_XGeo=2016]="Provisioning_UserWithoutPermission_XGeo",e[e.Provisioning_NonUnifiedGroupSiteAlreadyExists=2017]="Provisioning_NonUnifiedGroupSiteAlreadyExists",e[e.Provisioning_GroupNameAndAliasValidationFailed=2018]="Provisioning_GroupNameAndAliasValidationFailed",e[e.Provisioning_FailedToGetSiteUrlDuringValidation=2019]="Provisioning_FailedToGetSiteUrlDuringValidation",e[e.Provisioning_SiteUrlIsTooLong=2020]="Provisioning_SiteUrlIsTooLong",e[e.Provisioning_DetectedLanguageIsNotSupportedForTransliteration=2021]="Provisioning_DetectedLanguageIsNotSupportedForTransliteration",e[e.Provisioning_DetectedLanguageIsPresentInSupportedLanguages=2022]="Provisioning_DetectedLanguageIsPresentInSupportedLanguages",e[e.Provisioning_DetectedLanguageIsNotSupportedForTransliterationToLatin=2023]="Provisioning_DetectedLanguageIsNotSupportedForTransliterationToLatin",e[e.Provisioning_CouldNotDetermineSourceScriptForTransliteration=2024]="Provisioning_CouldNotDetermineSourceScriptForTransliteration",e[e.Provisioning_FailedToDetectLanguage=2025]="Provisioning_FailedToDetectLanguage",e[e.Provisioning_FailedToDetectUniqueScript=2026]="Provisioning_FailedToDetectUniqueScript",e[e.Provisioning_CallToTranslatorAPIFailed_Detect=2027]="Provisioning_CallToTranslatorAPIFailed_Detect",e[e.Provisioning_CallToTranslatorAPIFailed_Languages=2028]="Provisioning_CallToTranslatorAPIFailed_Languages",e[e.Provisioning_CallToTranslatorAPIFailed_Transliterate=2029]="Provisioning_CallToTranslatorAPIFailed_Transliterate",e[e.Provisioning_AliasAlreadyInUse=2030]="Provisioning_AliasAlreadyInUse",e[e.Provisioning_CampaignNameSanitizationResultedInEmptyAlias=2031]="Provisioning_CampaignNameSanitizationResultedInEmptyAlias",e[e.Provisioning_GroupNameAndAliasValidationFailed_BlockedWord=2032]="Provisioning_GroupNameAndAliasValidationFailed_BlockedWord",e[e.Provisioning_GroupNameAndAliasValidationFailed_PrefixSuffixRequired=2033]="Provisioning_GroupNameAndAliasValidationFailed_PrefixSuffixRequired",e[e.Provisioning_FailedToCreateTranslatorClient=2034]="Provisioning_FailedToCreateTranslatorClient",e[e.Storage_Failure=3e3]="Storage_Failure",e[e.Storage_InvalidArgument=3001]="Storage_InvalidArgument",e[e.Storage_Unauthorized=3002]="Storage_Unauthorized",e[e.Storage_NoSuchCampaign=3010]="Storage_NoSuchCampaign",e[e.Storage_NoSuchCommunication=3011]="Storage_NoSuchCommunication",e[e.Storage_FeatureActivationFailed=3012]="Storage_FeatureActivationFailed",e[e.Storage_SPWebIdDoesNotMatchCampaignId=3013]="Storage_SPWebIdDoesNotMatchCampaignId",e[e.Storage_ListFailure=3014]="Storage_ListFailure",e[e.Storage_ListItemFailure=3015]="Storage_ListItemFailure",e[e.Storage_FailedToUpdateCampaignMetadata=3016]="Storage_FailedToUpdateCampaignMetadata",e[e.Storage_ApproverGroupManagementFailed=3017]="Storage_ApproverGroupManagementFailed",e[e.Storage_CampaignCreationAlreadyComplete=3018]="Storage_CampaignCreationAlreadyComplete",e[e.Storage_UpdateCampaignMembershipFailed=3019]="Storage_UpdateCampaignMembershipFailed",e[e.Storage_UpdateCampaignListFailed=3020]="Storage_UpdateCampaignListFailed",e[e.Storage_RemoteApiRequestUnexpectedResponseStatus=3021]="Storage_RemoteApiRequestUnexpectedResponseStatus",e[e.Storage_UpdateCampaignSaveConflict=3022]="Storage_UpdateCampaignSaveConflict",e[e.Storage_RemoteApiRequestUnrecognizedFailure=3023]="Storage_RemoteApiRequestUnrecognizedFailure",e[e.PersonalCache_Failure=4e3]="PersonalCache_Failure",e[e.PersonalCache_InvalidArgument=4001]="PersonalCache_InvalidArgument",e[e.PersonalCache_UserInfoNotFound=4011]="PersonalCache_UserInfoNotFound",e[e.PersonalCache_AddWorkItemThrottled=4012]="PersonalCache_AddWorkItemThrottled",e[e.PersonalCache_AddWorkItemFailed=4013]="PersonalCache_AddWorkItemFailed",e[e.PersonalCache_MySiteNotInLocalFarm=4014]="PersonalCache_MySiteNotInLocalFarm",e[e.PersonalCache_PersonalSiteNotFound=4015]="PersonalCache_PersonalSiteNotFound",e[e.PersonalCache_OSRV_FolderNotFound=4100]="PersonalCache_OSRV_FolderNotFound",e[e.PersonalCache_OSRV_PersonalSiteNotFound=4101]="PersonalCache_OSRV_PersonalSiteNotFound",e[e.PersonalCache_OSRV_PersonalCacheListNotFound=4102]="PersonalCache_OSRV_PersonalCacheListNotFound",e[e.PersonalCache_OSRV_PersonalCacheListProvisionFailed=4103]="PersonalCache_OSRV_PersonalCacheListProvisionFailed",e[e.PersonalCache_OSRV_PersonalCacheItemProvisionFailed=4104]="PersonalCache_OSRV_PersonalCacheItemProvisionFailed",e[e.PersonalCache_OSRV_FailedToRetreiveCacheListItems=4105]="PersonalCache_OSRV_FailedToRetreiveCacheListItems",e[e.PersonalCache_OSRV_PersonalCacheItemInvalidListItemId=4106]="PersonalCache_OSRV_PersonalCacheItemInvalidListItemId",e[e.PersonalCache_OSRV_FailedToUpdateCacheListItem=4107]="PersonalCache_OSRV_FailedToUpdateCacheListItem",e[e.PersonalCache_OSRV_ProfileNotFound=4108]="PersonalCache_OSRV_ProfileNotFound",e[e.Permission_Failure=5e3]="Permission_Failure",e[e.Permission_UserAddFailure=5001]="Permission_UserAddFailure",e[e.Permission_UserRemoveFailure=5002]="Permission_UserRemoveFailure",e[e.Permission_NoOwnerSpecified=5003]="Permission_NoOwnerSpecified",e[e.Permission_UserRoleRetrievalFailure=5004]="Permission_UserRoleRetrievalFailure",e[e.AudienceTargeting_FailedToEnableSPAudienceTargeting=6e3]="AudienceTargeting_FailedToEnableSPAudienceTargeting"}(N||(N={}));const B=N;function j(){return e._SPKillSwitch.isActivated("39315ac0-b7a0-4132-807d-3ba754a71ef1")}function V(){return e._SPKillSwitch.isActivated("f373f170-23ab-47b6-b7f1-dabf05e686df")}function z(){return e._SPKillSwitch.isActivated("632594ba-d0bd-4db0-80dd-ef513624fa0a")}function G(){return e._SPKillSwitch.isActivated("609671f3-cf42-4074-abb4-8f475f3fabc3")}function K(){return e._SPKillSwitch.isActivated("3a871ba2-5c0c-4a6f-9cee-f99b8f972ceb")}function W(){return e._SPKillSwitch.isActivated("f57b82c4-8133-4a83-9fe2-ba0f06b8b6f3")}function q(){return e._SPKillSwitch.isActivated("692167b9-f9cd-46f3-88b8-28fe155458ee")}const Q="HttpClientErrorResponse";class Y extends Error{static is(e){return"object"==typeof e&&null!==e&&"name"in e&&e.name===Q}static _buildErrorDescription(e){return B[e]??`UncategorizedError_${e}`}constructor(t){super(t.statusText||"statusMessage"in t&&t.statusMessage||""),this.name=Q,this.httpStatusCode=t.status??-1,e._SPKillSwitch.isActivated("5433d34f-9f72-4fe0-b305-dc560e2c5bb1")?this.response=t:t?.clone&&(this.response=t.clone()),!e._SPKillSwitch.isActivated("2979d324-1f22-4a78-a860-4f6b8eed78a1")&&t?.clone&&(this.graphErrorInfo=t?.clone()?.json()?.then(e=>({message:e?.error?.message??"",code:e?.error?.code??"",clientRequestId:e?.error?.innerError?.["client-request-id"]??""})).catch(()=>{})),this.campaignErrorInfo=t?.json()?.then(e=>{if(e?.error?.message?.toLowerCase()?.includes("the call to update the mailbox returned forbidden"))return{errorCode:403,errorDescription:"The call to update the mailbox returned forbidden",errorType:"SubstrateForbiddenErrorType"};const t=e?.error?.["@error.campaignErrorType"];switch(t){case void 0:break;case B.Api_FlightDisabled:case B.Api_KillSwitchEnabled:return{errorCode:t,errorDescription:Y._buildErrorDescription(t),errorType:"TransientCampaignErrorType"};case B.Storage_CampaignCreationAlreadyComplete:return{errorCode:t,errorDescription:Y._buildErrorDescription(t),errorType:"CampaignAlreadyCreatedErrorType"};default:return{errorCode:t,errorDescription:Y._buildErrorDescription(t),errorType:"PermanentCampaignErrorType"}}const n=e?.error?.["@error.VivaAmplifyErrorType"];return void 0!==n?{errorCode:this.httpStatusCode,errorDescription:n}:void 0}).catch(()=>{})}}const J="VivaAmplifyError";class X extends Error{static is(e){return"object"==typeof e&&null!==e&&"name"in e&&e.name===J}constructor(e,t){super(t??e),this.name=J,this.errorType=e}}class Z{createEvent(t){const n=e.Guid.newGuid().toString(),a=e=>({alias:t.componentAlias??this._componentAlias??"",spResponseGuid:n,...e}),i=this._amplifyLogger.createQosEvent(t.qosEventName,a());return{spResponseGuid:n,logSuccess:e=>i.logSuccess(a(e)),logExpectedFailure:(e,t)=>i.logExpectedFailure(this._getErrorCode(e),e,a(t)),logUnexpectedFailure:(e,t)=>i.logUnexpectedFailure(this._getErrorCode(e),e,a(t))}}_getErrorCode(t){return!e._SPKillSwitch.isActivated("43692b16-075b-47e3-9cfc-42a10a7ceae8")&&Y.is(t)?[t?.httpStatusCode,t?.message].filter(e=>!!e).join(" - "):`${t?.message}`}constructor(e){this._componentAlias=e,this._amplifyLogger=n._AmplifyLogger.getAmplifyLogger()}}var $=f(737);class ee{get absoluteUrl(){return this._pageContext?.web?.absoluteUrl}get serverRelativeUrl(){return this._pageContext?.web?.serverRelativeUrl}async get(e,t){const{relativeUrl:n,baseUrl:a,telemetry:i,...r}=e,o=this._logger.createEvent(i),s=this._spHttpClient.get(this._generateUrl(n,a),F.SPHttpClient.configurations.v1,{...r,headers:{SPResponseGuid:o.spResponseGuid,accept:R,...void 0!==a?await this._getCrossDomainTokenHeader(a):void 0,...t}});return this._handleResponse(s,o)}async post(e,t){const{relativeUrl:n,baseUrl:a,telemetry:i,body:r,...o}=e,s=this._logger.createEvent(i),c=this._spHttpClient.post(this._generateUrl(n,a),F.SPHttpClient.configurations.v1,{body:r??"",...o,headers:{accept:R,SPResponseGuid:s.spResponseGuid,...void 0!==a?await this._getCrossDomainTokenHeader(a):void 0,...t}});return this._handleResponse(c,s)}async patch(e,t){const{relativeUrl:n,baseUrl:a,telemetry:i,body:r,...o}=e,s=this._logger.createEvent(i),c=this._spHttpClient.fetch(this._generateUrl(n,a),F.SPHttpClient.configurations.v1,{...o,body:r??"",headers:{accept:R,SPResponseGuid:s.spResponseGuid,...void 0!==a?await this._getCrossDomainTokenHeader(a):void 0,...t},method:"PATCH"});return this._handleResponse(c,s)}async delete(e,t){const{relativeUrl:n,baseUrl:a,telemetry:i,body:r,...o}=e,s=this._logger.createEvent(i),c=this._spHttpClient.fetch(this._generateUrl(n,a),F.SPHttpClient.configurations.v1,{...o,body:r??"",headers:{accept:R,SPResponseGuid:s.spResponseGuid,...void 0!==a?await this._getCrossDomainTokenHeader(a):void 0,...t},method:"delete"});return this._handleResponse(c,s)}_handleResponse(e,t){return e.then(e=>{if(!e.ok)throw new Y(e);return t.logSuccess(),e}).then(e=>204!==e.status&&e.headers.get("content-type")?.startsWith("application/json")?e.json():void 0).catch(e=>{throw t.logUnexpectedFailure(e),e})}_generateUrl(e,n){return t.Uri.concatenate(n??this.absoluteUrl,"_api",e)}async _getCrossDomainTokenHeader(e){if(G())return;const t=new URL(e).origin;if(window.location.origin&&window.location.origin!==t){const e=await this._aadTokenProvider;return{Authorization:"Bearer "+await e._getTokenInternal(t,$._AadTokenProviders.preAuthorizedConfiguration)}}}constructor(t){e.Validate.isNotNullOrUndefined(t,"serviceScope"),t.whenFinished(()=>{this._spHttpClient=t.consume(F.SPHttpClient.serviceKey),this._pageContext=t.consume(H.PageContext.serviceKey),this._aadTokenProvider=t.consume(F.AadTokenProviderFactory.serviceKey).getTokenProvider()}),this._logger=new Z}}function te(){return e._SPKillSwitch.isActivated("d6faf5b3-1c79-4e7f-a4fd-4c9a8af26192")}ee.serviceKey=e.ServiceKey.create("sp-vinci-data-provider:VinciDataProvider",ee);const ne="{pageId}",ae="{teamId}",ie="{channelId}",re="/sitepages/pages({pageId})",oe="SendTestTeamsMessage",se="https://graph.microsoft.com",ce="https://substrate.office.com",de="https://outlook.office365.com/search",le="/v1.0/$batch",ue=e=>`/sitepages/pages(${e})/RepairMissingSharePointDestinationWebIds`;class fe{get absoluteUrl(){return this._pageContext?.web?.absoluteUrl}get(e){const t=this._generateUrl(e.relativeUrl,e.baseUrl),n=this._logger.createEvent(e.telemetry),a=this._aadHttpClient.then(e=>e.get(t,F.AadHttpClient.configurations.v1));return this._handleResponse(a,n)}post(e){const t=this._generateUrl(e.relativeUrl,e.baseUrl),n=this._logger.createEvent(e.telemetry),a=this._aadHttpClient.then(n=>n.post(t,F.AadHttpClient.configurations.v1,{body:e.body}));return this._handleResponse(a,n)}batchCall(e){const t=this._generateUrl(le,e.baseUrl),n=this._logger.createEvent(e.telemetry),a=this._aadHttpClient.then(n=>n.post(t,F.AadHttpClient.configurations.v1,{body:JSON.stringify({requests:e.batchRequests,...JSON.parse(e?.body??"{}")}),headers:{"Content-Type":"application/json"}}));return this._handleResponse(a,n)}_handleResponse(e,t){return e.then(e=>{if(!e.ok){const n=new Y(e);throw t.logUnexpectedFailure(n),n}return t.logSuccess(),e}).then(e=>204!==e.status&&e.headers.get("content-type")?.startsWith("application/json")?e.json():void 0).catch(e=>{throw t.logUnexpectedFailure(e),e})}_generateUrl(e,n){return t.Uri.concatenate(n??se,e)}constructor(t){e.Validate.isNotNullOrUndefined(t,"serviceScope"),t.whenFinished(()=>{this._aadHttpClient=t.consume($.AadHttpClientFactory.serviceKey)._getStandardClient(se),this._pageContext=t.consume(H.PageContext.serviceKey)}),this._logger=new Z}}fe.serviceKey=e.ServiceKey.create("sp-vinci-data-provider:VinciGraphDataProvider",fe);const pe=JSON.parse('{"N":"General"}'),me={alias:n._AUTHORING_TEAMS_DRAFT_CONTEXT},_e={channels:[],chats:[],people:[]},he=e=>({channels:e?[e]:[],chats:[],people:[]}),be={teams:_e,sharepoint:[]},ge=(e,t=pe.N,n)=>({groupId:e.GroupId,name:t,teamName:e.Name,threadId:e.ThreadId,source:n});function ve(e,t){var a;if((a=e).teamName||(a.teamName=""),e.name&&e.threadId&&e.groupId)return!0;{const a=(e.name?!e.threadId&&"MissingThreadId":"MissingName")||!e.groupId&&"MissingGroupId"||"Unknown";return t&&n._AmplifyLogger.getAmplifyLogger().createQosEvent("VivaAmplify.VinciPublicationsDataProvider.InvalidChannelResponse").logUnexpectedFailure(a,new Error(a),t),!1}}function ye(e,t){if(e.threadId&&e.threadType&&e.name&&void 0!==e.totalChatMembersCount)return!0;{const a=(e.threadId?!e.threadType&&"MissingThreadType":"MissingThreadId")||!e.name&&"MissingName"||void 0===e.totalChatMembersCount&&"MissingTotalChatMembersCount"||"Unknown";return t&&n._AmplifyLogger.getAmplifyLogger().createQosEvent("VivaAmplify.VinciPublicationsDataProvider.InvalidChatResponse").logUnexpectedFailure(a,new Error(a),t),!1}}function Se(e,t){if(e.id&&e.displayName&&e.emailAddresses&&e.imAddress&&e.userPrincipalName)return!0;{const a=(e.id?!e.displayName&&"MissingDisplayName":"MissingId")||!e.emailAddresses&&"MissingEmailAddresses"||!e.imAddress&&"MissingImAddress"||!e.userPrincipalName&&"MissingUserPrincipalName"||"Unknown";return t&&n._AmplifyLogger.getAmplifyLogger().createQosEvent("VivaAmplify.VinciPublicationsDataProvider.InvalidPersonResponse").logUnexpectedFailure(a,new Error(a),t),!1}}function De(e,t,a){const i=n._AmplifyLogger.getAmplifyLogger().createQosEvent("CampaignManagement.ParsePublicationField.Event");try{t[a]=e(t[a]),i.logSuccess()}catch(e){i.logUnexpectedFailure(`Failed to deserialize ${a}`,e),t[a]=void 0}}const Ie=JSON.parse,xe=JSON.parse;function Ce(e){De(Ie,e,"_AmplifyCampaignMetadata"),De(Ie,e,"_AmplifyCampaignEndpointSharePoint"),De(Ie,e,"_AmplifyCampaignEndpointEmail"),De(Ie,e,"_AmplifyCampaignEndpointTeams"),De(Ie,e,"_AmplifyCampaignEndpointVivaEngage"),De(xe,e,"_AmplifyCampaignPublicationStatus")}class Oe{get _groupId(){if(!this._pageContext.site.group)throw new Error("Page Context Site Group is null or undefined.");return this._pageContext.site.group.id.toString()}generateCampaignUrl(e,t){return this._vinciDataProvider.post({relativeUrl:"v2.1/campaign/oneDrive.GenerateCampaignUrl",body:JSON.stringify({name:e}),telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GenerateCampaignUrl.Api"}}).then(e=>e.value)}getValidSiteUrlFromAlias(e,n){return this._vinciDataProvider.get({relativeUrl:(a=t.UriEncoding.encodeRestUriStringToken(e),`GroupSiteManager/GetValidSiteUrlFromAlias?alias='${a}'&isTeamSite=true`),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetValidSiteUrlFromAlias.Api"}}).then(e=>e.value);var a}getGroupByAlias(e,n){return this._vinciGraphDataProvider.get({relativeUrl:s(t.UriEncoding.encodeRestUriStringToken(e)),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetGroupByAlias.Api"}}).then(e=>e.value.length?e.value[0]:void 0)}validateGroupName(t,n,a){return this._vinciDataProvider.post({relativeUrl:"SP.Directory.DirectorySession/ValidateGroupName",body:JSON.stringify({displayName:t,alias:n}),telemetry:{componentAlias:a?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.ValidateGroupName.Api"}},e._SPKillSwitch.isActivated("f47e21ea-19c5-41f8-a3ba-a1b706555c8b")?void 0:{"X-ClientType":"VinciCampaignsDataProvider_ValidateGroupName"})}getInstalledLanguages(e){return this._vinciDataProvider.get({relativeUrl:"web/regionalsettings/installedlanguages",telemetry:{componentAlias:e?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetInstalledLanguages.Api"}}).then(e=>e.Items)}getCampaignSiteId(e,t){return this._vinciDataProvider.get({relativeUrl:"Site/Id",baseUrl:e,telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetCampaignSiteId.Api"}}).then(e=>e.value)}createCampaign(e,t){return this._vinciDataProvider.post({relativeUrl:"v2.1/campaign",body:JSON.stringify(e),telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.CreateCampaign.Api"}})}createCampaignWithRetryBackoff(e,t,n,a){return this._createCampaignWithRetryBackoffInternal(e,t,t,n,a)}updateCampaign(e,t,n){return this._vinciDataProvider.patch({relativeUrl:_(e),body:JSON.stringify(t),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.UpdateCampaign.Api"}})}patchCampaignSite(e,t){return this._vinciDataProvider.patch({relativeUrl:"Site",body:JSON.stringify(e),telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.PatchCampaignSite.Api"}})}getSiteSensitivityLabel(e){return this._vinciDataProvider.get({relativeUrl:"Site/SensitivityLabelId",telemetry:{componentAlias:e?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetSiteSensitivityLabel.Api"}}).then(e=>e.value)}getCampaign(e,t){return this._vinciDataProvider.get({relativeUrl:i(e),telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetCampaign.Api"}})}deleteCampaign(e,t,n){return this._vinciDataProvider.delete({relativeUrl:g(t),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.DeleteCampaign.Api"}})}removeStaleCacheItem(e,t){return this._vinciDataProvider.post({relativeUrl:m(e),telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.RemoveStaleCacheItem.Api"}})}createPage(e,t){return this._vinciDataProvider.post({relativeUrl:"sitepages/pages/publications",body:JSON.stringify(e),telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.CreatePage.Api"}})}deletePage(e,t,n){return this._vinciDataProvider.post({relativeUrl:(a=e.PageId,`/sitepages/pages(${a})/DeletePublication`),telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.DeletePage.Api"}},n).then(e=>e.value);var a}undeletePublications(t,n){return this._vinciDataProvider.post({relativeUrl:e._SPKillSwitch.isActivated("0e4815f4-e498-4845-80da-237d0e54f961")?"site/RecycleBin/RestoreByIds":"web/RecycleBin/RestoreByIds",body:JSON.stringify(t),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.UndeletePublications.Api"}})}copyTo(e,t,n){return this._vinciDataProvider.post({relativeUrl:(a=e,`/sitepages/pages(${a})/CopyTo`),body:JSON.stringify({copyToParams:t}),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.CopyTo.Api"}});var a}copyToStatus(e,t){return this._vinciDataProvider.get({relativeUrl:c(e),telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.CopyToStatus.Api"}})}ensureCampaignReady(e,t,n){return this._vinciDataProvider.post({relativeUrl:d(e),body:JSON.stringify({value:t}),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.EnsureCampaignReady.Api"}})}synchronizeCampaignPersonalCache(e,t,n){return this._vinciDataProvider.post({relativeUrl:l(e),body:JSON.stringify({items:t}),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.SynchronizeCampaignPersonalCache.Api"}})}getGroupCreationContext(e){return this._vinciDataProvider.get({relativeUrl:"GroupSiteManager/GetGroupCreationContext",telemetry:{componentAlias:e?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetGroupCreationContext.Api"}})}syncGroupProperties(e){return this._vinciDataProvider.post({relativeUrl:"GroupService/SyncGroupProperties",telemetry:{componentAlias:e?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.SyncGroupProperties.Api"}})}updateGroupSensitivityLabelId(e,t,n){return this._vinciDataProvider.patch({relativeUrl:h(e),body:JSON.stringify(t),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.UpdateGroupSensitivityLabelId.Api"}})}getPublicationById(e,n){const i=t.Uri.concatenate(this._vinciDataProvider.serverRelativeUrl,a);return this._renderListDataAsStream({relativeUrl:i,query:"",requestBody:this._buildRequestBodyForGetPublications(this._getPublicationByIdViewXml(e)),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetPublicationById.Api"}}).then(e=>{if(0===e.length)return;const t=e[0];return Ce(t),t})}getPublicationByUniqueId(e,n){const i=t.Uri.concatenate(this._vinciDataProvider.serverRelativeUrl,a);return this._renderListDataAsStream({relativeUrl:i,query:"",requestBody:this._buildRequestBodyForGetPublications(this._getPublicationByUniqueIdViewXml(e)),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetPublicationByUniqueId.Api"}}).then(e=>{if(0===e.length)return;const t=e[0];return Ce(t),t})}getPublications(e,n){const i=t.Uri.concatenate(this._vinciDataProvider.serverRelativeUrl,a),r=void 0===e.pageSize?"":`OverrideRowLimit=${e.pageSize}`,o=this._getPublicationsViewXml(e.filter,e.sortBy,e.sortAscending);return this._renderListDataAsStream({relativeUrl:i,query:r,requestBody:this._buildRequestBodyForGetPublications(o),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetPublications.Api"}}).then(t=>{let a=[];a=e.isTemplate?t.filter(e=>"Template"===e._SPSitePageFlags[0]):t.filter(e=>"Template"!==e._SPSitePageFlags[0]),a.forEach(Ce);const i={results:a,page:1,pageSize:e.pageSize??t.length,sortBy:e.sortBy,sortAscending:e.sortAscending,viewXml:o};return t.length===e.pageSize&&(i.nextPage=()=>this._getPublicationsNextPage(i,n)),i})}getCampaignCollection(e){return this._vinciDataProvider.get({relativeUrl:"v2.1/campaign/oneDrive.GetCampaignCollection",telemetry:{componentAlias:e?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetCampaignCollection.Api"}})}getAllUsers(e,t){return this._vinciDataProvider.get({relativeUrl:r(e.toString()),telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetAllUsers.Api"}}).then(e=>e.value)}getSiteUsers(e){return this._vinciDataProvider.get({relativeUrl:"/web/siteusers?$select=Id,Title,Email,LoginName,UserPrincipalName",telemetry:{componentAlias:e?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetSiteUsers.Api"}}).then(e=>e.value)}getPublishedAudiences(e){const t={filter:{publicationStatuses:["Published"],authors:[this._pageContext.user.displayName],distributionChannels:["SharePoint","Teams"],publicationId:""},sortBy:"_AmplifyCampaignPublicationStatus",sortAscending:!1};return this.getPublications(t,e).then(e=>{const t={teams:_e,sharepoint:[]};return e.results.forEach(e=>{const a=e._AmplifyCampaignEndpointTeams;if(a){const e=a?.selectedItems?.channels.filter(e=>V()||!!ve(e)).filter(e=>!t?.teams?.channels?.some(t=>t.threadId===e.threadId))||[],n=a?.selectedItems?.chats.filter(e=>V()||!!ye(e)).filter(e=>!t?.teams?.chats?.some(t=>t.threadId===e.threadId))||[],i=a?.selectedItems?.people.filter(e=>V()||!!Se(e)).filter(e=>!t?.teams?.people?.some(t=>t.id===e.id))||[];t.teams={channels:[...t.teams?.channels??[],...e],chats:[...t.teams?.chats??[],...n],people:[...t.teams?.people??[],...i]}}const i=e._AmplifyCampaignEndpointSharePoint;if(i){const e=Array.isArray(t.sharepoint)?t.sharepoint:t.sharepoint?.sites;if(t.sharepoint={sites:[...e??[],...i?.sites?.filter(t=>!e?.some(e=>e.siteId===t.siteId))??[]]},!j()){const e=(i?.sites??[]).filter(e=>null===e.webId);e.length>0&&n._AmplifyLogger.getAmplifyLogger().createQosEvent("VivaAmplify.VinciPublicationsDataProvider.GetPublishedAudienceReturnsNullWebId.Api").logUnexpectedFailure("SharePoint audience has sites with missing webId",new Error(`Found sites with missing webId: ${e.map(e=>e.siteId).join(", ")}`))}}}),t})}getAuthors(e,n){const i=t.Uri.concatenate(this._vinciDataProvider.serverRelativeUrl,a),r=this._getAuthorsViewXml(e);return this._renderListDataAsStream({relativeUrl:i,query:"",requestBody:this._buildRequestBodyForGetPublications(r),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetAuthors.Api"}}).then(e=>e.flatMap(e=>e.Author))}getPublicationStatuses(e,n){const i=t.Uri.concatenate(this._vinciDataProvider.serverRelativeUrl,a),r=this._getPublicationStatuses(e);return this._renderListDataAsStream({relativeUrl:i,query:"",requestBody:this._buildRequestBodyForGetPublications(r),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetPublicationStatuses.Api"}}).then(e=>e.flatMap(e=>e._AmplifyCampaignPublicationStatus).filter(e=>!!e).map(e=>O[e]))}getDistributionChannels(e,n,i){const r=t.Uri.concatenate(this._vinciDataProvider.serverRelativeUrl,a),o=e=>this._renderListDataAsStream({relativeUrl:r,query:"",requestBody:this._buildRequestBodyForGetPublications(this._getDistributionChannel(n,e)),telemetry:{componentAlias:i?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetDistributionChannels.Api"}}).then(t=>t.length>0?e:void 0),s=e?["VivaEngage","Outlook","SharePoint","Teams"]:["Outlook","SharePoint","Teams"];return Promise.allSettled(s.map(e=>o(e))).then(e=>e.map(e=>"fulfilled"===e.status?e.value:void 0).filter(e=>!!e))}getCanUserCreateGroup(e){return this._vinciDataProvider.get({relativeUrl:"GroupSiteManager/CanUserCreateGroup",telemetry:{componentAlias:e?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetCanUserCreateGroup.Api"}}).then(e=>e.value)}getMyOneDriveInfo(e){return this._vinciGraphDataProvider.get({relativeUrl:"v1.0/me/drive",telemetry:{componentAlias:e?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetMyOneDriveInfo.Api"}})}deleteTemplate(e,t,n,a,i){return this._vinciDataProvider.post({relativeUrl:n&&a?p(n,a):u(t),body:e,telemetry:{componentAlias:i?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.DeleteTemplate.Api"}}).then(()=>!0)}getCampaignUsers(e){return this._vinciGraphDataProvider.get({relativeUrl:o(this._groupId),baseUrl:se,telemetry:{componentAlias:n._CAMPAIGN_LANDING_PAGE_COMPONENT_NAME,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetCampaignUsers.Api"}}).then(t=>{const n=[],a=new Map;return e.owners?.forEach(e=>a.set(e.email,"Owner")),e.approvers?.forEach(e=>a.set(e.email,"Approver")),e.contributors?.forEach(e=>a.set(e.email,"Contributor")),e.visitors?.forEach(e=>a.set(e.email,"Visitor")),t.value.forEach(e=>{n.push({objectId:e.id??"",id:e.id??"",userPrincipalName:e.userPrincipalName??"",email:e.mail??"",name:e.displayName??"",role:a.get(e.mail??"")??"Unknown"})}),n})}_getPublicationByIdViewXml(e){return`<View Scope="RecursiveAll">\n      <Query>\n        <Where>\n          ${new T("Eq",new M("ID"),new P(e,"String")).toString()}\n        </Where>\n      </Query>\n    </View>`}_getPublicationByUniqueIdViewXml(e){return`<View Scope="RecursiveAll">\n      <Query>\n        <Where>\n          ${new T("Eq",new M("UniqueId"),new P(e,"String")).toString()}\n        </Where>\n      </Query>\n    </View>`}_getPublicationsViewXml(e,t,n){return`<View Scope="RecursiveAll">\n      <Query>\n        <Where>\n          ${this._buildTopLevelPredicate(e).toString()}\n        </Where>\n        <OrderBy>\n          <FieldRef Name="${t}" Ascending="${n}" />\n          <FieldRef Name="ID" Ascending="${n}" />\n        </OrderBy>\n      </Query>\n    </View>`}_getAuthorsViewXml(e){return`<View Scope="RecursiveAll">\n      <Query>\n        <Where>\n          ${this._buildTopLevelPredicate(e?{...e,authors:[]}:void 0).toString()}\n        </Where>\n        <GroupBy Collapse = "TRUE">\n          <FieldRef Name = "Author"/>\n        </GroupBy>\n        <ViewFields>\n          <FieldRef Name="Author" />\n        </ViewFields>\n      </Query>\n    </View>`}_getPublicationStatuses(e){return`<View Scope="RecursiveAll">\n      <Query>\n        <Where>\n          ${this._buildTopLevelPredicate(e?{...e,publicationStatuses:[]}:void 0).toString()}\n        </Where>\n        <GroupBy Collapse = "TRUE">\n          <FieldRef Name = "_AmplifyCampaignPublicationStatus"/>\n        </GroupBy>\n        <ViewFields>\n          <FieldRef Name="_AmplifyCampaignPublicationStatus" />\n        </ViewFields>\n      </Query>\n    </View>`}_getDistributionChannel(e,t){return`<View Scope="RecursiveAll">\n      <Query>\n        <Where>\n          ${this._buildTopLevelPredicate(e?{...e,distributionChannels:[t]}:void 0).toString()}\n        </Where>\n        <ViewFields>\n        </ViewFields>\n      </Query>\n    </View>`}_buildTopLevelPredicate(e){let t=new T("BeginsWith",new M("ContentTypeId"),new P("0x0101009D1CB255DA76424F860D91F20E6C41180027ECB870B042465FAB4303F0D3CC2792","String"));if(e?.authors.length&&(t=new T("And",t,U("Or",e.authors.map(e=>new T("Eq",new M("Author"),new P(e,"User")))))),e?.publicationStatuses.length&&(t=new T("And",t,U("Or",e.publicationStatuses.map(e=>new T("Eq",new M("_AmplifyCampaignPublicationStatus"),new P(w[e],"Integer")))))),e?.distributionChannels.length){const n=[];e?.distributionChannels.includes("Outlook")&&n.push(new T("Contains",new M("_AmplifyCampaignEndpointEmail"),new P('enabled":true,',"String"))),e?.distributionChannels.includes("SharePoint")&&n.push(new T("Contains",new M("_AmplifyCampaignEndpointSharePoint"),new P('enabled":true,',"String"))),e?.distributionChannels.includes("Teams")&&n.push(new T("Contains",new M("_AmplifyCampaignEndpointTeams"),new P('enabled":true,',"String"))),e?.distributionChannels.includes("VivaEngage")&&n.push(new T("Contains",new M("_AmplifyCampaignEndpointVivaEngage"),new P('enabled":true,',"String"))),""!==e?.publicationId&&n.push(new T("Contains",new M("UniqueId"),new P(e?.publicationId.toUpperCase(),"String"))),n.length&&(t=new T("And",t,U("Or",n)))}return e?.publicationId.length&&(t=new T("And",t,new T("Contains",new M("UniqueId"),new P(e.publicationId.toUpperCase(),"String")))),t}_getPublicationsNextPage(e,n){const i=t.Uri.concatenate(this._vinciDataProvider.serverRelativeUrl,a),r=e.results[e.results.length-1];return this._renderListDataAsStream({relativeUrl:i,query:`OverrideRowLimit=${e.pageSize}&PAGED=TRUE&p_ID=${r.ID}&p_${e.sortBy}=${r[e.sortBy]}`,requestBody:this._buildRequestBodyForGetPublications(e.viewXml),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciCampaignsDataProvider.GetPublicationsNextPage.Api"}}).then(t=>{const a={results:t.filter(e=>"Template"!==e._SPSitePageFlags[0]),page:e.page+1,pageSize:e.pageSize,sortBy:e.sortBy,sortAscending:e.sortAscending,viewXml:e.viewXml};return a.results.forEach(Ce),a.previousPage=()=>new Promise(t=>t(e)),t.length===e.pageSize&&(a.nextPage=()=>this._getPublicationsNextPage(a,n)),a})}_buildRequestBodyForGetPublications(e){return{parameters:{RenderOptions:4119,ViewXml:e,AllowMultipleValueFilterForTaxonomyFields:!0,AddRequiredFields:!0}}}_renderListDataAsStream(e){const n="web/GetListUsingPath(DecodedUrl=@a1)/RenderListDataAsStream?@a1='{listRelativeUrl}'&TryNewExperienceSingle=TRUE&{query}".replace("{listRelativeUrl}",t.UriEncoding.encodeRestUriStringToken(e.relativeUrl)).replace("{query}",e.query||"");return this._vinciDataProvider.post({relativeUrl:n,body:JSON.stringify(e.requestBody||""),telemetry:{componentAlias:e.telemetry.componentAlias,qosEventName:e.telemetry.qosEventName}}).then(e=>e?.ListData?.Row??[])}_delayMs(e){return new Promise(t=>setTimeout(t,e))}_createCampaignErrorIsRetryable(e){const t=[B.Api_FlightDisabled,B.Api_KillSwitchEnabled,B.Api_ValidationFailed,B.Storage_CampaignCreationAlreadyComplete,B.Provisioning_GroupSiteAlreadyExists,B.Provisioning_RetryGroupSiteAlreadyExists,B.Provisioning_NonUnifiedGroupSiteAlreadyExists,B.Provisioning_UserWithoutPermission_XGeo,B.Provisioning_UpstreamSensitivityVisibilityIncompatible,B.Provisioning_UpstreamLabelsNotSupported,B.Provisioning_UpstreamGroupCreationDisabled,B.Provisioning_ModernSitesDisallowed];return!e?.errorCode||!t.includes(e.errorCode)}_createCampaignWithRetryBackoffInternal(e,t,a,i,r){const o={maxAttempts:a,attemptsLeft:t,alias:n._CREATE_CAMPAIGN_MODAL},s=n._AmplifyLogger.getAmplifyLogger().createQosEvent("CampaignManagement.CreateCampaignWithRetry.Api"),c=i*(a-t+1);return new Promise((n,d)=>{this.createCampaign(e,r).then(e=>{s.logSuccess(o),n(e)}).catch(l=>{(l?.campaignErrorInfo??Promise.resolve(void 0)).then(u=>{this._createCampaignErrorIsRetryable(u)?(s.logUnexpectedFailure(l?.message,l,o),1===t?d(l):this._delayMs(c).then(()=>{this._createCampaignWithRetryBackoffInternal(e,t-1,a,i,r).then(n,d)}).catch(d)):(s.logExpectedFailure(l?.message,l,o),d(l))})})})}constructor(t){e.Validate.isNotNullOrUndefined(t,"serviceScope"),t.whenFinished(()=>{this._vinciDataProvider=t.consume(ee.serviceKey),this._vinciGraphDataProvider=t.consume(fe.serviceKey),this._pageContext=t.consume(H.PageContext.serviceKey)})}}function we(){return e._SPFlight.isEnabled(61060)}Oe.serviceKey=e.ServiceKey.create("sp-vinci-data-provider:VinciCampaignsDataProvider",Oe);class Ee{get(e){const n=$._AadTokenProviders.configurable,a=this._logger.createEvent(e.telemetry),i=n._getTokenInternal(de,$._AadTokenProviders.preAuthorizedConfiguration).then(n=>{const a=new F.HttpClientConfiguration(F.HttpClient.configurations.v1),i=new Headers;i.set("Authorization","Bearer "+n),i.set("Content-Type","application/json"),i.set("Accept","application/json");const r=t.Uri.concatenate(e.baseUrl||ce,e.relativeUrl),o={credentials:"same-origin",headers:i};return this._httpClient.get(r,a,o)});return this._handleResponse(i,a)}post(e){const n=$._AadTokenProviders.configurable,a=this._logger.createEvent(e.telemetry),i=n._getTokenInternal(de,$._AadTokenProviders.preAuthorizedConfiguration).then(n=>{const a=new F.HttpClientConfiguration(F.HttpClient.configurations.v1),i=new Headers;i.set("Authorization","Bearer "+n),i.set("Content-Type","application/json"),i.set("Accept","application/json");const r=t.Uri.concatenate(e.baseUrl||ce,e.relativeUrl),o={credentials:"same-origin",headers:i,body:e.body};return this._httpClient.post(r,a,o)});return this._handleResponse(i,a)}_handleResponse(e,t){return e.then(e=>{if(!e.ok){const n=new Y(e);throw t.logUnexpectedFailure(n),n}return t.logSuccess(),e}).then(e=>204!==e.status&&e.headers.get("content-type")?.startsWith("application/json")?e.json():void 0).catch(e=>{throw t.logUnexpectedFailure(e),e})}constructor(t){e.Validate.isNotNullOrUndefined(t,"serviceScope"),t.whenFinished(()=>{this._httpClient=t.consume(F.HttpClient.serviceKey)}),this._logger=new Z}}Ee.serviceKey=e.ServiceKey.create("sp-vinci-data-provider:VinciSubstrateDataProvider",Ee);class Ae{static _getHeaderHeader(){return{headers:{ACCEPT:"application/json;odata=verbose",Caller:"ODSPSitePicker","X-HTTP-Method":"GET"}}}get(e){const n=$._AadTokenProviders.configurable,a=this._logger.createEvent(e.telemetry),i=n._getTokenInternal(de,$._AadTokenProviders.preAuthorizedConfiguration).then(n=>{const a=new F.HttpClientConfiguration(F.HttpClient.configurations.v1),i=new Headers;i.set("Authorization","Bearer "+n),i.set("Content-Type","application/json"),i.set("Accept","application/json");const r=t.Uri.concatenate(e.baseUrl||ce,e.relativeUrl),o=Ae._getHeaderHeader();return e.headers?.forEach((e,t)=>{o.headers[t]=e}),this._httpClient.get(r,a,o)});return this._handleResponse(i,a)}_handleResponse(e,t){return e.then(e=>{if(!e.ok){const n=new Y(e);throw t.logUnexpectedFailure(n),n}return t.logSuccess(),e}).then(e=>204!==e.status&&e.headers.get("content-type")?.startsWith("application/json")?e.json():void 0).catch(e=>{throw t.logUnexpectedFailure(e),e})}constructor(t){e.Validate.isNotNullOrUndefined(t,"serviceScope"),t.whenFinished(()=>{this._httpClient=t.consume(F.HttpClient.serviceKey)}),this._logger=new Z}}Ae.serviceKey=e.ServiceKey.create("sp-vinci-data-provider:VinciSharePointDataProvider",Ae);const Le="https://api.engage.cloud.microsoft/",ke=400;function Me(e,t){const n=new URL(e);return Object.keys(t).forEach(e=>{const a=t[e];void 0!==a&&n.searchParams.set(e,a.toString())}),n.toString()}class Pe{async searchCommunities(e){const t=Me(Le+"private/v1/communities/autocomplete",e),n=e=>this._get({url:t,qosEventName:"EngageDataProvider.SearchCommunities.Api",...e}).then(e=>({...e,items:e.items?.filter(this._validateCommunity)}));return e.query&&""!==e.query.trim()?n():this._communityZeroTermResponse||(this._communityZeroTermResponse=n({retryDelayMs:ke,retryCount:4}).catch(e=>{throw this._communityZeroTermResponse=void 0,e}))}async resolveCommunity(e){var t,n;return((t=this._resolvedCommunities)[n=e]||(t[n]=this._get({url:Le+"private/v1/communities/{id}".replace("{id}",e),qosEventName:"EngageDataProvider.ResolveCommunity.Api",retryDelayMs:100,retryCount:4}))).then(e=>{if(!this._validateCommunity(e))throw new Error("Invalid community response");return e}).catch(t=>{throw delete this._resolvedCommunities[e],t})}async searchUsers(e){const t=Me(Le+"private/v1/users/autocomplete",e),n=e=>this._get({url:t,qosEventName:"EngageDataProvider.SearchUsers.Api",...e}).then(e=>({...e,items:e.items.filter(this._validateUser)}));return e.query&&""!==e.query.trim()?n():this._userZeroTermResponse||(this._userZeroTermResponse=n({retryDelayMs:ke,retryCount:4}).catch(e=>{throw this._userZeroTermResponse=void 0,e}))}async getCurrentUserInfo(){return this._get({url:Le+"private/v1/users/current",qosEventName:"EngageDataProvider.GetCurrentUserInfo.Api"}).then(e=>{if(this._validateUser(e.viewer))throw new Error("Invalid user response");return e})}async getDelegateTeamInfo(e){const t=Me(Le+"private/v1/delegateTeams/viewer",e);return this._get({url:t,qosEventName:"EngageDataProvider.GetDelegateTeamInfo.Api",retryDelayMs:ke,retryCount:4}).then(e=>({...e,items:e.items.filter(({owner:e})=>!!this._validateUser(e))}))}async getAudiences(e){const t=Le+"odata/v1/users('{id}')/employeeExperience/storyline/audiences".replace("{id}",e);return this._get({url:t,qosEventName:"EngageDataProvider.GetAudiences.Api",retryDelayMs:ke,retryCount:4}).then(e=>e.value||[])}async getAllDelegateTeams(){return this._delegateTeamPromise||(this._delegateTeamPromise=this._getAllDelegateTeams().catch(e=>{throw this._delegateTeamPromise=void 0,e}))}async _getAllDelegateTeams(){const t=[];let a;do{const e=await this.getDelegateTeamInfo({first:20,skipToken:a});t.push(...e.items),a=e.nextPageSkipToken}while(a);return e._SPKillSwitch.isActivated("d38e4bd7-10f8-4964-b7f9-7f5c80f03376")||t.some(e=>e.viewerIsOwner)||n._AmplifyLogger.getAmplifyLogger().createQosEvent("EngageDataProvider.InvalidDelegateTeamsResponse").logUnexpectedFailure("MissingViewerIsOwner",new Error("MissingViewerIsOwner")),t}async _get({url:e,qosEventName:t,componentAlias:n,retryCount:a=0,retryDelayMs:i=100,_currentRetry:r=0,existingQoS:o}){const s=!W()&&o||this._logger.createEvent({qosEventName:t,componentAlias:n});try{const t=await this._aadHttpClient,n=await t.get(e,F.AadHttpClient.configurations.v1,{headers:{accept:"application/json"}});if(!n.ok)throw new Y(n);const a=await n.json();return s.logSuccess(this._getResponseExtraData(n)),a}catch(o){if(this._shouldRetry(o)&&r<a)return await new Promise(e=>setTimeout(e,i)),this._get({url:e,qosEventName:t,componentAlias:n,retryCount:a,_currentRetry:r+1,existingQoS:W()?void 0:s});if(K()){const e=Y.is(o)||o.message?o:new Error(o);s.logUnexpectedFailure(e)}else if(Y.is(o)){const e=o.response;s.logUnexpectedFailure(o,e?this._getResponseExtraData(e):void 0)}else{const e=o.message?o:new Error(o);s.logUnexpectedFailure(e)}throw o}}_validateUser(e){if(function(e){return void 0!==e.id&&void 0!==e.displayName}(e))return e;{const t=(e.id?!e.displayName&&"MissingDisplayName":"MissingId")||"Unknown";return void n._AmplifyLogger.getAmplifyLogger().createQosEvent("EngageDataProvider.InvalidUserResponse").logUnexpectedFailure(t,new Error(t))}}_validateCommunity(e){if(void 0!==(t=e).id&&void 0!==t.groupId&&void 0!==t.displayName)return e;{const t=(e.id?!e.displayName&&"MissingDisplayName":"MissingId")||"Unknown";return void n._AmplifyLogger.getAmplifyLogger().createQosEvent("EngageDataProvider.InvalidCommunityResponse").logUnexpectedFailure(t,new Error(t))}var t}_shouldRetry(e){return e?.message?.toLowerCase().indexOf("failed to fetch")>-1||Y.is(e)&&(429===e.httpStatusCode||e.httpStatusCode>=500&&e.httpStatusCode<600)}_getResponseExtraData(e){if(!K())return{requestId:e?.headers?.get("X-Request-Id")??void 0,statusCode:e?.status?String(e.status):void 0}}constructor(e){this._logger=new Z("EngageDataProvider"),this._resolvedCommunities={},e.whenFinished(()=>{this._aadHttpClient=e.consume($.AadHttpClientFactory.serviceKey)._getStandardClient("https://www.yammer.com/")})}}Pe.serviceKey=e.ServiceKey.create("sp-vinci-data-provider:EngageDataProvider",Pe);var Te,Ue=f(277),Fe=new RegExp(/(\%[0-9][A-F])|(\%[A-F][0-9])|(\%[A-F][A-F])/g),He=new RegExp(/(\%[0-9][a-f])|(\%[a-f][0-9])|(\%[a-f][a-f])/g);!function(e){e[e.absolute=0]="absolute",e[e.relative=1]="relative",e[e.serverRelative=2]="serverRelative"}(Te||(Te={}));var Re,Ne=function(){function e(e,t){void 0===e&&(e=""),t&&("/"===e[e.length-1]&&"/"===t[0]?e+=t.slice(1):"/"!==e[e.length-1]&&"/"!==t[0]?e=e+"/"+t:e+=t);var n=e.indexOf("//"),a=e.indexOf("/"),i=e.indexOf("?"),r=n>-1&&n<=a?n+"//".length:-1,o=function(e,t){if(t>-1){var n=e.indexOf("/",t);return n>-1?e.slice(0,n):e}return""}(e,r),s=o&&o.slice(r),c=s&&s.split(":")[0],d=i>0?e.slice(o.length,i):e.slice(o.length),l=o?Te.absolute:"/"===d[0]?Te.serverRelative:Te.relative,u=d.split("/");this._originalSearchString=i>0?e.slice(i):"",this.searchParams=new URLSearchParams(this._originalSearchString),this.authority=o,this.domain=s,this.host=c,this.format=l,this.path=d,this.segments=u,this.value=e}return e._getTenantInfoFromPageContext=function(e){var t,n=null!==(t=null==e?void 0:e.legacyPageContext)&&void 0!==t?t:e,a=!Ue.KillSwitch.isActivated("78469d39-5abf-45a7-8609-c4f00dab856b");return e?{isMultiGeo:a?n.isMultiGeoTenant:e.legacyPageContext.isMultiGeoTenant,multiGeoInfo:a?n.multiGeoInfo:e.legacyPageContext.multiGeoInfo,singleTenant:a?n.vanityUrls:e.legacyPageContext.vanityUrls}:void 0},e._getHostFromUrl=function(t){return t?new e(t).domain:t},e._getMySiteAndPortalDomain=function(){var e="-my",t="-admin",n="".concat(window.location.protocol,"//").concat(window.location.hostname),a=window.location.hostname.substr(0,window.location.hostname.indexOf("."));if(Ue.KillSwitch.isActivated("751b021d-5b05-45f0-b649-d8fd0dab3170")||-1===a.indexOf(t))return-1===a.indexOf(e,a.length-e.length)?[n.toString().replace(a,a+e),n]:(i=n.toString().replace(a,a.substring(0,a.length-e.length)),[n,i]);var i,r=a.substring(0,a.length-t.length);return[n.toString().replace(a,r+e),i=n.toString().replace(a,r)]},e.prototype.toString=function(){return this.authority+this.path+this.searchParamString},e.prototype.equals=function(e){return e&&this.toString()===e.toString()},e.prototype.isInternalResource=function(t){var n=this,a=e._getTenantInfoFromPageContext(t);try{if((null==a?void 0:a.isMultiGeo)&&(null==a?void 0:a.multiGeoInfo))return a.multiGeoInfo.some(function(e){return n._isSameHost(e.PortalUrl)||n._isSameHost(e.MySiteHostUrl)||n._isSameHosts(e.AdditionalUrls)});var i=e._getMySiteAndPortalDomain();if(this._isSameHosts(i))return!0;if((null==a?void 0:a.singleTenant)&&(null==a?void 0:a.singleTenant.SingleTenant_AdditionalVanityUrls)&&-1!==a.singleTenant.SingleTenant_AdditionalVanityUrls.split(";").indexOf(this.domain))return!0;if((null==a?void 0:a.singleTenant)&&this._isInternalResourceOfSingleTenant(a.singleTenant))return!0}catch(e){return!1}return!1},e.prototype.setSearchParam=function(e,t){t?this.searchParams.set(e,decodeURIComponent(t.replace(/\+/g," "))):this.searchParams.set(e,t)},Object.defineProperty(e.prototype,"searchParamString",{get:function(){var e,t=null===(e=this.searchParams.toString())||void 0===e?void 0:e.replace(/\+/g,"%20");return t&&this._originalSearchString.match(He)&&(t=t.replace(Fe,function(e){return null==e?void 0:e.toLowerCase()})),t?"?"+t:t},enumerable:!1,configurable:!0}),e.prototype.getQueryParameter=function(e){var t;return null===(t=this.searchParams)||void 0===t?void 0:t.get(e)},e.prototype.removeQueryParameter=function(e){var t;null===(t=this.searchParams)||void 0===t||t.delete(e)},e.prototype._isInternalResourceOfSingleTenant=function(e){return e.SingleTenant_OneDriveUrl===this.domain||e.SingleTenant_PortalUrl===this.domain||e.SingleTenant_TeamSitesUrl===this.domain},e.prototype._isSameHost=function(t){return this.domain.toLowerCase()===e._getHostFromUrl(t).toLowerCase()},e.prototype._isSameHosts=function(e){var t=this;return!!(null==e?void 0:e.some(function(e){return t._isSameHost(e)}))},e}();!function(e){e.FILE_SIZE_EXCEEDED="FILE_SIZE_EXCEEDED",e.INVALID_FILE_TYPE="INVALID_FILE_TYPE",e.FILE_EMPTY="FILE_EMPTY",e.INVALID_CSV_STRUCTURE="INVALID_CSV_STRUCTURE",e.ENCRYPTED_OR_CORRUPTED_FILE="ENCRYPTED_OR_CORRUPTED_FILE",e.UNSUPPORTED_FORMAT="UNSUPPORTED_FORMAT",e.RECIPIENTS_EXCEED="RECIPIENTS_EXCEED",e.PASSWORD_PROTECTED="PASSWORD_PROTECTED",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.UNABLE_TO_FIND_EMAIL_COLUMN="UNABLE_TO_FIND_EMAIL_COLUMN",e.INVALID_DELIMITER="INVALID_DELIMITER"}(Re||(Re={}));class Be{async fetchFileContentWithVersion(e,t,a,i,r){this._validationErrors=new Set;const o=n._AmplifyLogger.getAmplifyLogger().createQosEvent("AudienceFileUpload.GetFileContentWithVersion.Api");try{const n={Authorization:`Bearer ${await this._tokenProvider._getTokenInternal(se,$._AadTokenProviders.preAuthorizedConfiguration,!0)}`,"Content-Type":"application/json",Accept:"application/json"},s=await this._fetchDriveItemVersions(e,t,a,i),c=await this._fetchDriveItem(e,t,a,i);let d=`${se}/v1.0/drives/${c.parentReference.driveId}/items/${a}/content`;s.value[0].id!==r&&(d=`${se}/v1.0/drives/${c.parentReference.driveId}/items/${a}/versions/${r}/content`);const l=await this._fetchFileBlobAndContent(d,n);return o.logSuccess(),{content:l,extension:c.name.split(".").pop()||i.split(".").pop(),currentVersion:r,isValidationPassed:0===this._validationErrors.size,errors:Array.from(this._validationErrors)}}catch(n){return o.logUnexpectedFailure(n.message,n,{siteId:e,webId:t,uniqueId:a,serverAbsoluteUrl:i,versionId:r}),{isValidationPassed:!1,errors:Array.from(this._validationErrors)}}}async processLocalFileContent(e,t){const a=n._AmplifyLogger.getAmplifyLogger().createQosEvent("AudienceFileUpload.GetFileLocalFileContent");try{this._validationErrors=new Set;const n=new Blob([e],{type:e.type});if(this._performFileSizeAndExtensionValidation(e.size,e.name.split(".").pop()),this._validationErrors.size>0)return{isValidationPassed:!1,errors:Array.from(this._validationErrors)};const i=await this._processFileBlob(n);return i.length>t&&this._validationErrors.add(Re.RECIPIENTS_EXCEED),a.logSuccess(),{content:i,extension:e.name.split(".").pop()||"",currentVersion:"",isValidationPassed:0===this._validationErrors.size,errors:Array.from(this._validationErrors)}}catch(e){return this._processError(e),a.logUnexpectedFailure(e.message,e),{isValidationPassed:!1,errors:Array.from(this._validationErrors)}}}async fetchFileContent(e,t){this._validationErrors=new Set;const a=n._AmplifyLogger.getAmplifyLogger().createQosEvent("AudienceFileUpload.GetFileContent.Api");try{const n=new Ne(e.ServerAbsoluteUrl),i=await this._fetchDriveItem(e.SiteId,e.WebId,e.UniqueId,e.ServerAbsoluteUrl),r=e.Extension||i.name.split(".").pop();if(this._performFileSizeAndExtensionValidation(i.size,r),this._validationErrors.size>0)return{isValidationPassed:!1,errors:Array.from(this._validationErrors)};const o=(await this._fetchDriveItemVersions(e.SiteId,e.WebId,e.UniqueId,e.ServerAbsoluteUrl)).value[0].id,s=i["@content.downloadUrl"],c=await this._extractFileContent(n,s,r);return c.length>t&&this._validationErrors.add(Re.RECIPIENTS_EXCEED),a.logSuccess(),{content:c,extension:r,currentVersion:o,isValidationPassed:0===this._validationErrors.size,errors:Array.from(this._validationErrors)}}catch(t){return a.logUnexpectedFailure(t.message,t,{siteId:e.SiteId,webId:e.WebId,uniqueId:e.UniqueId,serverAbsoluteUrl:e.ServerAbsoluteUrl||e.Link}),this._processError(t),{isValidationPassed:!1,errors:Array.from(this._validationErrors)}}}_processError(e){e.message.includes("File is password-protected")&&this._validationErrors.add(Re.PASSWORD_PROTECTED),e.message.includes("Encrypted file missing")&&this._validationErrors.add(Re.ENCRYPTED_OR_CORRUPTED_FILE),0===this._validationErrors.size&&this._validationErrors.add(Re.UNKNOWN_ERROR)}async _fetchDriveItem(e,t,n,a){const i=new Ne(a),r={};if(G()){const e=await this._tokenProvider._getTokenInternal(i.authority,$._AadTokenProviders.preAuthorizedConfiguration,!0);r.Authorization="Bearer "+e}const o={...r,"Content-Type":"application/json",Accept:"application/json"};return await this._vinciDataProvider.get({relativeUrl:`v2.0/sites/${e},${t}/items/${n}/driveItem`,baseUrl:i.authority,telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetDriveItemResponse.Api"}},o)}async _fetchDriveItemVersions(e,t,n,a){const i=new Ne(a),r={};if(G()){const e=await this._tokenProvider._getTokenInternal(i.authority,$._AadTokenProviders.preAuthorizedConfiguration,!0);r.Authorization="Bearer "+e}const o={...r,"Content-Type":"application/json",Accept:"application/json"};return await this._vinciDataProvider.get({relativeUrl:`v2.0/sites/${e},${t}/items/${n}/versions`,baseUrl:i.authority,telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetDriveItemVersionsResponse.Api"}},o)}_performFileSizeAndExtensionValidation(e,t){0===e&&this._validationErrors.add(Re.FILE_EMPTY),e>this._MAX_FILE_SIZE_IN_BYTES&&this._validationErrors.add(Re.FILE_SIZE_EXCEEDED),t&&this._ALLOWED_EXTENSIONS.has(t)||this._validationErrors.add(Re.INVALID_FILE_TYPE)}async _extractFileContent(e,t,n){const a=new $.HttpClientConfiguration($.HttpClient.configurations.v1),i={Authorization:`Bearer ${await this._tokenProvider._getTokenInternal(e.authority,$._AadTokenProviders.preAuthorizedConfiguration,!0)}`};if(n&&this._ExcelExtensionsVariants.has(n))return this._fetchFileBlobAndContent(t,i);const r=await this._httpsClient.fetch(t,a,{method:"GET",headers:i});if(!r.ok)throw new Error(`Failed to fetch file content. Status: ${r.status}`);const o=await r.text();return this._parseCsvOrTxtFile(o)}async _downloadFileBlobContent(e,t){return new Promise((n,a)=>{const i=new XMLHttpRequest;i.open("GET",e);for(const e in t)t.hasOwnProperty(e)&&i.setRequestHeader(e,t[e]);i.responseType="blob",i.onload=()=>{if(i.status>=200&&i.status<300&&i.response)return n(i);{const e=i.getResponseHeader("location");e&&i.status>=300&&i.status<400?this._downloadFileBlobContent(e).then(n).catch(a):a({httpRequest:i,statusCode:i.status,error:"Request for excel file blob Failed"})}},i.onerror=()=>a({httpRequest:i,statusCode:void 0,error:"Network Failed"}),i.send()})}async _fetchFileBlobAndContent(e,t){const n=await this._downloadFileBlobContent(e,t),a=await n.response;return this._processFileBlob(a)}async _processFileBlob(e){const t=await new Response(e).arrayBuffer(),n=await Promise.resolve(f.e(102).then(f.bind(f,5))),a=n.read(new Uint8Array(t),{type:"array"}),i=a.Sheets[a.SheetNames[0]],r=n.utils.sheet_to_json(i,{header:1});if(1===r.length)return this._filterDuplicates(r[0]);const o=[];for(let e=0;e<r.length;e++)r[e][0]&&o.push(r[e][0]);return this._filterDuplicates(o)}_filterDuplicates(e){const t=new Set;return e.filter(e=>!t.has(e)&&(t.add(e),!0))}_parseCsvOrTxtFile(e){const t=/[,;\r\n\t]/;if(!t.test(e))return this._validationErrors.add(Re.INVALID_DELIMITER),[];const n=e.trim().split(t);return this._filterDuplicates(n)}constructor(e){this._ExcelExtensionsVariants=new Set(["xls","xlsx","xlb","xlc","xlsb","xlsm","xlt","xltx","xltm","xlm","xla","xll","xlam","xlw","excel","odc","ods","csv"]),this._MAX_FILE_SIZE_IN_BYTES=5242880,this._ALLOWED_EXTENSIONS=new Set(["csv","txt",...Array.from(this._ExcelExtensionsVariants)]),this._validationErrors=new Set,e.whenFinished(()=>{this._tokenProvider=$._AadTokenProviders.configurable,this._httpsClient=e.consume($.HttpClient.serviceKey),this._vinciDataProvider=e.consume(ee.serviceKey)})}}Be.serviceKey=e.ServiceKey.create("sp-vinci-data-provider:ExcelCsvHandler",Be);const je=Be;function Ve(e){const t={};for(const a in e)if(e.hasOwnProperty(a)){const i=(n=a)?n.charAt(0).toLowerCase()+n.slice(1):n,r=e[a];Array.isArray(r)?t[i]=r.map(e=>"object"==typeof e&&null!==e?Ve(e):e):t[i]="object"==typeof r&&null!==r?Ve(r):r}var n;return t}function ze(e){return Ve(JSON.parse(e))}const Ge={content:"",contentStatus:"New",enabled:!1,version:1},Ke={enabled:!1,version:1},We={content:"",contentStatus:"New",audienceIds:[],enabled:!1,version:1,destinations:[]},qe={content:"",contentStatus:"New",destinations:[],enabled:!1,version:1,isAnnouncement:!1,threadId:"",rawThreadId:"",messageId:"",destination:{destinationId:"",destinationType:1}};class Qe{getPublication(e){const t=e||this._getListItemId();return this._vinciDataProvider.get({relativeUrl:re.replace(ne,t.toString()),telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetPublication.Api"}}).then(this._parsePublicationValues).catch(e=>{throw e})}getPrePublishValidationStatus(e){const n=e??this._getListItemId();return this._vinciDataProvider.get({relativeUrl:t.Uri.concatenate(re.replace(ne,n?.toString()),"GetPrePublishValidationStatus"),telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetPrePublishValidationStatus.Api"}})}amplifyValidate(e){const n=e??this._getListItemId();return this._vinciDataProvider.post({relativeUrl:t.Uri.concatenate(re.replace(ne,n?.toString()),"AmplifyValidate"),telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.AmplifyValidate.Api"}})}async getAmplifyHistory(e){const n=e??this._getListItemId();return this._vinciDataProvider.post({relativeUrl:t.Uri.concatenate(re.replace(ne,n?.toString()),"AmplifyHistory"),telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.AmplifyHistory.Api"}}).then(e=>({...e,transformedResults:(e.results||[]).map((e,t)=>{const n=ze(e.PublicationMetadata);return{...e,id:t,EmailEndpoint:n.endpoints.email??Ge,PublicationMetadata:n,PublicationStatus:e.publishingStatusResponse,SharePointEndpoint:n.endpoints.sharePoint??Ke,TeamsEndpoint:n.endpoints.teams??We,VivaEngageEndpoint:n.endpoints.vivaEngage??qe,Version:1}})}))}validatePublication(e){const n=e??this._getListItemId();return this._vinciDataProvider.post({relativeUrl:t.Uri.concatenate(re.replace(ne,n.toString()),"Validate"),telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.ValidatePublication.Api"}})}getIsPublicationShareLockActiveAsync(e){return this._vinciDataProvider.get({relativeUrl:t.Uri.concatenate("/sitepages/pages({pageId})?$select=CoAuthState".replace(ne,e.toString())),telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetIsPublicationShareLockActiveAsync.Api"}}).then(e=>!!e.CoAuthState?.SharedLockId?.length).catch(e=>{throw e})}updateAudience(e){const t=this._getListItemId(),n=this._pageContext.web.serverRelativeUrl.replace(/\/+$/,"")+"/SitePages",a="/web/GetList(@a1)/Items(@a2)/ValidateUpdateListItem()?@a1='{listUrl}'&@a2='{formId}'".replace("{listUrl}",n).replace("{formId}",t.toString()),i=e.map(e=>({Key:e})),r={bNewDocumentUpdate:!1,checkInComment:null,formValues:(i.length>0?[{FieldName:"_ModernAudienceTargetUserField",FieldValue:JSON.stringify(i)}]:[]).map(e=>({...e,ErrorMessage:null,HasException:!1}))};return this._vinciDataProvider.post({relativeUrl:a,body:JSON.stringify(r),telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.UpdatePublication.Api"}},{"X-HTTP-Method":"POST","OData-Version":"3.0","If-Match":"*"})}fetchAudienceTargetingField(e,t,n){return this._vinciDataProvider.get({relativeUrl:"/web/lists/GetByTitle('Site%20Pages')/fields('7F759147-C861-4CD6-A11F-5AA3037D9634')",baseUrl:t,telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetPublication.Api"}}).then(t=>t.EntityPropertyName?.includes(n)?e:"").catch(e=>"")}getSharePointPageLevel(e){const{baseUrl:t,relativeUrl:n}=this._extractUrls(e);return this._vinciDataProvider.get({relativeUrl:(a=n.replace(/'/g,"''"),`/web/getfilebyserverrelativeurl('${a}')?$select=Level`),baseUrl:t,telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetSharePointPageLevel.Api"}}).then(e=>e.Level).catch(e=>0);var a}getIsContentModerationEnabledForSitePagesLibrary(e){return this._vinciDataProvider.get({relativeUrl:"/Web/Lists/GetByTitle('Site%20Pages')/EnableModeration",baseUrl:e,telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetIsContentModerationEnabledForSitePagesLibrary.Api"}}).then(e=>e.value)}getSharePointAudience(e){const t=JSON.stringify({queryParams:{AllowEmailAddresses:!1,MaximumEntitySuggestions:30,PrincipalType:13,PrincipalSource:15,QueryString:e,UseSubstrateSearch:!0,SharePointGroupID:0}});return this._vinciDataProvider.post({relativeUrl:"/SP.UI.ApplicationPages.ClientPeoplePickerWebServiceInterface.ClientPeoplePickerSearchUser",telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetPublication.Api"},body:t}).then(e=>this.parseUserData(e)).catch(e=>{throw e})}parseUserData(e){const t=[],n=JSON.parse(e.value);for(const e of n)"User"!==e.EntityType&&t.push({userId:this.extractGuidFromString(e.Key),email:e.EntityData.Email,name:e.DisplayText});return t}extractGuidFromString(e){const t=e.match(/(?:[a-z0-9]+-){4}[a-z0-9]+/i);return t?t[0]:e}getPublishingStatus(){const e=this._getListItemId();return this._vinciDataProvider.get({relativeUrl:"/sitepages/pages({pageId})/GetPublishingStatus".replace(ne,e.toString()),telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetPublishingStatus.Api"}}).then(e=>e).catch(e=>{throw e})}updatePublication(e){const t=this._getListItemId(),n=this._stringifyPublicationValues(e);return this._vinciDataProvider.post({relativeUrl:re.replace(ne,t?.toString()),body:JSON.stringify(n),telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.UpdatePublication.Api"}},{"x-http-method":"MERGE"})}repairMissingSharePointDestinationWebIds(e){const t=this._getListItemId();return this._vinciDataProvider.post({relativeUrl:ue(t),body:JSON.stringify({repairItems:e}),telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.RepairMissingSharePointDestinationWebIds.Api"}})}publishPublication(){const e=this._getListItemId();return this._vinciDataProvider.post({relativeUrl:t.Uri.concatenate(re.replace(ne,e?.toString()),"Publish"),telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.PublishPublication.Api"}})}async amplifyPublishPublication(){const n=this._getListItemId(),a=new Headers;if(!e._SPKillSwitch.isActivated("e40a2c22-c519-4712-993f-2aecf56316e2"))try{const e=await this._getRequestDigest();a.set("X-RequestDigest",e)}catch(e){}return this._vinciDataProvider.post({relativeUrl:t.Uri.concatenate(re.replace(ne,n?.toString()),"AmplifyPublish"),telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.AmplifyPublishPublication.Api"}},a)}sendTestEmail(e){const n=this._getListItemId(),a=JSON.stringify(e);return this._vinciDataProvider.post({relativeUrl:t.Uri.concatenate(re.replace(ne,n?.toString()),this._shouldUseStreamingEndpoint()?"SendTestEmailStream":"SendTestEmail"),body:a,telemetry:{qosEventName:this._shouldUseStreamingEndpoint()?"VivaAmplify.VinciPublicationsDataProvider.SendTestEmailStream.Api":"VivaAmplify.VinciPublicationsDataProvider.SendTestEmail.Api"}})}amplifySendTestEmailMessage(e){const n=this._getListItemId();return this._vinciDataProvider.post({relativeUrl:t.Uri.concatenate(re.replace(ne,n?.toString()),"AmplifySendTestEmailMessage"),body:e,telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.AmplifySendTestEmailMessage.Api"}})}getPrimaryTeamsChannelForCampaign(){return e._SPKillSwitch.isActivated("d3b64d76-552d-48b9-9a82-ee67492dbd03")?this._vinciGraphDataProvider.get({relativeUrl:this._getTeamChannelGraphApiUrl(this._pageContext.site.group?.id.toString()),baseUrl:se,telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetPrimaryTeamsChannelForCampaign.Api"}}):(this._primaryTeamsChannelPromise||(this._primaryTeamsChannelPromise=this._vinciGraphDataProvider.get({relativeUrl:this._getTeamChannelGraphApiUrl(this._pageContext.site.group?.id.toString()),baseUrl:se,telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetPrimaryTeamsChannelForCampaign.Api"}})),this._primaryTeamsChannelPromise)}postTestTeamsMessage(n){const a=this._getListItemId();let i="";return this.getPrimaryTeamsChannelForCampaign().then(r=>{i=r?.id??"";const o=JSON.stringify({audienceId:i,...n});return e._SPKillSwitch.isActivated("f0f3f9e2-1c4d-4b3b-9f1f-3b3c8b7b0f9c")?this._vinciDataProvider.post({relativeUrl:t.Uri.concatenate(re.replace(ne,a?.toString()),oe),body:o,telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.PostTestTeamsMessage.Api"}}).then(e=>({...e,PrimaryChannelId:i})):this._postTestMessageToTeams(a,o,i)})}postTestTeamsMessageWithChannelId(e,t){const n=this._getListItemId(),a=JSON.stringify({audienceId:e,...t});return this._postTestMessageToTeams(n,a,e)}amplifySendTestTeamsMessage(e){const n=this._getListItemId(),a=JSON.stringify(e);return this._vinciDataProvider.post({relativeUrl:t.Uri.concatenate(re.replace(ne,n.toString()),"AmplifySendTestTeamsMessage"),body:a,telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.AmplifySendTestTeamsMessage.Api"}})}getIsAmplifySite(e){const t=AbortSignal.timeout(4e3);return this._vinciDataProvider.get({relativeUrl:"/web/Features/GetById(guid'F59E18C0-B7E6-4230-A099-A5E70259D368')",baseUrl:e,telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetIsAmplifySite.Api"},signal:t}).then(e=>!!e.DefinitionId).catch(e=>{throw e})}schedulePublication(e,t,n,a){const i=async()=>{const a=await this._vinciDataProvider.post({relativeUrl:(i=n||this._getListItemId(),`/sitepages/pages(${i})/SchedulePublication`),body:JSON.stringify(e),telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciPublicationsDataProvider.SchedulePublication.Api"}});var i;return{...a,publicationStatus:O[a.publicationStatus]}};return!te()&&a?this._retryWithBackoff(i):i()}amplifySchedule(e,t,n,a){const i=async()=>this._vinciDataProvider.post({relativeUrl:"/sitepages/pages({pageId})/AmplifySchedule".replace(ne,n?n.toString():this._getListItemId().toString()),body:JSON.stringify(e),telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciPublicationsDataProvider.AmplifySchedule.Api"}});return!te()&&a?this._retryWithBackoff(i):i()}cancelSchedulePublication(e,t){return this._vinciDataProvider.post({relativeUrl:(n=t||this._getListItemId(),`/sitepages/pages(${n})/CancelSchedulePublication`),telemetry:{componentAlias:e?.alias,qosEventName:"VivaAmplify.VinciPublicationsDataProvider.CancelSchedulePublication.Api"}}).then(e=>({...e,publicationStatus:O[e.publicationStatus]}));var n}amplifyCancelSchedule(e,t){return this._vinciDataProvider.post({relativeUrl:"/sitepages/pages({pageId})/AmplifyCancelSchedule".replace(ne,t?t.toString():this._getListItemId().toString()),telemetry:{componentAlias:e?.alias,qosEventName:"VivaAmplify.VinciPublicationsDataProvider.AmplifyCancelSchedule.Api"}})}validateSitePermission(e){const t={siteUrl:e};return this._vinciDataProvider.post({relativeUrl:(n=this._getListItemId(),`/sitepages/pages(${n})/SPSiteValidator`),body:JSON.stringify(t),telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.ValidateSitePermission.Api"}}).then(e=>e.value).catch(e=>{throw e});var n}async fetchFileContent(e,t){return this._excelCsvHandler.fetchFileContent(e,t)}async processLocalFileUpload(e,t){return this._excelCsvHandler.processLocalFileContent(e,t)}async fetchFileContentWithVersion(e,t,n,a,i){return this._excelCsvHandler.fetchFileContentWithVersion(e,t,n,a,i)}async processLocalFile(e,t){return this._excelCsvHandler.processLocalFileContent(e,t)}getAudienceSizeEstimateAnalyticsReport(e,t){return this._vinciDataProvider.post({relativeUrl:"v2.1/campaign/oneDrive.GetAudienceSizeEstimate",body:JSON.stringify(e),telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetAudienceSizeEstimateAnalyticsReport.Api"}}).then(e=>e).catch(e=>{throw e})}saveStreams(n,a,i,r){const o=i||this._getListItemId(),s=JSON.stringify(n);return this._vinciDataProvider.post({relativeUrl:t.Uri.concatenate(re.replace(ne,o?.toString()),"/SaveStreams",e._SPFlight.isEnabled(61555)&&!e._SPKillSwitch.isActivated("010fcee8-682a-4e07-a409-6081776af191")&&r?`(sharedLockId='${r})'`:""),body:s,telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.SaveStreams.Api"}})}_extractUrls(e){const t=new URL(e);return{baseUrl:`${t.protocol}//${t.host}${t.pathname.split("/").slice(0,3).join("/")}`,relativeUrl:t.pathname}}_parseTeamsChannelUrl(e){try{if(!/\/l\/channel\//i.test(e))return;const n=new t.Uri(decodeURI(e)),a=n.getQueryAsObject(),i=n.getPathSegments();if(!(a&&a.groupId&&i&&4===i.length&&RegExp(/^19:(.*)@thread\.(.*)$/).test(i[2])))return;return{groupId:a.groupId,threadId:i[2]}}catch(e){return}}_getListItemId(){const e=this._pageContext.listItem;if(!e)throw new Error("list item is not defined");return e.id}async _getRequestDigest(){const e=n._AmplifyLogger.getAmplifyLogger().createQosEvent("Amplify.CampaignPageContext.Event");try{const t=await fetch(this._pageContext.web.serverRelativeUrl.replace(/\/+$/,"")+"/_api/contextinfo",{method:"POST",headers:{Accept:"application/json;odata=verbose","Content-type":"application/json;odata=verbose;charset=utf-8",credentials:"same-origin",cache:"no-cache"}}),n=(await t.json()).d.GetContextWebInformation.FormDigestValue;return e.logSuccess(),n}catch(t){throw e.logUnexpectedFailure("FailedToFetchRequestDigest",t),t}}_parsePublicationValues(t){return{...t,PublicationStatus:t.PublicationStatus,EmailEndpoint:JSON.parse(t.EmailEndpoint),SharePointEndpoint:JSON.parse(t.SharePointEndpoint),PublicationMetadata:JSON.parse(t.PublicationMetadata),TeamsEndpoint:JSON.parse(t.TeamsEndpoint),VivaEngageEndpoint:e._SPKillSwitch.isActivated("226bd28a-333d-413e-ace2-6ce27f675a63")||t.VivaEngageEndpoint?JSON.parse(t.VivaEngageEndpoint):{}}}_stringifyPublicationValues(e){return{EmailEndpoint:JSON.stringify(e.EmailEndpoint),SharePointEndpoint:JSON.stringify(e.SharePointEndpoint),PublicationMetadata:JSON.stringify(e.PublicationMetadata),TeamsEndpoint:JSON.stringify(e.TeamsEndpoint),VivaEngageEndpoint:JSON.stringify(e.VivaEngageEndpoint)}}_getTeamChannelGraphApiUrl(e){return e?`/v1.0/teams/${e}/primaryChannel`:`/v1.0/teams/${this._pageContext.site.id}/primaryChannel`}_build3SSuggestionQuery(t){const n={EntityRequests:[{EntityType:"Channel",Query:{QueryString:t},Filter:{Or:[{Term:{ChannelType:"Shared"}},{Term:{ChannelType:"Standard"}},{Term:{ChannelType:"Private"}}]},Size:10},{EntityType:"Team",Query:{QueryString:t},Size:10}],Cvid:e.Guid.newGuid().toString(),LogicalId:e.Guid.newGuid().toString(),AppName:"Viva Amplify",Scenario:{Name:"PublishToTeams"}};return e._SPFlight.isEnabled(61366)&&(n.EntityRequests.push({EntityType:"Chat",Query:{QueryString:t},Size:10}),n.EntityRequests.push({EntityType:"People",Query:{QueryString:t},Fields:["Id","MRI","DisplayName","EmailAddresses","ImAddress","UserPrincipalName"],Filter:{And:[{Or:[{Term:{PeopleType:"Person"}}]},{Or:[{Term:{PeopleSubtype:"OrganizationUser"}},{Term:{PeopleSubtype:"PendingOrgContact"}},{Term:{PeopleSubtype:"OrgContact"}},{Term:{PeopleSubtype:"MTOUser"}},{Term:{PeopleSubtype:"Guest"}}]}]},Provenances:["Mailbox","Directory","SecurityGroups","ExtendedDirectory"],Size:10})),n}_postTestMessageToTeams(e,n,a){return this._vinciDataProvider.post({relativeUrl:t.Uri.concatenate(re.replace(ne,e?.toString()),oe),body:n,telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.PostTestTeamsMessage.Api"}}).then(e=>({...e,PrimaryChannelId:a}))}async _retryWithBackoff(e){let t=0;for(;t<3;)try{return await e()}catch(e){if(t++,t>=3)throw e;await new Promise(e=>setTimeout(e,200))}throw new Error("Retry attempts exhausted without success")}_shouldUseStreamingEndpoint(){return!e._SPKillSwitch.isActivated("b6e2c1a7-3f4b-4e2a-8c1d-2f7e6a9b1c2d")&&e._SPFlight.isEnabled(1973)}_createGraphRequest(e,t){return{id:`${t}`,method:"GET",url:`${"/teams/{teamId}/channels/{channelId}".replace(ae,e).replace(ie,t)}?select=displayName`}}async _getPrimaryTeamsChannelForTeams(e){if(!e||0===e.length)return[];const t=e.map(({GroupId:e,ThreadId:t})=>this._createGraphRequest(e,t));return(await this._vinciGraphDataProvider.batchCall({batchRequests:t,relativeUrl:le,baseUrl:this._graphEndpoint,telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetPrimaryTeamsChannelForTeams.Api"}})).responses.map(e=>{if(e.body?.error){const e="GetPrimaryTeamName failed";return n._AmplifyLogger.getAmplifyLogger().createQosEvent("VivaAmplify.VinciPublicationsDataProvider.InvalidChannelResponse").logUnexpectedFailure(e,new Error(e),{}),{}}return e.body})}constructor(a){this._graphEndpoint="",this._primaryTeamsChannelPromise=null,this.getRecentSites=t=>{const a=new Headers;return e._SPFlight.isEnabled(61868)&&a.set("Prefer","showEditedSites"),this._vinciSharePointDataProvider.get({relativeUrl:"/_api/v2.1/insights/recentSites?%24top={siteCount}".replace("{siteCount}",20..toString()),baseUrl:this._pageContext.site.absoluteUrl,telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetPublication.Api"},headers:a}).then(e=>{if(!j()){const t=e.value&&e.value?.filter(e=>null===e.sharepointIds?.webId)||[];t.length>0&&n._AmplifyLogger.getAmplifyLogger().createQosEvent("VivaAmplify.VinciPublicationsDataProvider.GetRecentSitesReturnsNullWebId.Api").logUnexpectedFailure("GetRecentSites response has sites with missing webId",new Error(`Found sites with missing webId: ${t.map(e=>e.siteId).join(", ")}`))}return e}).catch(e=>{throw e})},this.resetEndpoint=(e,n)=>{const a=this._getListItemId(),i=JSON.stringify({requestParam:{...e}});return this._vinciDataProvider.post({relativeUrl:t.Uri.concatenate(re.replace(ne,a?.toString()),"ResetEndpoint"),body:i,telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciPublicationsDataProvider.ResetEndpoint.Api"}})},this.loadMailDraft=(e,n)=>{const a=this._getListItemId(),i=JSON.stringify({requestParam:{IsPreview:e}});return this._vinciDataProvider.post({relativeUrl:t.Uri.concatenate(re.replace(ne,a?.toString()),"LoadMailDraft"),body:i,telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciPublicationsDataProvider.LoadMailDraft.Api"}})},this.saveMailDraft=(e,n)=>{const a=this._getListItemId(),i=JSON.stringify({requestParam:{IsOpxContentModified:e}});return this._vinciDataProvider.post({relativeUrl:t.Uri.concatenate(re.replace(ne,a?.toString()),"SaveMailDraft"),body:i,telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciPublicationsDataProvider.SaveMailDraft.Api"}})},this.batchPermissionCheckForTeams=(t,n)=>{const a=[];return(e._SPKillSwitch.isActivated("3c013441-54f1-4dd7-b8af-3d0abeb1600d")?t.channels:t?.channels??[]).forEach(e=>{a.push(this._createGraphRequest(e.groupId,e.threadId))}),this._vinciGraphDataProvider.batchCall({batchRequests:a,relativeUrl:le,baseUrl:this._graphEndpoint,telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciPublicationsDataProvider.CheckIfUserHasPermissionToPostToChannel.Api"}}).then(e=>{const t={};return e.responses.forEach(e=>{if(e.body?.error){const n=e.body?.error.message,a=e.body?.error?.code;t[e.id]="Forbidden"===a||"InsufficientPrivileges"===n?"Forbidden":"NotFound"===a||"NotFound"===n||"Not Found"===n?"NotFound":"HasAccess"}else t[e.id]="HasAccess"}),t}).catch(e=>{throw e})},this.teamsAudienceSearch=t=>{if(e._SPKillSwitch.isActivated("b6569f61-a605-4d47-9a3e-c3e63f526500"))return new RegExp(/^https:\/\/teams\.microsoft\.com\/l\/channel\/(.*)\/(.*)\?groupId=([a-fA-F0-9\-]+)&tenantId=([a-fA-F0-9\-]+)$/).test(t)?this._getAudienceChannelURLSearch(t):this.getTeamsAudienceSuggestions(t);{const e=this._parseTeamsChannelUrl(t);if(e){const{groupId:t,threadId:n}=e;return this._resolveTeamsChannel(t,n).then(he)}return this.getTeamsAudienceSuggestions(t)}},this.getTeamsAudienceSuggestions=async(e,t)=>{const a=await this._vinciSubstrateDataProvider.post({relativeUrl:"/search/api/v1/suggestions",baseUrl:ce,telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetAudienceQuerySearch.Api",componentAlias:t?.alias},body:JSON.stringify(this._build3SSuggestionQuery(e))}),i=function(e,t){const a={channels:[],chats:[],people:[]};return e.forEach(e=>{switch(e.Type){case"Channel":const t=e.Suggestions.map(e=>((e,t)=>({groupId:e.GroupId,name:e.Name,teamName:e.TeamName,threadId:e.ThreadId,source:"3SAPI"}))(e)),i=n._AmplifyLogger.getAmplifyLogger().createQosEvent("Authoring.GetAudience.ZeroChannelResponse");0===t.length?i.logExpectedFailure("zeroResponse",new Error("Empty Channel Response"),me):i.logSuccess(me),a.channels=[...a.channels,...t];break;case"Chat":a.chats=e.Suggestions.map(e=>((e,t)=>({chatMembers:e?.ChatMembers?.map(e=>({displayName:e.DisplayName,mri:e?.MRI,givenName:e.GivenName,surname:e.Surname}))??[],name:e.Name??"",threadId:e.ThreadId,threadType:e.ThreadType,totalChatMembersCount:e.TotalChatMembersCount,source:"3SAPI"}))(e));const r=n._AmplifyLogger.getAmplifyLogger().createQosEvent("Authoring.GetAudience.ZeroChatResponse");0===a.chats.length?r.logExpectedFailure("zeroResponse",new Error("Empty Chat Response"),me):r.logSuccess(me);break;case"People":a.people=e.Suggestions.map(e=>{return{displayName:(t=e).DisplayName,emailAddresses:t.EmailAddresses,id:t.Id,mri:t.Mri,imAddress:t.ImAddress,userPrincipalName:t.UserPrincipalName,source:"3SAPI"};var t});const o=n._AmplifyLogger.getAmplifyLogger().createQosEvent("Authoring.GetAudience.ZeroPeopleResponse");0===a.people.length?o.logExpectedFailure("zeroResponse",new Error("Empty People Response"),me):o.logSuccess(me);break;case"Team":if(z()){const t=pe.N,i=e.Suggestions.map(e=>ge(e,t,"3SAPI")),r=n._AmplifyLogger.getAmplifyLogger().createQosEvent("Authoring.GetAudience.ZeroTeamsResponse");0===i.length?r.logExpectedFailure("zeroResponse",new Error("Empty Teams Response"),me):r.logSuccess(me),a.channels=[...a.channels,...i];break}}}),a}(a.Groups);if(!z()){const e=a.Groups.filter(e=>"Team"===e.Type).flatMap(e=>e.Suggestions).filter(e=>!i.channels?.some(t=>t.groupId===e.GroupId&&t.threadId===e.ThreadId)),t=(await this._getPrimaryTeamsChannelForTeams(e)).map(e=>e.displayName),n=e.map((e,n)=>{const a=t[n];return ge(e,a,"3SAPI-Team")});i.channels=[...n,...i.channels||[]]}if(!V()){const e={alias:t?.alias||"",suggestionsTraceId:a.Instrumentation?.TraceId};i.channels=i.channels?.filter(t=>ve(t,e))||[],i.chats=i.chats?.filter(t=>ye(t,e))||[],i.people=i.people?.filter(t=>Se(t,e))||[]}return i},this._getTeamDetailedResponse=e=>this._vinciGraphDataProvider.get({relativeUrl:e,baseUrl:se,telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetTeamDetailedResponse.Api"}}),this._getTeamsChannel=e=>this._vinciGraphDataProvider.get({relativeUrl:e,baseUrl:se,telemetry:{qosEventName:"VivaAmplify.VinciPublicationsDataProvider.GetTeamsChannel.Api"}}),this._getAudienceChannelURLSearch=e=>{const n=new t.Uri(decodeURI(e)),a=n.getQueryAsObject(),i=n.getPathSegments(),r=i?.[2];return a&&a?.groupId&&i&&4===i.length&&RegExp(/^19:(.*)@thread\.(.*)$/).test(r)?this._resolveTeamsChannel(a.groupId,r).then(he):Promise.resolve(_e)},this._resolveTeamsChannel=(e,t)=>{const n="/v1.0//teams/{teamId}/channels/{channelId}".replace(ae,e).replace(ie,t),a="/v1.0/teams/{teamId}".replace(ae,e);return Promise.allSettled([this._getTeamDetailedResponse(a),this._getTeamsChannel(n)]).then(([t,n])=>{if("fulfilled"!==n.status)throw new Error("Something went wrong while fetching the channel details by URL");const a=n.value,i="fulfilled"===t.status?t.value.displayName:V()?void 0:"",r={groupId:e,name:a.displayName,teamName:i,threadId:a.id,source:"GraphAPI"};if(V()||ve(r))return r})},e.Validate.isNotNullOrUndefined(a,"serviceScope"),a.whenFinished(()=>{this._pageContext=a.consume(H.PageContext.serviceKey),this._vinciDataProvider=a.consume(ee.serviceKey),this._vinciGraphDataProvider=a.consume(fe.serviceKey),this._vinciSubstrateDataProvider=a.consume(Ee.serviceKey),this._graphEndpoint=this._pageContext.legacyPageContext?.farmSettings?.ExternalService_sppagesmsgraphendpoint,this._vinciSharePointDataProvider=a.consume(Ae.serviceKey),this.engageDataProvider=a.consume(Pe.serviceKey),this._excelCsvHandler=a.consume(je.serviceKey),e._SPKillSwitch.isActivated("fe1bf112-c5a3-4dee-a0f3-3d56486e7513")||!this._pageContext||n._AmplifyLogger.getAmplifyLogger().isOneDsLoggerInitialized||n._AmplifyLogger.getAmplifyLogger()?.InitializeLogger(this._pageContext)})}}Qe.serviceKey=e.ServiceKey.create("sp-vinci-data-provider:VinciPublicationsDataProvider",Qe);class Ye{getAccessToken(e,t){const a=n._AmplifyLogger.getAmplifyLogger().createQosEvent("VinciSecureBroker.AADTokenThroughMSAL.Event"),i=t||"VinciSecurebrokerAADTokenDataProvider.getAccessToken";return $._AadTokenProviders.configurable._getTokenInternal(e,$._AadTokenProviders.preAuthorizedConfiguration).then(e=>(a.logSuccess({alias:i}),e)).catch(e=>{throw a.logUnexpectedFailure(e?.message,e,{alias:i}),e})}}Ye.serviceKey=e.ServiceKey.create("sp-vinci-data-provider:VinciSecurebrokerAADTokenDataProvider",Ye);class Je{getCampaignPreaggregatedAnalyticsReport(e,t){return this._vinciDataProvider.post({relativeUrl:"v2.1/campaign/oneDrive.GetCampaignPreaggregatedAnalyticsReport",body:JSON.stringify(e),telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciAnalyticsDataProvider.GetCampaignPreaggregatedAnalyticsReport.Api"}}).then(e=>e.value)}getPublicationPreaggregatedAnalyticsReport(e,t){return this._vinciDataProvider.post({relativeUrl:"v2.1/campaign/oneDrive.GetPublicationPreaggregatedAnalyticsReport",body:JSON.stringify(e),telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciAnalyticsDataProvider.GetPublicationPreaggregatedAnalyticsReport.Api"}}).then(e=>e.value)}constructor(t){e.Validate.isNotNullOrUndefined(t,"serviceScope"),t.whenFinished(()=>{this._vinciDataProvider=t.consume(ee.serviceKey)})}}Je.serviceKey=e.ServiceKey.create("sp-vinci-data-provider:VinciAnalyticsDataProvider",Je);const Xe=e=>`/SitePages/pages(${e})/CreateApprovalRequest`,Ze=e=>`/SitePages/pages(${e})/CheckoutPage`,$e=e=>`/SitePages/pages(${e})/ApproveApprovalRequest`,et=e=>`/SitePages/pages(${e})/RejectApprovalRequest`,tt=e=>`/SitePages/pages(${e})/CancelApprovalRequest`,nt=e=>`/SitePages/pages(${e})/SyncApprovalRequest`,at=e=>e?`${e[0].toLowerCase()}${e.substring(1)}`:"";function it(e){const t=Object.entries(e);return Object.fromEntries(t.map(([e,t])=>[at(e),t]))}function rt(e){return`i:0#.f|membership|${e}`}const ot=new Set(["Approvals_InvalidPublicationStatus","Approvals_CheckedOutByAnotherUser","Approvals_InvalidApprover","Approvals_RequestNotFound"]);class st{static resolveQosAndAshaFromError(e){const{error:t,qosEvent:n,customerPromiseEvent:a,customerPromiseVeto:i,skipASHAFailureLogging:r}=e;return Promise.resolve().then(()=>Y.is(t)?t.campaignErrorInfo:void 0).catch(()=>{}).then(e=>{e?.errorDescription&&ot.has(e?.errorDescription)?(n?.logExpectedFailure(e.errorDescription,t),r?a?.endEvent():a?.endEvent(t,!0)):(n?.logUnexpectedFailure(e?.errorDescription??t?.message,t),r?a?.endEvent():a?.endEvent(t,!1,e?.errorDescription??"API failed",i))})}createApprovalRequest(e,t,n){return this._vinciDataProvider.post({relativeUrl:Xe(e),body:JSON.stringify({creationInfo:this._toApprovalRequestCreationInfoRaw(t)}),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciApprovalsDataProvider.CreateApprovalRequest.Api"}}).then(e=>this._toApprovalState(e))}checkoutAndCreateApprovalRequest(e,t,n){return this._vinciDataProvider.post({relativeUrl:Ze(e),body:JSON.stringify(""),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciApprovalsDataProvider.CheckoutAndCreateApprovalRequest.Api"}}).then(a=>this.createApprovalRequest(e,t,n))}approveApprovalRequest(e,t,n){return this._vinciDataProvider.post({relativeUrl:$e(e),body:JSON.stringify({comment:t}),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciApprovalsDataProvider.ApproveApprovalRequest.Api"}}).then(e=>this._toApprovalState(e))}rejectApprovalRequest(e,t,n){return this._vinciDataProvider.post({relativeUrl:et(e),body:JSON.stringify({comment:t}),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciApprovalsDataProvider.RejectApprovalRequest.Api"}}).then(e=>this._toApprovalState(e))}cancelApprovalRequest(e,t){return this._vinciDataProvider.post({relativeUrl:tt(e),body:JSON.stringify({}),telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciApprovalsDataProvider.CancelApprovalRequest.Api"}}).then(e=>this._toApprovalState(e))}syncApprovalRequest(e,t){return this._vinciDataProvider.post({relativeUrl:nt(e),body:JSON.stringify({}),telemetry:{componentAlias:t?.alias,qosEventName:"VivaAmplify.VinciApprovalsDataProvider.SyncApprovalRequest.Api"}}).then(e=>this._toSyncApprovalRequestResponse(e))}_toApprovalRequestCreationInfoRaw(e){return{Approvers:e.approvers.map(rt),AwaitAll:e.awaitAll,Important:e.important,Message:e.message,DistributionChannel:e.distributionChannels,PublishOption:void 0===e.publishingOption?void 0:this._toTeamsPublishOption(e.publishingOption),SchedulePublishDate:e.schedulePublishDate}}_toSyncApprovalRequestResponse(e){return{approvalRequest:this._toApprovalRequest(JSON.parse(e.ApprovalRequest)),publicationStatus:O[e.PublicationStatus]}}_toApprovalRequest(e){return{...it(e),partnerMetadata:this._toApprovalRequestPartnerMetadata(e.PartnerMetadata),actions:e.Actions.map(e=>this._toApprovalRequestAction(e)),approvers:e.Approvers.map(e=>this._toApprovalRequestUserPrincipal(e)),responses:e.Responses.map(e=>this._toApprovalRequestUserPrincipal(e))}}_toApprovalState(e){return{publicationStatus:O[e.PublicationStatus],approvalStatus:e.ApprovalStatus}}_toApprovalRequestAction(e){return{...it(e),users:e.Users.map(e=>this._toApprovalRequestUserPrincipal(e)),comments:e.Comments??void 0,timestamp:e.Timestamp?new Date(e.Timestamp):void 0}}_toApprovalRequestUserPrincipal(e){return{...it(e),thumbnailPhoto:e.ThumbnailPhoto??void 0}}_toApprovalRequestPartnerMetadata(e){return{vivaAmplifyAdditionalDetails:e.VivaAmplifyAdditionalDetails?this._toApprovalRequestVivaAmplifyAdditionalDetails(e.VivaAmplifyAdditionalDetails):void 0}}_toApprovalRequestVivaAmplifyAdditionalDetails(e){return{...e,distributionChannels:e.distributionChannel?.map(e=>this._toDistributionChannel(e)),publishOption:e.publishOption?this._toPublishingOption(at(e.publishOption)):void 0,scheduledPublishDate:e.scheduledPublishDate?new Date(e.scheduledPublishDate):void 0}}_toDistributionChannel(e){switch(e){case"outlook":return"Outlook";case"sharepoint":return"SharePoint";case"teams":return"Teams";case"yammer":return"VivaEngage"}}_toPublishingOption(e){switch(e){case"scheduledFor":return"Schedule";case"publishOnceApproved":return"Automatic";case"reviewBeforePublish":return"Manual"}}_toTeamsPublishOption(e){switch(e){case"Schedule":return"scheduledFor";case"Automatic":return"publishOnceApproved";case"Manual":return"reviewBeforePublish"}}constructor(t){e.Validate.isNotNullOrUndefined(t,"serviceScope"),t.whenFinished(()=>{this._vinciDataProvider=t.consume(ee.serviceKey)})}}function ct(e,t,n){const a=new Set(e.map(e=>e[n])),i=t.filter(e=>!a.has(e[n]));return[...e.slice(0,3),...i.slice(0,2),...e.slice(3),...i.slice(2)]}st.serviceKey=e.ServiceKey.create("sp-vinci-data-provider:VinciApprovalsDataProvider",st),st.processError=(e,t)=>{Y.is(e)&&e.campaignErrorInfo?e.campaignErrorInfo?.then(n=>{void 0!==n?.errorDescription?ot.has(n.errorDescription)?t.logExpectedFailure(n.errorDescription,e):t.logUnexpectedFailure(n.errorDescription,e):t.logUnexpectedFailure(e?.message,e)}).catch(()=>{t.logUnexpectedFailure(e?.message,e)}):t.logUnexpectedFailure(e?.message,e)};var dt=f(718),lt=f(207);class ut{static applyCacheAndNetwork(e,t,n,a){const i=new lt._QosMonitor(`${n.qosMonitorLabel}.getProcessedResponseInSmartRace`),r=e.serverResponse.then(e=>n.parseHttpClientResponse(e,t,i)).then(e=>{const t=n.isEmptyResponse(e);return ut._executeIfDefined(n,n.onServerResponseResolved,t),e}).catch(e=>{throw ut._executeIfDefined(n,n.onServerResponseFailed,e),e}),o=new lt._QosMonitor(`${n.qosMonitorLabel}.getProcessedCachedResponseInSmartRace`),s=[{raceablePromise:ut.processResponseRawData(e.cachedResponse,n.isRawData,n.processRawData,t,o).then(e=>{const t=n.isEmptyResponse(e);return ut._executeIfDefined(n,n.onCacheResponseResolved,t),e}).catch(e=>{throw o.writeUnexpectedFailure("ParseCacheResultsFailed",e),ut._executeIfDefined(n,n.onCacheResponseFailed,e),e}),raceId:ut._cachedDataPromiseId},{raceablePromise:r,raceId:ut._serverDataPromiseId}];return dt.SmartRace.race(s).then(e=>(e.raceId===ut._cachedDataPromiseId&&r.then(e=>{ut._executeIfDefined(n,n.onServerResponseResolvedWithCache,e)}).catch(()=>{}),a.writeSuccess({cacheStatus:e.raceId===ut._cachedDataPromiseId?"WonRace":"LostRace"}),e.raceablePromise)).catch(e=>{throw a.writeUnexpectedFailure("SmartRaceFailed",e),e})}static applyCacheThenNetwork(e,t,n,a){const i=e.cachedResponse?ut.processResponseRawData(e.cachedResponse,n.isRawData,n.processRawData,t,a):void 0,r=new lt._QosMonitor(`${n.qosMonitorLabel}.getProcessedResponse`),o=e.serverResponse?.then(e=>n.parseHttpClientResponse(e,t,r)).then(e=>{const t=n.isEmptyResponse(e);return ut._executeIfDefined(n,n.onServerResponseResolved,t),e}).catch(e=>{throw ut._executeIfDefined(n,n.onServerResponseFailed,e),e});return i?(i.then(e=>{const t=n.isEmptyResponse(e);ut._executeIfDefined(n,n.onCacheResponseResolved,t),o?(ut._executeIfDefined(n,n.onCacheThenNetworkServerDataReturned,o,!0,t),o.then(e=>{ut._executeIfDefined(n,n.onServerResponseResolvedWithCache,e)}).catch(()=>{})):ut._executeIfDefined(n,n.onCacheThenNetworkServerDataNotReturned,!0,t)}).catch(e=>{ut._executeIfDefined(n,n.onCacheResponseFailed,e)}),i):(a.writeSuccess(),ut._executeIfDefined(n,n.onCacheThenNetworkServerDataReturned,o,!1,!0),o)}static executeCacheStrategy(e,t,n){const a=new lt._QosMonitor(`${e.qosMonitorLabel}.getData`);return t(n).then(t=>{if(t instanceof Response||t?.nativeResponse instanceof Response)return e.parseHttpClientResponse(t,n,a).then(t=>{const n=e.isEmptyResponse(t);return ut._executeIfDefined(e,e.onServerResponseResolved,n),t}).catch(t=>{throw ut._executeIfDefined(e,e.onServerResponseFailed,t),t});const i=t;return i.serverResponse&&i.cachedResponse?ut.applyCacheAndNetwork(i,n,e,a):i.cachedResponse||i.serverResponse?ut.applyCacheThenNetwork(i,n,e,a):ut.processResponseRawData(Promise.resolve(t),e.isRawData,e.processRawData,n).then(t=>(a.writeSuccess(),ut._executeIfDefined(e,e.onCacheResponseResolved,!!t),t)).catch(t=>{throw a.writeUnexpectedFailure("Error Processing cached data",t),ut._executeIfDefined(e,e.onCacheResponseFailed,t),t})}).catch(e=>{throw a.hasEnded||a.writeUnexpectedFailure("Excecute Request failed",e),e})}static processResponseRawData(e,t,n,...a){return e.then(e=>t(e)?n(e,...a):e)}}function ft(e){return"undefined"!=typeof window&&"function"==typeof window.TextEncoder?(new window.TextEncoder).encode(e):self&&"function"==typeof self.TextEncoder?(new self.TextEncoder).encode(e):new Uint8Array(function(e){const t=[];for(let n=0;n<e.length;n++){let a=e.charCodeAt(n);a<128?t.push(a):a<2048?t.push(192|a>>6,128|63&a):a<55296||a>=57344?t.push(224|a>>12,128|a>>6&63,128|63&a):(n++,a=65536+((1023&a)<<10|1023&e.charCodeAt(n)),t.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|63&a))}return t}(e))}ut.useStalePropName="useStale",ut.enableDataPrefetch="enableDataPrefetch",ut.dataPrefetchKey="dataPrefetchKey",ut.parentKeyOverride="parentKeyOverride",ut.onlyIndexedDB="onlyIndexedDB",ut.onlyMySiteCache="onlyMySiteCache",ut.cacheKeyOverride="cacheKeyOverride",ut.mySiteCacheConfiguration="mySiteCacheConfiguration",ut.defaultWebPartCachePath="WebPartCache",ut.prefetchUpdateOptions="prefetchUpdateOptions",ut._cachedDataPromiseId=e.Guid.parse("9b794e3a-a041-4fb4-870d-a1121ca57ca7"),ut._serverDataPromiseId=e.Guid.parse("4d757517-a42f-4546-a76a-8d0da7dd2a07"),ut._executeIfDefined=(e,t,...n)=>{if(t)return t.apply(e,n)};const pt="TieredCacheHelper";class mt{static getAppCacheDataProvider(e){return e.consume((0,$._getCacheDataProviderServiceKey)())._provider}static getPrefetchDataProvider(e){return e.consume((0,$._getPrefetchDataProviderServiceKey)())._provider}static generateCacheKey(...e){const t=[];return e.forEach(e=>{"string"==typeof e?t.push(e.toUpperCase()):t.push(mt._serializeMap(e))}),function(e){let t=!1;return"undefined"!=typeof window?(t=!window.crypto&&!!window.msCrypto,t?function(e){const t=window.msCrypto,n=ft(e);return new Promise((e,a)=>{const i=t.subtle.digest("SHA-256",n);i.oncomplete=t=>{const n=Array.from(new Uint8Array(t.target.result)).map(e=>e.toString(16).padStart(2,"0")).join("");e(n)},i.onerror=e=>{!function(e,t){const{message:n}=e;t({message:n})}(e,a)}})}(e):function(e){return async function(e){const t=ft(e);return await window.crypto.subtle.digest("SHA-256",t)}(e).then(e=>Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join(""))}(e)):Promise.reject()}(t.sort().join(","))}static getItem(e,t,n,a){const i=new lt._QosMonitor(`${pt}.${t}.getItem`);return n.getData(e,a).then(e=>(i.writeSuccess(),Promise.resolve(e.data))).catch(e=>(i.writeUnexpectedFailure("GetTieredCacheFailed",e),Promise.reject(e)))}static getItemVerbose(e,t,n,a){const i=new lt._QosMonitor(`${pt}.${t}.getItemVerbose`);return n.getData(e,a).then(e=>(i.writeSuccess(),Promise.resolve(e))).catch(e=>(i.writeUnexpectedFailure("GetTieredCacheFailed",e),Promise.reject(e)))}static setItem(e,t,n,a,i){const r=new lt._QosMonitor(`${pt}.${n}.setItem`);return a.setData(e,t,i).then(()=>(r.writeSuccess(),Promise.resolve())).catch(e=>(r.writeUnexpectedFailure("SetItemFailed",e),Promise.reject(e)))}static getWebPartDefaultCachePath(e){return`/${mt.defaultWebPartCachePath}/${e}`}static _serializeMap(e){const t=e instanceof Array;return Object.keys(e).map(n=>{const a=t?"":n.toUpperCase();return e[n]instanceof Object?a+mt._serializeMap(e[n]):a+`${e[n]}`.toUpperCase()}).sort().reduce((e,t)=>e+t,"")}}mt.useStalePropName="useStale",mt.enableDataPrefetch="enableDataPrefetch",mt.dataPrefetchKey="dataPrefetchKey",mt.parentKeyOverride="parentKeyOverride",mt.onlyIndexedDB="onlyIndexedDB",mt.onlyMySiteCache="onlyMySiteCache",mt.cacheKeyOverride="cacheKeyOverride",mt.mySiteCacheConfiguration="mySiteCacheConfiguration",mt.defaultWebPartCachePath="WebPartCache",mt.prefetchUpdateOptions="prefetchUpdateOptions";class _t extends class{getData(e,t,n){const a={parseHttpClientResponse:this.parseHttpClientResponse,isRawData:this.isRawData,isEmptyResponse:this.isEmptyResponse,processRawData:this.processRawData,qosMonitorLabel:n},i={apiRequest:e,args:t};return ut.executeCacheStrategy(a,this._execute.bind(this),i)}_execute(e){try{return this._getFlushedData(e.args).then(t=>(setTimeout(()=>$._CacheManager.fetchAndCache({key:this._cacheKey},this._tieredCache,this._cacheOptions,()=>e.apiRequest(...e.args)),0),t))}catch(t){return $._CacheManager.fetchAndCache({key:this._cacheKey},this._tieredCache,this._cacheOptions,()=>e.apiRequest(...e.args))}}_initializeTieredCache(){return mt.getAppCacheDataProvider(this._serviceScope)}_getFlushedData(e){const t=window[this._prefetchKey],n=this._logger.createEvent({qosEventName:"VivaAmplify.VinciCacheDataProvider.ParsePrefetchData.Api",componentAlias:"VinciCacheDataProvider"});try{if(t&&t.Items&&t.Items[this._cacheKey]){const a=t.Items[this._cacheKey];if(a&&a.Value){const t=JSON.parse(a.Value),i=this.processRawData(t,e);return n.logSuccess(),Promise.resolve(i)}throw new Error("Parsing Error Cache item does not contain data")}throw new Error("No flushed data found")}catch(e){throw n.logUnexpectedFailure(e),e}}constructor(e,t){this._cacheAlias="VivaAmplify_Data",this._prefetchKey="_spVivaAmplifyPublicationPrefetchData",this._serviceScope=e,this._cacheKey=t;const n=new Map;e.whenFinished(()=>{this._tieredCache=this._initializeTieredCache(),this._pageContext=e.consume(H.PageContext.serviceKey),this._logger=new Z;const t={folderPath:`${this._cacheAlias}/CampaignCache/${this._pageContext.site.id.toString()}`};n.set(mt.mySiteCacheConfiguration,t),this._cacheOptions={alias:this._cacheAlias,id:this._pageContext.site.id.toString(),expirationDuration:6e3,cacheStrategy:$._CacheStrategy.NetworkOnly,extraProps:n}})}}{_retrieveVroomItems(t){const n=[];return t&&t?.value&&t.value.map(t=>{const a=t.groupId&&"00000000-0000-0000-0000-000000000000"!==t.groupId;if("APP"!==t.template?.name&&(e._SPKillSwitch.isActivated("6a848899-9020-4227-9a62-01df28c4c869")||"STS"!==t.template?.name)){const e={Acronym:t.resourceVisualization.acronym,BannerColor:t.resourceVisualization.color,BannerImageUrl:t.resourceVisualization.previewImageUrl,DepartmentId:t.sharepointIds.hubSiteId,ItemReference:{...a?{GroupId:t.groupId}:{},WebId:t.sharepointIds.webId,IndexId:parseInt(t.exchangeIds.documentId,10)||0,SiteId:t.sharepointIds.siteId,Type:a?"GroupReference":"SiteReference"},Url:t.webUrl,Type:a?"Group":"Site",Title:t.title};we()&&(e.IsAudienceTargetingEnabled=!1),n.push(e)}}),n}_removeCurrentSiteFromSharepointSearchSuggestions(e){e&&e.value&&(e.value=e.value.filter(e=>!window.location.href.includes(e.webUrl)))}constructor(t){super(t,_t._cacheKey),this.qosMonitorLabel="VivaAmplify.Cache.Suggestions",this.getSmartAudienceSelector=()=>{const t=e._SPKillSwitch.isActivated("c5063d6f-caf8-4513-be14-0cb4bcfc9150")?void 0:[];return this.getData(this._audienceSearch,t,"VivaAmplify.Cache.SmartAudienceSelector")},this.parseHttpClientResponse=e=>e.json().then(e=>this.processRawData(e)),this.isRawData=e=>null!==e&&"object"==typeof e,this.isEmptyResponse=e=>{const t=e?.sharepoint.sites;return!e||0===(e.teams?.channels?.length??0)&&0===(e.teams?.chats?.length??0)&&0===(e.teams?.people?.length??0)&&0===t?.length},this.processRawData=e=>e,this.formatRawSiteData=t=>t.reduce((t,n)=>{const a={siteId:n.ItemReference.SiteId,siteName:n.Title,siteUrl:n.Url,...e._SPFlight.isEnabled(62191)?{webId:n.ItemReference.WebId}:{}};return we()&&(a.imageUrl=n.BannerImageUrl,a.isAudienceTargetingEnabled=n.IsAudienceTargetingEnabled),t.push(a),t},[]),this._audienceSearch=async()=>{const t=this._zeroTermLogger.createEvent({qosEventName:"VivaAmplify.VinciZeroTermSuggestionDataProvider.SmartAudience.Api",componentAlias:"VinciZeroTermSuggestionDataProvider"}),n=await Promise.allSettled([this._vinciPublicationsDataProvider.getTeamsAudienceSuggestions("",{alias:"SmartAudienceSelector"}),this._vinciCampaignsDataProvider.getPublishedAudiences({alias:"SmartAudienceSelector"}),this._vinciPublicationsDataProvider.getRecentSites({alias:"SmartAudienceSelector"})]).then(n=>{if(3!==n.length)throw new Error("Invalid number of responses");let a={teams:_e,sharepoint:[]};const i=n[0],r=n[1];if("fulfilled"===r.status?a=r.value:t.logUnexpectedFailure(r.reason),"fulfilled"===i.status){const e=i.value;a.teams={channels:ct(a.teams?.channels??[],e.channels,"threadId"),chats:ct(a.teams?.chats??[],e.chats,"threadId"),people:ct(a.teams?.people??[],e.people,"id")},a.teams.channels.forEach(e=>{e.source="Cache"}),a.teams.chats.forEach(e=>{e.source="Cache"}),a.teams.people.forEach(e=>{e.source="Cache"}),t.logSuccess()}else t.logUnexpectedFailure(i.reason);const o=n[2],s=a.sharepoint.sites;return"fulfilled"===o.status?(e._SPKillSwitch.isActivated("9045ebe9-dfa4-483d-a5a1-38d3ffc01684")||this._removeCurrentSiteFromSharepointSearchSuggestions(o.value),a.sharepoint={sites:ct(s??[],this.formatRawSiteData(this._retrieveVroomItems(o.value))??[],"siteId")}):t.logUnexpectedFailure(o.reason),a}).catch(e=>(t.logUnexpectedFailure(e),be)),a=new Response(JSON.stringify(n),{status:200,statusText:"OK"});return Promise.resolve(a)},e.Validate.isNotNullOrUndefined(t,"serviceScope"),t.whenFinished(()=>{this._vinciCampaignsDataProvider=t.consume(Oe.serviceKey),this._vinciPublicationsDataProvider=t.consume(Qe.serviceKey),this._zeroTermLogger=new Z})}}_t.serviceKey=e.ServiceKey.create("sp-vinci-data-provider:VinciSubstrateDataProvider",_t),_t._cacheKey="Suggestions";class ht{get _groupId(){return this._pageContext.site.group?.id.toString()??""}getCampaignGroupMembers(){return this._vinciGraphDataProvider.get({relativeUrl:o(this._groupId),baseUrl:se,telemetry:{componentAlias:"getCampaignGroupMembers",qosEventName:"VivaAmplify.VinciCampaignMembersDataProvider.GetCampaignGroupMembers.Api"}}).then(e=>e.value)}constructor(t){e.Validate.isNotNullOrUndefined(t,"serviceScope"),t.whenFinished(()=>{this._pageContext=t.consume(H.PageContext.serviceKey),this._vinciGraphDataProvider=t.consume(fe.serviceKey)})}}ht.serviceKey=e.ServiceKey.create("sp-vinci-data-provider:VinciPublicationsDataProvider",ht);class bt{ensureTeam(e){return this._vinciDataProvider.post({relativeUrl:"GroupSiteManager/EnsureTeamForGroupEx",telemetry:{componentAlias:e?.alias,qosEventName:"VivaAmplify.VinciTeamsDataProvider.EnsureTeam.Api"}})}installApp(t,n){return e.Validate.isNonemptyString(t,"teamsAppId"),this._vinciGraphDataProvider.post({relativeUrl:(a=this._getGroupId(),`v1.0/teams/${a}/installedApps`),body:JSON.stringify({"teamsApp@odata.bind":t}),telemetry:{componentAlias:n?.alias,qosEventName:"VivaAmplify.VinciTeamsDataProvider.InstallApp.Api"}});var a}getInstalledApps(e){return this._vinciGraphDataProvider.get({relativeUrl:(t=this._getGroupId(),`v1.0/teams/${t}/installedApps?$expand=teamsAppDefinition`),telemetry:{componentAlias:e?.alias,qosEventName:"VivaAmplify.VinciTeamsDataProvider.GetInstalledApps.Api"}}).then(e=>e.value);var t}getPrimaryChannel(e){return this._vinciGraphDataProvider.get({relativeUrl:(t=this._getGroupId(),`v1.0/teams/${t}/primaryChannel`),telemetry:{componentAlias:e?.alias,qosEventName:"VivaAmplify.VinciTeamsDataProvider.GetPrimaryChannel.Api"}});var t}_getGroupId(){const e=this._pageContext.site.group?.id.toString();if(!e)throw new Error("Unable to find ID of group in page context.");return e}constructor(t){e.Validate.isNotNullOrUndefined(t,"serviceScope"),t.whenFinished(()=>{this._pageContext=t.consume(H.PageContext.serviceKey),this._vinciDataProvider=t.consume(ee.serviceKey),this._vinciGraphDataProvider=t.consume(fe.serviceKey)})}}var gt,vt,yt,St;bt.serviceKey=e.ServiceKey.create("sp-vinci-data-provider:VinciTeamsDataProvider",bt),function(e){e[e.Draft=0]="Draft",e[e.Publishing=1]="Publishing",e[e.Published=2]="Published",e[e.NeedsAttention=3]="NeedsAttention",e[e.PendingApproval=4]="PendingApproval",e[e.Rejected=5]="Rejected",e[e.ReadyToPublish=6]="ReadyToPublish",e[e.Scheduled=7]="Scheduled"}(gt||(gt={})),function(e){e[e.Active=0]="Active",e[e.Canceled=1]="Canceled",e[e.Rejected=2]="Rejected",e[e.Approved=3]="Approved"}(vt||(vt={})),function(e){e[e.NotSubmitted=0]="NotSubmitted",e[e.Pending=1]="Pending",e[e.Rejected=2]="Rejected",e[e.Approved=3]="Approved"}(yt||(yt={})),function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.Important=2]="Important"}(St||(St={}));const Dt=e=>"Owner"===e,It=e=>"Approver"===e||Dt(e),xt=e=>"Contributor"===e||It(e),Ct=e=>"Visitor"===e||xt(e),Ot="unknown-error",wt="QosEventHandler";class Et{static is(e){return"object"==typeof e&&null!==e&&"name"in e&&e.name===wt}get endLogged(){return this._endLogged}mergeLogData(e){this.logData={...this.logData,...e}}logSuccess(e){this.endLogged||(this.qosEvent.logSuccess({...this.logData,...e}),this._endLogged=!0)}logExpectedFailure(e,t,n){this.endLogged||(this.qosEvent.logExpectedFailure(e,t,{...this.logData,...n}),this._endLogged=!0)}logUnexpectedFailure(e,t,n){this.endLogged||(this.qosEvent.logUnexpectedFailure(e,t,{...this.logData,...n}),this._endLogged=!0)}constructor(e,t){this.name=wt,this._endLogged=!1,this.qosEvent=e,this.logData=t}}function At(e){e()}let Lt;class kt{static startQosEvent(e){return new kt(At,"qosEventName"in e?n._AmplifyLogger.getAmplifyLogger().createQosEvent(e.qosEventName):e.qosEvent,e)}static startWithoutQosEvent(){return new kt(At)}get qosEvent(){return this.qosEventHandler?.qosEvent}then(e,t){return new kt((n,a)=>{this._innerPromise.then(e&&(t=>e(t,this.qosEventHandler)),t&&(e=>t(e,this.qosEventHandler))).then(n,a)},this.qosEventHandler,this.qosHandlingOptions)}catch(e){return new kt((t,n)=>{this._innerPromise.catch(e&&(t=>e(t,this.qosEventHandler))).then(t,n)},this.qosEventHandler,this.qosHandlingOptions)}finally(e){return new kt((t,n)=>{this._innerPromise.finally(e&&(()=>e(this.qosEventHandler))).then(t,n)},this.qosEventHandler,this.qosHandlingOptions)}withErrorHandling(e){return this.then(e=>(this._logSuccessForResolve(),e)).catch((t,n)=>{const a={error:t};return this._deriveErrorContextInformation(a).then(()=>this._getErrorHandler(a,e)).then(e=>Promise.resolve().then(()=>e(a.error,a.campaignErrorInfo,n)).catch(e=>{throw this._updateContextForHandlerError(a,e),e})).then(e=>(this._logExpectedFailureForHandledError(a.errorType,t),e)).catch(i=>(this._logUnexpectedFailureForFallback(a.errorType??Ot,t,{...a.logData,__internalError:i?.message}),e.fallback(t,a.campaignErrorInfo,n)))})}withErrorLogging(e){return this.then(e=>(this._logSuccessForResolve(),e)).catch((t,n)=>{const a={error:t};return this._deriveErrorContextInformation(a).then(()=>{if(!a.errorType||!e?.includes(a.errorType))throw new Error("Given error type is not expected.");this._logExpectedFailureForHandledError(a.errorType,t)}).catch(e=>{this._logUnexpectedFailureForFallback(a.errorType??Ot,t,{...a.logData,__internalError:e?.message})}).finally(()=>{throw t})})}thenWithRetries(e,t,n){return t<=0?this.then(e):this.then(e).catch(a=>{if(n){const i={error:a};return this._deriveErrorContextInformation(i).catch(()=>{throw a}).then(()=>{if(i.errorType&&n.includes(i.errorType))return this.thenWithRetries(e,t-1,n);throw a})}return this.thenWithRetries(e,t-1,n)})}_deriveErrorContextInformation(e){return Y.is(e.error)&&e.error.campaignErrorInfo?e.error.campaignErrorInfo.then(t=>{if(e.campaignErrorInfo=t,e.errorType=t?.errorDescription,!e.errorType)throw e.errorType="null-error-code",new Error("Error type was null")}):X.is(e.error)?(e.errorType=e.error.errorType,Promise.resolve()):Promise.reject(new Error("Error was not of type HttpClientErrorResponse or campaignErrorInfo was falsy."))}_getErrorHandler(e,t){const n=t[e.errorType];if(n)return n;throw new Error("No error handler")}_logSuccessForResolve(e){this.qosHandlingOptions?.shouldNotLogSuccess||this.qosEventHandler?.logSuccess(e)}_updateContextForHandlerError(e,t){e.logData={...e.logData,__failingHandler:e.errorType},e.errorType="error-handler-threw-error"}_logExpectedFailureForHandledError(e,t,n){this.qosHandlingOptions?.shouldNotLogExpectedFailure||this.qosEventHandler?.logExpectedFailure(e,t,n)}_logUnexpectedFailureForFallback(e,t,n){this.qosHandlingOptions?.shouldNotLogUnexpectedFailure||this.qosEventHandler?.logUnexpectedFailure(e,t,n)}constructor(e,t,n){this[Lt]="Promise",this._innerPromise=new Promise(e),Et.is(t)?(this.qosEventHandler=t,n?.alias&&this.qosEventHandler.mergeLogData({alias:n.alias})):this.qosEventHandler=t&&new Et(t,void 0!==n?.alias?{alias:n.alias}:void 0),this.qosHandlingOptions=n}}function Mt(t){return new Promise(n=>{const a=e.Guid.newGuid();t.context.instanceId=a,setTimeout(()=>{t.context.instanceId&&a.equals(t.context.instanceId)&&n()},t.delay)})}function Pt(t,n,a){return e._SPFlight.isEnabled(t)||e._SPFlight.isEnabled(n)&&a}Lt=Symbol.toStringTag;const Tt=(e,t)=>{let n=t.message??"Network Request Failed";if(t.httpStatusCode)switch(t.httpStatusCode){case 401:n="Unauthorized";break;case 403:n="Forbidden";break;case 404:n="Not Found";break;case 500:n="Internal Server Error";break;default:n=`Unknown Error: ${t.httpStatusCode}`}return`${e} - ${n}`};function Ut(e){return"object"==typeof e&&null!==e&&"errors"in e&&Array.isArray(e.errors)&&"warnings"in e&&Array.isArray(e.warnings)&&"messages"in e&&Array.isArray(e.messages)}function Ft(e,t){const n=e.toLowerCase(),a=t.toLowerCase();return n===a||n.startsWith(a+".")}function Ht(e){return e.errors.concat(e.warnings).concat(e.messages)}function Rt(e){if(0===e.length)return"";if(1===e.length)return e[0];const t=e[0].split(".");let n=t.length;for(const a of e.slice(1)){const e=a.split(".");n=Math.min(n,e.length);for(let a=0;a<n;a++)t[a].toLowerCase()===e[a].toLowerCase()&&(n=a)}return 0===n?"":t.slice(0,n).join(" ")}const Nt=["abort","failed to fetch","network","noconnection","offline"];function Bt(e){if(e){if("object"==typeof e&&null!==e&&"status"in e){const t=e;if("number"==typeof t.status)return t.status}if("object"==typeof e&&null!==e&&"response"in e){const t=e;if(t.response&&"number"==typeof t.response.status)return t.response.status}}}function jt(e){if(!q()&&void 0!==window?.navigator&&!window?.navigator.onLine)return!0;if(!e||"object"!=typeof e)return!1;const t=q()?void 0:e.message||e.code;return!!(e instanceof TypeError&&(q()||t&&Nt.some(e=>t.toLowerCase().includes(e))))||e instanceof Error&&"AbortError"===e.name}})(),b})())})();