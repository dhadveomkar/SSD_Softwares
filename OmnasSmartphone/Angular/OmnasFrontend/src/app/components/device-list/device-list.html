<div class="dashboard-container">
  <h1>Omnas Device Inventory</h1>

  <div class="stats-grid">
    <div class="stat-card blue">
      <div class="stat-value">{{ totalDevices }}</div>
      <div class="stat-label">Total Inventory</div>
    </div>
    <div class="stat-card green">
      <div class="stat-value">{{ smartphones.length }}</div>
      <div class="stat-label">Smartphones</div>
    </div>
    <div class="stat-card purple">
      <div class="stat-value">{{ tablets.length }}</div>
      <div class="stat-label">Tablets</div>
    </div>
    <div class="stat-card orange">
      <div class="stat-value">{{ wearables.length }}</div>
      <div class="stat-label">Wearables</div>
    </div>
  </div>

  <div class="analytics-row" *ngIf="isLoaded">
    <div class="chart-section card-style">
       <h3>OS Distribution</h3>
       <div class="canvas-wrapper">
          <canvas baseChart [data]="osChartData" [options]="osChartOptions" [type]="'pie'"></canvas>
       </div>
    </div>

    <div class="health-tiles-section">
      <div class="health-card green-glow" (click)="filterByStatus('green')">
        <div class="health-icon">✓</div>
        <div class="health-info">
          <span class="count">{{ getCountByStatus('green') }}</span>
          <span class="label">Healthy</span>
        </div>
      </div>

      <div class="health-card yellow-glow" (click)="filterByStatus('yellow')">
        <div class="health-icon">!</div>
        <div class="health-info">
          <span class="count">{{ getCountByStatus('yellow') }}</span>
          <span class="label">Idle</span>
        </div>
      </div>

      <div class="health-card red-pulse" (click)="filterByStatus('red')">
        <div class="health-icon">✘</div>
        <div class="health-info">
          <span class="count">{{ getCountByStatus('red') }}</span>
          <span class="label">Critical</span>
        </div>
      </div>
    </div>
    </div>

  
  <div class="add-device-section">
    <button class="btn-primary main-add-btn" (click)="showForm = !showForm">
      <span class="icon">{{ showForm ? '×' : '+' }}</span>
      {{ showForm ? 'Cancel' : 'Add New Device' }}
    </button>

    <div class="form-container" [class.expanded]="showForm">
      <div class="glass-form">
        <div class="form-row">
          <div class="input-group">
            <label>Category</label>
            <select [(ngModel)]="selectedCategory">
              <option value="smartphone">Smartphone</option>
              <option value="tablet">Tablet</option>
              <option value="wearable">Wearable</option>
            </select>
          </div>

          <div class="input-group">
            <label>Device Name</label>
            <input type="text" [(ngModel)]="newDevice.deviceName" placeholder="e.g. Galaxy S24">
          </div>

          <div class="input-group">
            <label>OS Version</label>
            <input type="text" [(ngModel)]="newDevice.osVersion" placeholder="e.g. Android 14">
          </div>

          <div class="input-group btn-align">
            <button class="btn-save" [disabled]="!isDeviceValid(newDevice)"
              [style.opacity]="isDeviceValid(newDevice) ? 1 : 0.5" (click)="submitDevice()">
              Save to Cloud
            </button>
          </div>
        </div>

        <p *ngIf="!isDeviceValid(newDevice) && (newDevice.deviceName || newDevice.osVersion)"
          style="color: #ff4d4d; font-size: 0.75rem; margin-top: 10px; text-align: left;">
          * Please fill in both Name and OS version to save.
        </p>
      </div>
    </div>
  </div>

  <div class="export-actions">
    <button class="btn-export excel" (click)='exportToExcel()'>
      <i class="icon-excel"></i> Export Excel
    </button>
    <button class="btn-export pdf" (click)='exportToPDF()'>
      <i class="icon-pdf"></i> Export PDF
    </button>
  </div>

  <div class="device-section combined-inventory" *ngIf="isLoaded && filteredDevices.length > 0">
    <h2 class="section-title">All Registered Devices</h2>
    <div class="device-grid">
      <div *ngFor="let device of filteredDevices; let i = index" class="device-card" [class.animate-in]="isLoaded"
        [style.animation-delay]="i * 30 + 'ms'">

        <div class="category-badge" [ngClass]="device.category">
          {{ device.category | titlecase }}
        </div>

        <ng-container *ngIf="editingDeviceId !== device.id">
          <h3>{{ device.deviceName }}</h3>
          <p>OS: {{ device.osVersion }}</p>
          <small>Last Sync: {{ device.lastSync | date:'short' }}</small>
          <div class="card-actions">
            <button class="btn-edit" (click)="onEdit(device)">Edit</button>
            <button class="btn-delete" (click)="onDelete(device.category, device.id)">Delete</button>
          </div>
        </ng-container>

        <div *ngIf="editingDeviceId === device.id" class="edit-mode">
          <input [(ngModel)]="device.deviceName" class="edit-input">
          <input [(ngModel)]="device.osVersion" class="edit-input">
          <div class="edit-buttons">
            <button class="btn-save-sm" (click)="onSaveEdit(device.category, device)">Save</button>
            <button class="btn-cancel-sm" (click)="editingDeviceId = null">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </div>



  <div class="search-wrapper">
    <input type="text" [(ngModel)]="searchText" placeholder="Search devices..." class="search-input" />
  </div>

  <div class="device-section" *ngIf="filteredSmartphones.length > 0">
    <h2 class="section-title">Smartphones</h2>
    <div class="device-grid">
      <div *ngFor="let device of filteredSmartphones; let i = index" class="device-card" [class.animate-in]="isLoaded"
        [style.animation-delay]="i * 50 + 'ms'">

        <ng-container *ngIf="editingDeviceId !== device.id">
          <h3>{{ device.deviceName }}</h3>
          <p>OS: {{ device.osVersion }}</p>
          <small>Last Sync: {{ device.lastSync | date:'short' }}</small>
          <div class="card-actions">
            <button class="btn-edit" (click)="onEdit(device)">Edit</button>
            <button class="btn-delete" (click)="onDelete('smartphone', device.id)">Delete</button>
          </div>
        </ng-container>

        <div *ngIf="editingDeviceId === device.id" class="edit-mode">
          <input [(ngModel)]="device.deviceName" class="edit-input" placeholder="Device Name">
          <input [(ngModel)]="device.osVersion" class="edit-input" placeholder="OS Version">
          <div class="edit-buttons">
            <button class="btn-save-sm" (click)="onSaveEdit('smartphone', device)">Save</button>
            <button class="btn-cancel-sm" (click)="editingDeviceId = null">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="device-section" *ngIf="filteredTablets.length > 0">
    <h2 class="section-title">Tablets</h2>
    <div class="device-grid">
      <div *ngFor="let device of filteredTablets; let i = index" class="device-card" [class.animate-in]="isLoaded"
        [style.animation-delay]="(i + 5) * 50 + 'ms'">

        <ng-container *ngIf="editingDeviceId !== device.id">
          <h3>{{ device.deviceName }}</h3>
          <p>OS: {{ device.osVersion }}</p>
          <small>Last Sync: {{ device.lastSync | date:'short' }}</small>
          <div class="card-actions">
            <button class="btn-edit" (click)="onEdit(device)">Edit</button>
            <button class="btn-delete" (click)="onDelete('tablet', device.id)">Delete</button>
          </div>
        </ng-container>

        <div *ngIf="editingDeviceId === device.id" class="edit-mode">
          <input [(ngModel)]="device.deviceName" class="edit-input">
          <input [(ngModel)]="device.osVersion" class="edit-input">
          <div class="edit-buttons">
            <button class="btn-save-sm" (click)="onSaveEdit('tablet', device)">Save</button>
            <button class="btn-cancel-sm" (click)="editingDeviceId = null">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="device-section" *ngIf="filteredWearables.length > 0">
    <h2 class="section-title">Wearables</h2>
    <div class="device-grid">
      <div *ngFor="let device of filteredWearables; let i = index" class="device-card" [class.animate-in]="isLoaded"
        [style.animation-delay]="(i + 10) * 50 + 'ms'">

        <ng-container *ngIf="editingDeviceId !== device.id">
          <h3>{{ device.deviceName }}</h3>
          <p>OS: {{ device.osVersion }}</p>
          <small>Last Sync: {{ device.lastSync | date:'short' }}</small>
          <div class="card-actions">
            <button class="btn-edit" (click)="onEdit(device)">Edit</button>
            <button class="btn-delete" (click)="onDelete('wearable', device.id)">Delete</button>
          </div>
        </ng-container>

        <div *ngIf="editingDeviceId === device.id" class="edit-mode">
          <input [(ngModel)]="device.deviceName" class="edit-input">
          <input [(ngModel)]="device.osVersion" class="edit-input">
          <div class="edit-buttons">
            <button class="btn-save-sm" (click)="onSaveEdit('wearable', device)">Save</button>
            <button class="btn-cancel-sm" (click)="editingDeviceId = null">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </div>



  <div class="empty-state"
    *ngIf="isLoaded && (filteredSmartphones.length + filteredTablets.length + filteredWearables.length) === 0">
    <p>No devices found matching "{{ searchText }}"</p>
  </div>
</div>