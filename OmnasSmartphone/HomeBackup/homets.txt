import { Component, OnInit } from '@angular/core';
import { FormControl, ReactiveFormsModule } from '@angular/forms';
import { debounceTime, distinctUntilChanged } from 'rxjs/operators';
import { Smartphoneservices } from '../../services/smartphoneservices/smartphoneservices';
import { Smartphonemodels } from '../../models/smartphonemodels/smartphonemodels';
import { HttpClient, HttpClientModule } from '@angular/common/http';
import { CommonModule } from '@angular/common';

@Component({
  selector: 'app-home',
  imports: [ReactiveFormsModule, CommonModule],
  templateUrl: './home.html',
  styleUrl: './home.css',
})
export class Home implements OnInit {
  allPhones: Smartphonemodels[] = [];
  filteredPhones: Smartphonemodels[] = [];
  searchControl = new FormControl('');

  constructor(private Smartphoneservices: Smartphoneservices) {}

  ngOnInit(): void {
    // Fetch data from Spring Boot
    this.Smartphoneservices.getSmartphones().subscribe(data => {
      this.allPhones = data;
      this.filteredPhones = data; 
    });

    // Inside ngOnInit or ngAfterViewInit
window.addEventListener('scroll', () => {
  const sections = document.querySelectorAll('section');
  sections.forEach(sec => {
    const top = window.scrollY;
    const offset = sec.offsetTop - 500;
    if (top >= offset) {
      sec.classList.add('visible');
    }
  });
});

    // Filter Logic with Animation Trigger
    this.searchControl.valueChanges.pipe(
      debounceTime(300), // Wait for user to stop typing
      distinctUntilChanged()
    ).subscribe(value => {
      this.filterData(value || '');
    });
  }

  filterData(searchTerm: string) {
    this.filteredPhones = this.allPhones.filter(phone =>
      phone.brand.toLowerCase().includes(searchTerm.toLowerCase()) ||
      phone.model.toLowerCase().includes(searchTerm.toLowerCase()) ||
      phone.processor.toLowerCase().includes(searchTerm.toLowerCase())
    );
  }

  selectedPhone: any = null;

openDetails(phone: any) {
  this.selectedPhone = phone;
}

closeDetails() {
  this.selectedPhone = null;
}


}
